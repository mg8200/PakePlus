import{_ as e}from"./table-DoFSI9NT.js";import{_ as a}from"./common-search.vue_vue_type_script_setup_true_lang-BX9APgbN.js";import{Z as t,r as l,o as n,e as s,g as i,W as o,a9 as r,a2 as d,i as c,V as u,w as p,a3 as m,c as h,X as g,h as v,f as y,dj as f,a5 as k,B as w,J as b}from"./index-B3PZsRwT.js";import{u as x}from"./resetTableRef-DZjcvemm.js";import{u as _}from"./searchData-DpjdfxBw.js";import{E as O}from"./EditOutlined-5FYoGiVM.js";import{D as I}from"./DeleteOutlined-CWT7lRAZ.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import"./api-By23aosn.js";import"./index-BThgVJ70.js";const C={class:"h-full w-full"},j={__name:"add",props:{rowData:{type:Object,default:()=>null}},setup(e,{expose:a}){const t=e,r=l(null),d=l(function(){if(t.rowData)return t.rowData;return{model:null,position:null,category:null,printCount:null,notes:null}}());const c=[{label:"型号",key:"model",span:24,type:"input",placeholder:"请输入型号"},{label:"存放位置",key:"position",span:24,type:"input",placeholder:"请输入存放位置"},{label:"类别",key:"category",span:24,type:"input",placeholder:"请输入类别"},{label:"印次",key:"printCount",span:24,type:"input",placeholder:"请输入印次"},{label:"备注",key:"notes",span:24,type:"textarea",placeholder:"请输入备注"}];return a({model:d.value,validateForm:async function(){await r.value.validateForm()}}),(e,a)=>{const t=o;return n(),s("div",C,[i(t,{ref_key:"formRef",ref:r,model:d.value,"onUpdate:model":a[0]||(a[0]=e=>d.value=e),"form-list":c},null,8,["model"])])}}},P={class:"vent-board min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},D=b(Object.assign({name:"workwear_vent-board"},{__name:"index",setup(o){const b=window.$useModal,[C,D]=x({model:null,states:null,time:null}),R=l(null),{height:T}=r(R),B=[{type:"input",key:"model",label:"型号",placeholder:"请输入型号",span:24,md:12,lg:8,xl:8,xxl:6},{type:"select",key:"states",label:"状态",placeholder:"请输入状态",span:24,md:12,lg:8,xl:8,xxl:6,selectOptions:[{label:"未审核",value:0},{label:"生效",value:1},{label:"已报废",value:2}]},{type:"dateRangePicker",key:"time",label:"日期",span:24,md:12,lg:10,xl:8,xxl:6,showTime:!0}],S=l(null),q=_(C),$=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"model",dataIndex:"model",title:"型号",align:"center",checked:!0,ellipsis:!0,width:170},{key:"states",dataIndex:"states",title:"状态",align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>{const a={0:{text:"未审核",color:"orange"},1:{text:"生效",color:"green"},2:{text:"已报废",color:"red"}};return i(f,{color:a[e.states].color},{default:()=>[a[e.states].text]})}},{key:"position",dataIndex:"position",title:"存放位置",align:"center",checked:!0,ellipsis:!0},{key:"category",dataIndex:"category",title:"类别",align:"center",checked:!0,ellipsis:!0},{key:"printCount",dataIndex:"printCount",title:"导气板数量",align:"center",checked:!0,ellipsis:!0},{key:"applicant",dataIndex:"applicant",title:"申请人",align:"center",checked:!0,ellipsis:!0},{key:"applicationtime",dataIndex:"applicationtime",title:"申请时间",align:"center",checked:!0,ellipsis:!0,width:170},{key:"scrapper",dataIndex:"scrapper",title:"报废人",align:"center",checked:!0,ellipsis:!0},{key:"scraptime",dataIndex:"scraptime",title:"报废时间",align:"center",checked:!0,ellipsis:!0,width:170},{key:"reasonforscrapping",dataIndex:"reasonforscrapping",title:"报废原因",align:"center",checked:!0,ellipsis:!0,width:170},{key:"checker",dataIndex:"checker",title:"审核人",align:"center",checked:!0,ellipsis:!0},{key:"checkTime",dataIndex:"checkTime",title:"审核时间",align:"center",checked:!0,ellipsis:!0,width:170}],z=l([]);function F(e){z.value=e}const L=l(null),U=l(null),A=l("add"),{handleClose:E,handleLoading:M,handleShow:J,updateModalOptions:N}=b({modalOption:{width:"600px",destroyOnClose:!0,title:"导气板新增"},component:()=>i(j,{ref:U,rowData:L.value},null),onOk:async()=>{const e={...U.value};await e.validateForm(),M(!0);try{const a={...e.model};let l;l="add"===A.value?await function(e){return t({url:"/qms/ventBoard/add/new",method:"POST",data:e})}(a):await function(e){return t({url:"/qms/ventBoard/update",method:"POST",data:e})}({...a});const{error:n}=await l;n||(window.$message.success("操作成功"),E(),ee())}finally{M(!1)}}});function V(e){L.value=e,e?(A.value="edit",N({title:"导气板修改"})):(A.value="add",N({title:"导气板新增"})),J()}const W=l(!1),X={title:"是否删除所勾选数据?",onOk:()=>{var e;W.value=!0,(e=z.value,t({url:"/qms/ventBoard/deleteBatch",method:"POST",data:e})).then((({error:e})=>{e||(window.$message.success("删除成功!"),ee())})).finally((()=>{W.value=!1}))}},Z=l(!1),G={title:"是否审核所勾选数据?",onOk:()=>{var e;Z.value=!0,(e=z.value,t({url:"/qms/ventBoard/check",method:"POST",data:e})).then((({error:e})=>{e||(window.$message.success("审核成功!"),ee())})).finally((()=>{Z.value=!1}))}},H=l(null),{handleClose:K,handleLoading:Q,handleShow:Y}=b({modalOption:{title:"报废导气板",width:"600px",height:"300px",destroyOnClose:!0},formData:{scrapReason:null},formList:[{type:"textarea",key:"reasonforscrapping",label:"报废原因",textareaRows:3,placeholder:"请选择报废原因",span:24}],onOk:e=>{Q(!0),function(e){return t({url:"/qms/ventBoard/scrap",method:"POST",data:e})}({...e,id:H.value.id,states:H.value.states}).then((({error:e})=>{e||(window.$message.success("报废成功"),H.value=null,K(),ee())})).finally((()=>{Q(!1)}))},onCancel:()=>{}});function ee(){S.value.getData(1)}function ae(){D(),k((()=>{ee()}))}return(t,l)=>{const o=a,r=w,f=e,k=d("hasAuth"),b=d("confirm");return n(),s("div",P,[i(o,{ref_key:"searchRef",ref:R,searchParams:c(C),"onUpdate:searchParams":l[0]||(l[0]=e=>u(C)?C.value=e:null),"form-list":B,"is-search":!0,onSearch:ee,onReset:ae},null,8,["searchParams"]),i(f,{ref_key:"tableRef",ref:S,searchParams:c(q),"onUpdate:searchParams":l[4]||(l[4]=e=>u(q)?q.value=e:null),column:$,"show-row-selection":"",class:"h-full",scroll:{y:"auto"},"is-init-get-data":"","auto-generate-uuid":!0,"table-custom-row":t.tableCustomRow,url:"/qms/ventBoard/list","row-height":30,onTableSelectChange:F},{title:p((()=>[m((n(),h(r,{type:"primary",class:"mini-btn mr-8px",size:"small",ghost:"",onClick:l[1]||(l[1]=e=>V(null))},{icon:p((()=>[i(c(g),{class:"align-sub"})])),default:p((()=>[l[5]||(l[5]=v(" 新增 "))])),_:1})),[[k,["workwear:vent-board:add"]]]),m((n(),h(r,{type:"primary",class:"mini-btn mr-8px",size:"small",ghost:"",disabled:1!=z.value.length,onClick:l[2]||(l[2]=e=>V(z.value[0]))},{icon:p((()=>[i(c(O),{class:"align-sub"})])),default:p((()=>[l[6]||(l[6]=v(" 修改 "))])),_:1},8,["disabled"])),[[k,["workwear:vent-board:update"]]]),m((n(),h(r,{loading:W.value,type:"primary",danger:"",class:"mini-btn mr-8px",size:"small",ghost:"",disabled:!z.value.length},{icon:p((()=>[i(c(I),{class:"align-sub"})])),default:p((()=>[l[7]||(l[7]=v(" 删除 "))])),_:1},8,["loading","disabled"])),[[k,["workwear:vent-board:delete"]],[b,X]]),m((n(),h(r,{type:"primary",class:"mini-btn mr-8px",size:"small",ghost:"",disabled:1!=z.value.length,onClick:l[3]||(l[3]=e=>{return a=z.value[0],void(2!==Number(a.states)?(Y(),H.value=a):window.$message.error("该导气板已报废，请勿重复操作!"));var a})},{icon:p((()=>l[8]||(l[8]=[y("em",{class:"iconfont icon-baofei align-sub"},null,-1)]))),default:p((()=>[l[9]||(l[9]=v(" 报废 "))])),_:1},8,["disabled"])),[[k,["workwear:vent-board:scrap"]]]),m((n(),h(r,{loading:Z.value,type:"primary",class:"mini-btn mr-8px",size:"small",ghost:"",disabled:!z.value.length},{icon:p((()=>l[10]||(l[10]=[y("em",{class:"iconfont icon-shenhe align-sub"},null,-1)]))),default:p((()=>[l[11]||(l[11]=v(" 审核 "))])),_:1},8,["loading","disabled"])),[[k,["workwear:vent-board:examine"]],[b,G]])])),_:1},8,["searchParams","table-custom-row"])])}}}),[["__scopeId","data-v-a0281895"]]);export{D as default};
