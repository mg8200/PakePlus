import{_ as e}from"./modal.vue_vue_type_style_index_0_lang-Gjmj9w7c.js";import{_ as a}from"./table-DoFSI9NT.js";import{_ as t}from"./common-search.vue_vue_type_script_setup_true_lang-BX9APgbN.js";import{Z as l,r as i,o as n,c as s,aa as r,e as c,g as d,w as o,f as u,h as p,aj as h,a5 as y,_ as f,J as v,cF as m,i as k,a0 as g,V as w,N as I,Q as x,a7 as b,a9 as P,ac as D,X as _,t as Q,I as N,dJ as T,W as R,B as C,ah as S,ai as M,da as B}from"./index-B3PZsRwT.js";import{u as U}from"./resetTableRef-DZjcvemm.js";import{u as E}from"./searchData-DpjdfxBw.js";import{d as F,_ as L,g as q,a as Y}from"./engineering-data-inquiry-BIeYOUOZ.js";import"./pdf-viewer-DuGSG8WR.js";import{I as O}from"./index-I_sO5Oju.js";import{C as j}from"./index-BThgVJ70.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import"./api-By23aosn.js";import"./isNumber-v5vW-SxR.js";import"./SwapOutlined-WSjUvGaB.js";function $(e){return l({url:"/mes/BaseMaterial/selectRemarkByMaterialId",params:e})}function H(e){return l({url:"/mes/BaseInvsourceoutdetail/insert",method:"post",data:e})}const A={__name:"delivery-schedule",setup(e){const t=i(null),l=i({}),c=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"delivDate",dataIndex:"delivDate",title:"计划交期",width:120,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>r(e.delivDate).format("YYYY-MM-DD HH:mm:ss")},{key:"qty",dataIndex:"qty",title:"计划数量",width:120,align:"center",checked:!0,ellipsis:!0},{key:"backupQty",dataIndex:"backupQty",title:"计划备品数量",width:150,align:"center",checked:!0,ellipsis:!0},{key:"workQty",dataIndex:"workQty",title:"WIP数量",width:120,align:"center",checked:!0,ellipsis:!0},{key:"invInQty",dataIndex:"invInQty",title:"入库数量",width:120,align:"center",checked:!0,ellipsis:!0}];return(e,i)=>{const r=a;return n(),s(r,{ref_key:"tableRef",ref:t,searchParams:l.value,"onUpdate:searchParams":i[0]||(i[0]=e=>l.value=e),column:c,"show-row-selection":!1,"auto-generate-uuid":"","row-key":"screenId",scroll:{y:"auto"},"is-init-get-data":!1,url:"/qms/scrscreen/screenInfo/pageList",class:"h-full","is-pagination":!1},null,8,["searchParams"])}}},K=["onClick"],z=["onClick"],V={__name:"engineering-document",setup(e,{expose:t}){const l="localhost"===window.location.hostname,s=i(null),r=i({prodNo:null}),v=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"fileName",dataIndex:"fileName",title:"文件名",align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>d("span",{class:"cursor-pointer color-blue",onClick:()=>g({record:e})},[e.fileName])},{key:"fileSizeKb",dataIndex:"fileSizeKb",title:"文件大小",align:"center",checked:!0,ellipsis:!0,width:130,customRender:({record:e})=>"".concat(e.fileSizeKb,"KB")},{key:"fileModifiedTime",dataIndex:"fileModifiedTime",title:"更改时间",align:"center",checked:!0,ellipsis:!0,width:160}];const m=i(!1),k=i(null);function g(e){m.value=!0,k.value="".concat(l?"http://192.168.166.169:9999/prod-api/":"/prod-api/","rcerp/erpMiFile/downMiFile?prodNo=").concat(e.record.prodNo,"&fileName=").concat(e.record.fileName),e.hidePopup()}return t({getData:function(e){r.value=e,y((()=>{s.value.getData()}))}}),(e,t)=>{const l=f,i=a,y=L;return n(),c(h,null,[d(i,{ref_key:"tableRef",ref:s,searchParams:r.value,"onUpdate:searchParams":t[0]||(t[0]=e=>r.value=e),class:"h-full",column:v,"show-row-selection":!1,"row-key":"id",scroll:{y:"auto"},"is-init-get-data":!1,url:"/rcerp/erpMiFile/getMiFileList","auto-generate-uuid":!0,"is-pagination":!1,onTableRowDblclick:t[1]||(t[1]=e=>g({record:e}))},{"contextmenuPopup-orter":o((({args:e})=>[u("li",{class:"popup-item",onClick:a=>{return F({prodNo:(t=e).record.prodNo,fileName:t.record.fileName}),void t.hidePopup();var t}},[d(l,{"local-icon":"download",class:"text-16px"}),t[3]||(t[3]=p(" 下载 "))],8,K),u("li",{class:"popup-item",onClick:a=>g(e)},[d(l,{"local-icon":"preview",class:"text-16px"}),t[4]||(t[4]=p(" 预览 "))],8,z)])),_:1},8,["searchParams"]),d(y,{visible:m.value,"onUpdate:visible":t[2]||(t[2]=e=>m.value=e),url:k.value,"pdf-use-iframe":!0},null,8,["visible","url"])],64)}}},W={class:"h-full w-full"},J={class:"h-49% w-full"},G=["innerHTML"],X={class:"mb-0.5% mt-0.5% h-35% w-full"},Z=v({__name:"engineering-instruction",emits:["engineeringTableDataLoadSuccess","engineeringInstructionTableLoadSuccess"],setup(e,{expose:t,emit:l}){const s=l,r=i(null),h=i({prodId:null,techId:null}),f=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"miName",dataIndex:"miName",title:"项目名称",align:"center",checked:!0,ellipsis:!0,width:130},{key:"miData",dataIndex:"miData",title:"数据项",align:"center",checked:!0,ellipsis:!0,width:130},{key:"remark",dataIndex:"remark",title:"备注",align:"center",checked:!0,ellipsis:!0,width:130},{key:"createBy",dataIndex:"createBy",title:"编写",align:"center",checked:!0,ellipsis:!0,width:130},{key:"createDate",dataIndex:"createDate",title:"编写日期",align:"center",checked:!0,ellipsis:!0,width:160},{key:"updateDate",dataIndex:"updateDate",title:"最后修改日期",align:"center",checked:!0,ellipsis:!0,width:160}],v=i([]),m=i(null),k=i("工程备注");function g(e){s("engineeringTableDataLoadSuccess",e)}function w(e){s("engineeringInstructionTableLoadSuccess",e)}return t({getData:function(e){h.value=e,y((()=>{r.value.getData(1),m.value.getData(1),$({prodId:h.value.prodId}).then((({data:e,error:a})=>{a||(k.value=null==e?void 0:e.replace(/\n/g,"<br>"))})),q({techId:e.techId}).then((({data:e,error:a})=>{if(!a&&e.length){const a=e.map((e=>({key:e.fieldName,dataIndex:e.fieldName,title:e.caption,align:"center",checked:!0,ellipsis:!0,width:130})));v.value=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},...a]}else v.value=[]}))}))}}),(e,t)=>{const l=a;return n(),c("div",W,[u("div",J,[d(l,{ref_key:"topTableRef",ref:r,searchParams:h.value,"onUpdate:searchParams":t[0]||(t[0]=e=>h.value=e),column:f,"show-row-selection":!1,"auto-generate-uuid":"","row-key":"screenId",scroll:{y:"auto"},"is-init-get-data":!1,"is-pagination":!1,url:"/erpsyncmes/Mi/findMiData",class:"h-full",onTableDataLoadSucess:w},{title:o((()=>t[2]||(t[2]=[u("span",{class:"color-#646cff"},"投料型号",-1)]))),_:1},8,["searchParams"])]),u("div",{class:"footer-content mb-0.5% mt-0.5% h-14.5% w-full overflow-auto p-15px text-12px",innerHTML:k.value},null,8,G),u("div",X,[d(l,{ref_key:"bottomTableRef",ref:m,searchParams:h.value,"onUpdate:searchParams":t[1]||(t[1]=e=>h.value=e),class:"h-full",column:v.value,"show-row-selection":!1,"row-key":"id",scroll:{y:"auto"},"is-init-get-data":!1,url:"/erpsyncmes/Mi/findMiData2","auto-generate-uuid":!0,"is-pagination":!1,onTableDataLoadSucess:g},{title:o((()=>t[3]||(t[3]=[p("工程数据")]))),_:1},8,["searchParams","column"])])])}}},[["__scopeId","data-v-478a9c4c"]]),ee={class:"h-full w-full flex-center"},ae={__name:"drawing",setup(e,{expose:a}){const t=m.PRESENTED_IMAGE_SIMPLE,l=i(null),r="localhost"===window.location.hostname;return a({getData:function(e){Y(e).then((({data:e,error:a})=>{a||(e.image?l.value="".concat(r?"http://192.168.166.166/prod-api/":"/prod-api/").concat(e.image):l.value=null)}))}}),(e,a)=>{const i=O,r=m;return n(),c("div",ee,[l.value?(n(),s(i,{key:0,src:l.value},null,8,["src"])):(n(),s(r,{key:1,image:k(t),description:"暂无开料图"},null,8,["image"]))])}}},te={class:"h-full w-full"},le={class:"h-49% w-full"},ie=["innerHTML"],ne={class:"mb-0.5% mt-0.5% h-35% w-full"},se=v({__name:"engineering-instruction-inner",props:{engineeringTableData:{type:Array,default:()=>[]}},emits:["planListLoadSuccess"],setup(e,{expose:t,emit:l}){const s=e,r=i(s.engineeringTableData);g((()=>s.engineeringTableData),(e=>{r.value=e}),{deep:!0});const h=i(null),f=i({prodId:null,techId:null}),v=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"miName",dataIndex:"miName",title:"项目名称",align:"center",checked:!0,ellipsis:!0,width:130},{key:"miData",dataIndex:"miData",title:"数据项",align:"center",checked:!0,ellipsis:!0,width:130},{key:"remark",dataIndex:"remark",title:"备注",align:"center",checked:!0,ellipsis:!0,width:130},{key:"createBy",dataIndex:"createBy",title:"编写",align:"center",checked:!0,ellipsis:!0,width:130},{key:"createDate",dataIndex:"createDate",title:"编写日期",align:"center",checked:!0,ellipsis:!0,width:160},{key:"updateDate",dataIndex:"updateDate",title:"最后修改日期",align:"center",checked:!0,ellipsis:!0,width:160}],m=l,k=i([]),w=i(null),I=i("工程备注");function x(e){m("planListLoadSuccess",e)}return t({getData:function(e,a){f.value=e,y((()=>{h.value.getData(1),w.value.getData(1),$({prodId:f.value.prodId}).then((({data:e,error:a})=>{a||(I.value=null==e?void 0:e.replace(/\n/g,"<br>"))})),q({techId:e.techId}).then((({data:e,error:a})=>{if(!a&&e.length){const a=e.map((e=>({key:e.fieldName,dataIndex:e.fieldName,title:e.caption,align:"center",checked:!0,ellipsis:!0,width:130})));k.value=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},...a]}else k.value=[]}))}))}}),(e,t)=>{const l=a;return n(),c("div",te,[u("div",le,[d(l,{ref_key:"topTableRef",ref:h,searchParams:f.value,"onUpdate:searchParams":t[0]||(t[0]=e=>f.value=e),column:v,"show-row-selection":!1,"auto-generate-uuid":"","row-key":"screenId",scroll:{y:"auto"},"is-init-get-data":!1,"is-pagination":!1,url:"/mes/BaseVppcissueplanodr/getPlanList",class:"h-full",onTableDataLoadSucess:x},{title:o((()=>t[2]||(t[2]=[u("span",{class:"color-#646cff"},"投料型号",-1)]))),_:1},8,["searchParams"])]),u("div",{class:"footer-content mb-0.5% mt-0.5% h-14.5% w-full overflow-auto p-15px text-12px",innerHTML:I.value},null,8,ie),u("div",ne,[d(l,{ref_key:"bottomTableRef",ref:w,searchParams:f.value,"onUpdate:searchParams":t[1]||(t[1]=e=>f.value=e),class:"h-full",column:k.value,"show-row-selection":!1,"row-key":"id",scroll:{y:"auto"},"is-init-get-data":!1,url:"/erpsyncmes/Mi/findMiData2","auto-generate-uuid":!0,"is-pagination":!1},{title:o((()=>t[3]||(t[3]=[p("工程数据")]))),_:1},8,["searchParams","column"])])])}}},[["__scopeId","data-v-716dd3ce"]]),re={class:"h-full w-full"},ce={__name:"add-sheet-metal",props:{rowData:{type:Object,required:!0},engineeringTableData:{type:Array,default:()=>[]},engineeringInstructionData:{type:Array,default:()=>[]}},emits:["saveData"],setup(e,{expose:s,emit:u}){const p=e,h=p.rowData,f=i(null),[v,m]=U({specif7:null,specif6:null,specif3:null,color:null,height:null,specif10:null,specif8:null,specif9:null,width:null,length:null,specif14:null,specif15:null,special:null,matNo:null,specif:null,specif2:null,matReplace:null,materialType:0}),P=[{type:"input",key:"specif7",label:"底铜",span:6,placeholder:""},{type:"input",key:"specif6",label:"顶铜",span:6,placeholder:""},{type:"input",key:"specif3",label:"板材类型",span:6,placeholder:""},{type:"input",key:"color",label:"板材颜色",span:6,placeholder:""},{type:"input",key:"height",label:"板厚(mm)",span:6,placeholder:""},{type:"input",key:"specif10",label:"TG值",span:6,placeholder:""},{type:"input",key:"specif8",label:"CTI",span:6,placeholder:""},{type:"input",key:"specif9",label:"含铜",span:6,placeholder:""},{type:"input",key:"width",label:"宽",span:6,placeholder:""},{type:"input",key:"length",label:"长",span:6,placeholder:""},{type:"input",key:"specif14",label:"无卤素要求",span:6,placeholder:""},{type:"input",key:"specif15",label:"板料水印",span:6,placeholder:""},{type:"input",key:"special",label:"板料特殊要求",span:8,placeholder:""},{type:"input",key:"matNo",label:"物料编码",span:8,placeholder:""},{type:"input",key:"specif",label:"规格",span:8,placeholder:""},{type:"input",key:"specif2",label:"供应商",span:8,placeholder:""},{type:"checkbox",key:"matReplace",label:"",span:8,placeholder:"",selectOptions:[{label:"代料",value:!0}]}],D=i(null),_=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"matname",dataIndex:"matname",title:"板材名称",align:"center",checked:!0,ellipsis:!0,width:120},{key:"specif2",dataIndex:"specif2",title:"供应商",align:"center",checked:!0,ellipsis:!0,width:120},{key:"specif",dataIndex:"specif",title:"物料规格",align:"center",checked:!0,ellipsis:!0,width:400,customRender:({record:e})=>{var a;return null==(a=null==e?void 0:e.matSpecs)?void 0:a.replace(/黄料|黄色/g,"")}},{key:"invqty",dataIndex:"invqty",title:"库存数量",align:"center",checked:!0,ellipsis:!0,width:120},{key:"occupancyqty",dataIndex:"occupancyqty",title:"占用数量",align:"center",checked:!0,ellipsis:!0,width:120},{key:"invQty-occupancyQty",dataIndex:"invQty-occupancyQty",title:"可用库存数量",align:"center",checked:!0,ellipsis:!0,width:120,customRender:({record:e})=>e.invqty-e.occupancyqty},{key:"proddate",dataIndex:"proddate",title:"生产日期",align:"center",checked:!0,ellipsis:!0,width:120,customRender:({record:e})=>e.proddate&&r(e.proddate).format("YYYY-MM-DD HH:mm:ss")},{key:"createdate",dataIndex:"createdate",title:"入库日期",align:"center",checked:!0,ellipsis:!0,width:120,customRender:({record:e})=>e.createdate&&r(e.createdate).format("YYYY-MM-DD HH:mm:ss")},{key:"unit",dataIndex:"unit",title:"单位",align:"center",checked:!0,ellipsis:!0,width:120},{key:"matno",dataIndex:"matno",title:"板材编码",align:"center",checked:!0,ellipsis:!0,width:120},{key:"length",dataIndex:"length",title:"长",align:"center",checked:!0,ellipsis:!0,width:120},{key:"width",dataIndex:"width",title:"宽",align:"center",checked:!0,ellipsis:!0,width:120}];g((()=>[p.engineeringTableData,p.engineeringInstructionData]),(()=>{!function(){var e,a;const t=p.engineeringTableData[0];v.value.specif7=null==(e=t.data1)?void 0:e.trim().split("/")[0],v.value.specif6=null==(a=t.data1)?void 0:a.trim().split("/")[1],v.value.height=t.data2,v.value.specif9=t.data5;const l={specif3:"1350000048500041",color:"1350000048500044",specif10:"1350000048500051",specif8:"1350000048500053",width:"1350000048500012",length:"1350000048500011",special:"1350000048500040",specif14:"1350000048500088",specif15:"1350000048500045",specif2:"1350000048500037"};Object.keys(l).forEach((e=>{const a=p.engineeringInstructionData.find((a=>a.miMouldId===l[e]));v.value[e]=("specif14"!==e||"/"!==(null==a?void 0:a.miData)&&"//"!==(null==a?void 0:a.miData))&&(null==a?void 0:a.miData)||null}))}()}),{deep:!0,immediate:!0});const Q=i([]);function N(){var e;(e={...v.value,specif2:void 0},l({url:"/mes/BaseMaterial/SelectAll",method:"post",data:e})).then((({data:e,error:a})=>{a||(e.forEach(((e,a)=>{e.dataIndex=a+1,e.tableUuid=b.genV4().hexNoDelim})),Q.value=e)}))}function T(){N()}function R(){m(),T()}const C=i(null);y((()=>{C.value.getData({prodId:h.prodID,techId:h.techid})}));const S=i([]);function M(e){S.value=e[0]}function B(){var e,a;if(!S.value)return window.$message.error("请选择需要保存的行!"),!1;if(!(null==(a=null==(e=v.value)?void 0:e.matReplace)?void 0:a.includes(!0))){if(S.value.length!==v.value.length||S.value.width!==v.value.width||S.value.specif3!==v.value.specif3||S.value.specif6!==v.value.specif6||S.value.specif7!==v.value.specif7||S.value.height!==v.value.height||S.value.specif9!==v.value.specif9||S.value.specif10!==v.value.specif10)return window.$message.error("所选板材与MI信息不符,请重新选择!"),!1;if(!function(){var e;return((null==(e=S.value.specif8)?void 0:e.trim())||"175")===(v.value.specif8||"175")}())return window.$message.error("所选板材与CTI不符,请重新选择!"),!1;if(S.value.specif15!==(v.value.specif15||""))return window.$message.error("所选板材与板料水印不符,请重新选择!"),!1}return!0}return s({getData:function(e){v.value={...v.value,...e},N()},saveData:function(){return B()?S.value:null}}),(e,l)=>{const i=t,s=a,r=I,u=x;return n(),c("div",re,[d(u,{gutter:16,class:"h-full w-full"},{default:o((()=>[d(r,{span:14,class:"h-full min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},{default:o((()=>[d(i,{ref_key:"commonSearchRef",ref:f,searchParams:k(v),"onUpdate:searchParams":l[0]||(l[0]=e=>w(v)?v.value=e:null),"form-list":P,onSearch:T,onReset:R},null,8,["searchParams"]),d(s,{ref_key:"leftTableRef",ref:D,searchParams:k(v),"onUpdate:searchParams":l[1]||(l[1]=e=>w(v)?v.value=e:null),"row-selection-type":"radio","show-card-header":!1,"data-source":Q.value,column:_,"show-row-selection":!0,"auto-generate-uuid":!1,"row-key":"tableUuid",scroll:{y:"auto"},"is-init-get-data":"",url:"",class:"h-full","is-pagination":!1,onTableSelectChange:M},null,8,["searchParams","data-source"])])),_:1}),d(r,{span:10,class:"h-full"},{default:o((()=>[d(se,{ref_key:"engineeringInstructionRef",ref:C,"engineering-table-data":p.engineeringTableData},null,8,["engineering-table-data"])])),_:1})])),_:1})])}}},de={class:"add-modal-content h-full w-full"},oe=["onClick"],ue={class:"add-sheet-metal-title pl-15px"},pe={class:"mr-8px color-#646cff"},he={class:"color-#646cff"},ye={class:"modal-footer"},fe=v({__name:"add",props:{rowData:{type:Object,required:!0}},setup(t,{expose:s}){const h=t,v=h.rowData,m=i(null),g=i({prodId:v.prodID,tlqty:null}),w=i(null),b=i(null),B=i({liaohao:null,prodOrderNo:null,pedifficulty:null,mantissaPercent:null,invProvideQty:null,invQty:null,qty:null,invQty:null,issueType:"投料",issPcsQty:null,scrapRete:null,sheetQty:null,autoCalc:[!0],workType:"正常",lotQty:120,list:null,remark:null});function U(){var e;(e={prodId:v.prodID,issPlanId:v.issPlanID,tlqty:B.value.issPcsQty},l({url:"/mes/BaseVppcissueplanodr/getLayout",params:e})).then((({data:e,error:a})=>{a||(B.value.scrapRete=e.bestUtilization,B.value.sheetQty=e.worstUtilization)})),g.value.tlqty=B.value.issPcsQty,y((()=>{m.value.getData()}))}const E=i([]);function F(e){E.value=e}y((()=>{w.value.getData({prodId:v.prodID,techId:v.techid})})),h.rowData&&(B.value=v,B.value.editQty=B.value.qty,B.value.invProvideQty=B.value.invProvideQty||0,B.value.issueType=B.value.issueType||"投料",B.value.workType=B.value.workType||"正常",B.value.autoCalc=[!0],B.value.issPcsQty=B.value.editQty-B.value.invProvideQty,B.value.lotQty=B.value.lotQty||120,U());const L=[{type:"input",key:"liaohao",label:"生产型号",span:12,placeholder:"",disabled:!0},{type:"input",key:"prodOrderNo",label:"工单号",span:12,placeholder:"",disabled:!0},{type:"input",key:"pedifficulty",label:"难度系数",span:12,placeholder:"",disabled:!0},{type:"input",key:"mantissaPercent",label:"尾数板比率",span:12,placeholder:"",disabled:!0},{type:"input",key:"invProvideQty",label:"使用库存数",span:6,placeholder:"请输入使用库存数",keypressEnter:()=>{const e=B.value.issPcsQty-B.value.invProvideQty;e<0&&window.$message.error("投料数(PCS)必须大于0"),B.value.issPcsQty=e,B.value.autoCalc.includes(!0)&&U()},blur(){const e=B.value.issPcsQty-B.value.invProvideQty;e<0&&window.$message.error("投料数(PCS)必须大于0"),B.value.issPcsQty=e,B.value.autoCalc.includes(!0)&&U()},rule:[{required:!0,message:"请输入使用库存数",trigger:"change"}]},{type:"input",key:"invQty",label:"库存数量",span:6,placeholder:"",disabled:!0},{type:"input",key:"editQty",label:"待投数量",span:6,placeholder:"请输入待投数量"},{type:"input",key:"qty",label:"订单数量",span:6,placeholder:"",disabled:!0},{type:"select",key:"issueType",label:"投料类型",span:12,placeholder:"请选择投料类型",selectOptions:[{label:"投料",value:"投料"},{label:"补料",value:"补料"}]},{type:"input",key:"issPcsQty",label:"投料数(PCS)",span:12,placeholder:"请输入投料数(PCS)",keypressEnter:()=>{const e=B.value.issPcsQty-B.value.invProvideQty;e<0&&window.$message.error("投料数(PCS)必须大于0"),B.value.issPcsQty=e,B.value.autoCalc.includes(!0)&&U()},blur(){const e=B.value.issPcsQty-B.value.invProvideQty;e<0&&window.$message.error("投料数(PCS)必须大于0"),B.value.issPcsQty=e,B.value.autoCalc.includes(!0)&&U()},rule:[{required:!0,message:"请输入投料数(PCS)",trigger:"change"}]},{type:"input",key:"scrapRete",label:"预投料率(%)",span:12,placeholder:"请输入预投料率(%)"},{type:"input",key:"sheetQty",label:"大料数",span:6,placeholder:"请输入大料数"},{type:"checkbox",key:"autoCalc",label:"",span:6,selectOptions:[{label:"自动计算",value:!0}]},{type:"select",key:"workType",label:"工单类型",span:12,placeholder:"请选择工单类型",selectOptions:[{label:"正常",value:"正常"},{label:"赶板",value:"赶板"},{label:"加急",value:"加急"}]},{type:"input",key:"lotQty",label:"每批卡数量",span:12,placeholder:"请输入每批卡数量"},{type:"textarea",key:"remark",label:"备注",span:24,placeholder:""}],q=i(null),{height:Y}=P(q),O=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"liaohao",dataIndex:"liaohao",title:"生产型号",align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>d("div",{class:"fonw-800 color-#646cff"},[e.liaohao])},{key:"sheetpnl",dataIndex:"sheetpnl",title:"1Sheet=?PNL",align:"center",checked:!0,ellipsis:!0},{key:"pnlset",dataIndex:"pnlset",title:"1PNL=?Set",align:"center",checked:!0,ellipsis:!0},{key:"setpcs",dataIndex:"setpcs",title:"1Set=?Pcs",align:"center",checked:!0,ellipsis:!0},{key:"pnl",dataIndex:"pnl",title:"PNL数",align:"center",checked:!0,ellipsis:!0}],$=e=>/^(\d+(\.\d+)?)$/.test(e)&&Number.parseFloat(e)>0,H=i(null),A=i({}),K=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"prodNo",dataIndex:"prodNo",title:"生产型号",align:"center",checked:!0,ellipsis:!0,width:150,customRender:({record:e})=>d("div",{class:"fonw-800 color-#646cff"},[e.prodNo])},{key:"matno",dataIndex:"matno",title:"板材编码",align:"center",checked:!0,ellipsis:!0,width:150},{key:"specif",dataIndex:"specif",title:"物料规格",align:"center",checked:!0,ellipsis:!0,width:200},{key:"invqty",dataIndex:"invqty",title:"库存数量",align:"center",checked:!0,ellipsis:!0,width:150},{key:"applyQty",dataIndex:"applyQty",title:"申请数量",align:"center",checked:!0,ellipsis:!0,width:150,customRender:({record:e})=>d(N,{class:"w-full",value:e.applyQty,"onUpdate:value":a=>e.applyQty=a,onChange:a=>/^\d+$/.test(a.target.value)?a>Number(e.invqty)?(window.$message.error("申请数量不能大于库存数量"),e.applyQty=0,void(a.target.value=0)):(a.target.value=Number(a.target.value),void(e.applyQty=Number(a.target.value))):(window.$message.error("请输入正整数"),e.applyQty=0,void(a.target.value=0))},null)},{key:"unit",dataIndex:"unit",title:"单位",align:"center",checked:!0,ellipsis:!0,width:100},{key:"length",dataIndex:"length",title:"实开大料长(mm)",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>d(N,{class:"w-full",value:e.length,"onUpdate:value":a=>e.length=a,onChange:a=>{if(!$(a.target.value))return window.$message.error("请输入大于0的数字"),void(a.target.value=e.length);e.length=Number(a.target.value)}},null)},{key:"width",dataIndex:"width",title:"实开大料宽(mm)",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>d(N,{class:"w-full",value:e.width,"onUpdate:value":a=>e.width=a,onChange:a=>{if(!$(a.target.value))return window.$message.error("请输入大于0的数字"),void(e.width=0);e.width=Number(a.target.value)}},null)},{key:"remark",dataIndex:"remark",title:"备注",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>d(N,{class:"w-full",value:e.remark,"onUpdate:value":a=>e.remark=a,onChange:a=>{e.remark=a.target.value}},null)},{key:"asheetPnl",dataIndex:"asheetPnl",title:"APNL/Sheet",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>d(N,{class:"w-full",value:e.asheetPnl,"onUpdate:value":a=>e.asheetPnl=a,onChange:a=>{if(!$(a.target.value))return window.$message.error("请输入大于0的数字"),e.asheetPnl=0,void(a.target.value=e.asheetPnl);e.asheetPnl=Number(a.target.value)}},null)},{key:"APnlQty",dataIndex:"APnlQty",title:"开APNL",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>B.value.autoCalc.includes(!0)?e.applyQty*(e.asheetPnl||0):null},{key:"bsheetPnl",dataIndex:"bsheetPnl",title:"BPNL/Sheet",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>d(N,{class:"w-full",value:e.bsheetPnl,"onUpdate:value":a=>e.bsheetPnl=a,onChange:a=>{if(!$(a.target.value))return window.$message.error("请输入大于0的数字"),void(e.bsheetPnl=0);a.target.value=Number(a.target.value),e.bsheetPnl=Number(a.target.value)}},null)},{key:"BPnlQty",dataIndex:"BPnlQty",title:"开BPNL",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>{if(B.value.autoCalc.includes(!0))return e.applyQty*(e.bsheetPnl||0)}},{key:"needDate",dataIndex:"needDate",title:"需求日期",align:"center",checked:!0,ellipsis:!0,width:200,customRender:({record:e})=>d(T,{value:e.needDate,format:"YYYY-MM-DD HH:mm:ss",onChange:a=>e.needDate=a},null)},{key:"proviQty",dataIndex:"proviQty",title:"发放数量",align:"center",checked:!0,ellipsis:!0,width:160}],z=i("1"),V=i(!1),W=i([]),J=i([]);function G(e){J.value=e}const X=i([]);function ee(e){X.value=e}function te(){V.value=!0}const le=i(null);function ie(){var e,a,t,l;const i=le.value.saveData();let n=null,s=null;if((null==(a=null==(e=B.value)?void 0:e.liaohao)?void 0:a.includes("-"))?(n=(null==(t=E.value.find((e=>{if("A"===(null==e?void 0:e.liaohao.split("-")[1]))return e})))?void 0:t.sheetpnl)||null,s=(null==(l=E.value.find((e=>{if("B"===(null==e?void 0:e.liaohao.split("-")[1]))return e})))?void 0:l.sheetpnl)||null):n=E.value[0].sheetpnl,i){const e=B.value.liaohao.split("-")[0];W.value=[...W.value,{...i,prodNo:e,applyQty:0,needDate:r(),asheetPnl:n,bsheetPnl:s,dataIndex:W.value.length+1}],V.value=!1}}function ne(e){e&&(W.value=[...W.value,{...e,prodNo:prodNo,applyQty:0,needDate:r(),asheetPnl:asheetPnl,bsheetPnl:bsheetPnl}],V.value=!1)}return s({saveData:function(){const e=B.value,a={moduleNo:e.liaohao,remark:e.remark,issueType:e.issueType,autoCalc:e.autoCalc[0],workType:e.workType,scrapRete:e.scrapRete,issPcsQty:e.issPcsQty,custProdNo:e.custProdNo,sheetQty:e.sheetQty,liveUint:e.liveUint||0,prodId:e.prodID,qty:e.qty,lotQty:e.lotQty,pedifficulty:e.pedifficulty,prodOrderNo:e.prodOrderNo};let t=-1;const l=W.value.map((a=>(0===a.applyQty&&(t=a.dataIndex),{moduleNo:e.liaohao,type:a.type,matId:a.matid,matName:a.matname,qty:a.applyQty,prodOrderNo:e.prodOrderNo,unit:a.unit,specif:a.specif,outType:e.issueType})));return l.length?t>-1?(window.$message.error("请先填写第".concat(t,"行板材申请数量")),!1):{data:a,list:l}:(window.$message.error("请选择板材"),!1)},resetTopModel:function(){B.value={liaohao:null,prodOrderNo:null,pedifficulty:null,mantissaPercent:null,invProvideQty:null,invQty:null,qty:null,invQty:null,issueType:"投料",issPcsQty:null,scrapRete:null,sheetQty:null,autoCalc:[!0],workType:"正常",lotQty:120,list:null,remark:null}}}),(t,l)=>{const i=R,s=j,r=a,h=C,y=f,P=I,N=S,T=M,U=e,E=x;return n(),c("div",de,[d(E,{gutter:16,class:"h-full w-full"},{default:o((()=>[d(P,{span:14,class:"h-full"},{default:o((()=>[d(s,{ref_key:"topFormRef",ref:q,bordered:!1,class:"modal-card","body-style":{padding:"5px"}},{title:o((()=>l[6]||(l[6]=[u("span",{class:"mr15px color-#646cff"},"投产输入",-1)]))),default:o((()=>[d(i,{ref_key:"formRef",ref:b,model:B.value,"onUpdate:model":l[0]||(l[0]=e=>B.value=e),class:"add-modal","form-list":L},null,8,["model"])])),_:1},512),u("div",{class:"bottom-table w-full",style:D({height:"calc(100% - ".concat(k(Y),"px)")})},[d(r,{ref_key:"topTableRef",ref:m,searchParams:g.value,"onUpdate:searchParams":l[1]||(l[1]=e=>g.value=e),column:O,"show-row-selection":!1,"auto-generate-uuid":"","row-key":"screenId",scroll:{y:"auto"},"is-init-get-data":"",url:"/mes/BaseVppcissueplanodr/getModelList1",class:"h-50%","is-pagination":!1,onTableDataLoadSucess:F},{title:o((()=>l[7]||(l[7]=[u("span",{class:"color-#646cff"},"投料型号",-1)]))),_:1},8,["searchParams"]),d(r,{ref_key:"bottomTableRef",ref:H,searchParams:A.value,"onUpdate:searchParams":l[2]||(l[2]=e=>A.value=e),column:K,"show-row-selection":!1,"auto-generate-uuid":"","data-source":W.value,"row-key":"screenId",scroll:{y:"auto"},"is-init-get-data":"",url:"",class:"h-50%","is-pagination":!1},{title:o((()=>[l[9]||(l[9]=u("span",{class:"color-#646cff"},"投发板料",-1)),d(h,{type:"primary",class:"mini-btn ml-8px mr-8px",size:"small",ghost:"",onClick:te},{icon:o((()=>[d(k(_),{class:"align-sub"})])),default:o((()=>[l[8]||(l[8]=p(" 添加 "))])),_:1})])),"contextmenuPopup-orter":o((({args:e})=>[u("li",{class:"popup-item",onClick:a=>function(e){const a=e.index;W.value.splice(a,1),W.value.forEach(((e,a)=>{e.dataIndex=a+1})),W.value=[...W.value],e.hidePopup()}(e)},[d(y,{"local-icon":"delete",class:"text-16px"}),l[10]||(l[10]=p(" 删除 "))],8,oe)])),_:1},8,["searchParams","data-source"])],4)])),_:1}),d(P,{span:10,class:"h-full"},{default:o((()=>[d(T,{activeKey:z.value,"onUpdate:activeKey":l[3]||(l[3]=e=>z.value=e),type:"card",class:"my-tabs h-full"},{default:o((()=>[d(N,{key:"1","force-render":""},{tab:o((()=>l[11]||(l[11]=[u("span",null,[u("span",{class:"iconfont icon-gongchengzhishi"}),p(" 工程指示 ")],-1)]))),default:o((()=>[d(Z,{ref_key:"engineeringInstructionRef",ref:w,onEngineeringTableDataLoadSuccess:G,onEngineeringInstructionTableLoadSuccess:ee},null,512)])),_:1}),d(N,{key:"2","force-render":""},{tab:o((()=>l[12]||(l[12]=[u("span",null,[u("span",{class:"iconfont icon-gongchengtuzhi"}),p(" 开料图 ")],-1)]))),default:o((()=>[d(ae)])),_:1})])),_:1},8,["activeKey"])])),_:1}),d(U,{visible:V.value,"onUpdate:visible":l[5]||(l[5]=e=>V.value=e),"destroy-on-close":!0,centered:!0,width:"90vw",height:"85vh",mask:"","modal-warp-style":{padding:"5px"}},{title:o((()=>[u("div",ue,[l[13]||(l[13]=p(" 请选择要投放的板材 型号： ")),u("span",pe,Q(B.value.liaohao),1),l[14]||(l[14]=p(" 还可领数量： ")),u("span",he,Q(B.value.sheetQty),1)])])),footer:o((()=>[u("div",ye,[d(h,{onClick:l[4]||(l[4]=e=>V.value=!1)},{default:o((()=>l[15]||(l[15]=[p("关闭")]))),_:1}),d(h,{type:"primary",onClick:ie},{default:o((()=>l[16]||(l[16]=[p("确定")]))),_:1})])])),default:o((()=>[d(ce,{ref_key:"addSheetMetalRef",ref:le,"row-data":k(v),"engineering-table-data":J.value,"engineering-instruction-data":X.value,onSaveData:ne},null,8,["row-data","engineering-table-data","engineering-instruction-data"])])),_:1},8,["visible"])])),_:1})])}}},[["__scopeId","data-v-8bfd98df"]]),ve={class:"h-full min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},me={class:"top mb-0.5% h-59.5%"},ke={class:"bottom h-40%"},ge={class:"modal-footer"},we=v(Object.assign({name:"work-order-management_production-feed"},{__name:"index",setup(s){const h=i(null),[f,v]=U({moduleNo:null,time:[r().set("hour",0).set("minute",0).set("second",0).set("millisecond",0),r().set("hour",23).set("minute",29).set("second",59).set("millisecond",999)],isFinish:null}),m={"-1":"无ICS",0:"新录入",1:"更改",2:"待处理",3:"处理中",4:"暂停",5:"拒审",6:"反审核",7:"审核中",8:"生效",9:"完成",10:"取消",11:"外部ECN",12:"外部ECN处理中",13:"内部ECN处",19:"样板转生产",21:"改变",22:"待投料",23:"已投料",25:"失效",999:"系统完成",150331113231e4:"初审"};function g(e){return m[e]||""}function b(e){switch(Number(e)){case 0:return"#0080FF";case 1:return"#E1E100";case 2:return"#FF8000";case 3:return"#B15BFF";case 4:return"#73BF00";case 5:return"#8E8E8E";case 6:case 8:return"#BEBEBE";case 7:return"#FF0000";case 9:default:return"#0000FF";case 10:return"#007500";case 21:return"#FF4500";case 25:return"#00CED1"}}function P(e){switch(Number(e)){case 0:return"新录入";case 1:return"更改";case 2:return"待处理";case 3:return"处理中";case 4:return"暂停";case 5:return"回退";case 6:return"反审核";case 7:return"审核中";case 8:return"生效";case 9:return"完成";case 10:return"取消";case 11:return"外部ECN";case 12:return"外部ECN处理中";case 13:return"内部ECN处";case 21:return"改变";case 22:return"待投料";case 23:return"已投料";default:return""}}function D(e){switch(Number(e)){case 0:return"#0080FF";case 1:return"#E1E100";case 2:return"#FF8000";case 3:return"#B15BFF";case 4:return"#73BF00";case 5:return"#8E8E8E";case 6:case 8:return"#BEBEBE";case 7:return"#FF0000";case 9:default:return"#0000FF";case 10:return"#007500";case 21:return"#FF4500"}}const Q=[{type:"input",key:"moduleNo",label:"生产型号",span:6,placeholder:"请输入生产型号"},{type:"dateRangePicker",key:"time",label:"时间",span:9,showTime:!0},{type:"select",key:"isFinish",label:"是否投完",placeholder:"请选择是否投完",span:6,selectOptions:[{label:"是",value:0},{label:"否",value:1}]}],N=i(null),T=E(f),R=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"ppcState",dataIndex:"ppcState",title:"状态",align:"center",checked:!0,ellipsis:!0,width:70,customRender:({record:e})=>d("div",{style:{color:b(e.ppcState)},class:"h-full w-full font-800"},[g(e.ppcState)])},{key:"faState",dataIndex:"faState",title:"财务审核状态",align:"center",checked:!0,ellipsis:!0,width:120,customRender:({record:e})=>d("div",{style:{color:b(e.faState)},class:"h-full w-full font-800"},[g(e.faState)])},{key:"prodOrderNo",dataIndex:"prodOrderNo",title:"工单号",width:120,align:"center",checked:!0,ellipsis:!0},{key:"odrType",dataIndex:"odrType",title:"订单类型",width:120,align:"center",checked:!0,ellipsis:!0},{key:"liaohao",dataIndex:"liaohao",title:"生产型号",width:120,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>d("div",{class:"fonw-800 color-#646cff"},[e.liaohao])},{key:"odrProdType",dataIndex:"odrProdType",title:"加工类型",width:120,align:"center",checked:!0,ellipsis:!0},{key:"surfTrea1",dataIndex:"surfTrea1",title:"表面处理1",width:190,align:"center",checked:!0,ellipsis:!0},{key:"surfTrea2",dataIndex:"surfTrea2",title:"表面处理2",width:190,align:"center",checked:!0,ellipsis:!0},{key:"qty",dataIndex:"qty",title:"工单数量",width:120,align:"center",checked:!0,ellipsis:!0},{key:"prodOdrInvQty",dataIndex:"prodOdrInvQty",title:"使用库存",width:120,align:"center",checked:!0,ellipsis:!0},{key:"issueQty",dataIndex:"issueQty",title:"待投数量",width:120,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>e.qty-e.prodOdrInvQty-e.issPcsQty<0?0:e.qty-e.prodOdrInvQty-e.issPcsQty},{key:"issPcsQty",dataIndex:"issPcsQty",title:"已投料数量",width:120,align:"center",checked:!0,ellipsis:!0},{key:"invInQty",dataIndex:"invInQty",title:"入库数量",width:120,align:"center",checked:!0,ellipsis:!0},{key:"invOutQty",dataIndex:"invOutQty",title:"交货数量",width:120,align:"center",checked:!0,ellipsis:!0},{key:"invQty",dataIndex:"invQty",title:"库存数量",width:120,align:"center",checked:!0,ellipsis:!0},{key:"mktDate",dataIndex:"mktDate",title:"要求交期",width:160,align:"center",checked:!0,ellipsis:!0},{key:"ppcDate",dataIndex:"ppcDate",title:"答复交期",width:160,align:"center",checked:!0,ellipsis:!0},{key:"planDate",dataIndex:"planDate",title:"计划投料日期",width:160,align:"center",checked:!0,ellipsis:!0},{key:"prodType",dataIndex:"prodType",title:"产品类型",width:120,align:"center",checked:!0,ellipsis:!0},{key:"remark",dataIndex:"remark",title:"计划备注",width:120,align:"center",checked:!0,ellipsis:!0},{key:"remark1",dataIndex:"remark1",title:"评审备注",width:120,align:"center",checked:!0,ellipsis:!0},{key:"batchType",dataIndex:"batchType",title:"批次类型",width:120,align:"center",checked:!0,ellipsis:!0},{key:"pedifficulty",dataIndex:"pedifficulty",title:"难度系数",width:120,align:"center",checked:!0,ellipsis:!0},{key:"custNo",dataIndex:"custNo",title:"客户编码",width:120,align:"center",checked:!0,ellipsis:!0},{key:"custName",dataIndex:"custName",title:"客户名称",width:120,align:"center",checked:!0,ellipsis:!0},{key:"custProdNo",dataIndex:"custProdNo",title:"客户型号",width:120,align:"center",checked:!0,ellipsis:!0},{key:"sellType",dataIndex:"sellType",title:"销售方式",width:120,align:"center",checked:!0,ellipsis:!0},{key:"concerned",dataIndex:"concerned",title:"安全投产",width:120,align:"center",checked:!0,ellipsis:!0},{key:"createBy",dataIndex:"createBy",title:"创建者",width:120,align:"center",checked:!0,ellipsis:!0},{key:"createDate",dataIndex:"createDate",title:"创建日期",width:160,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>{r(e.createDate).format("YYYY-MM-DD HH:mm:ss")}},{key:"updateDate",dataIndex:"updateDate",title:"最后更改日期",width:160,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>{r(e.updateDate).format("YYYY-MM-DD HH:mm:ss")}}],F=i("1"),L=i(null),q=i(null),Y=i({}),O=i(null),j=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"state",dataIndex:"state",title:"状态",align:"center",checked:!0,ellipsis:!0,width:70,customRender:({record:e})=>d("div",{style:{color:D(Number(e.state))},class:"h-full w-full font-800"},[P(Number(e.state))])},{key:"issueNo",dataIndex:"issueNo",title:"投料单号",width:120,align:"center",checked:!0,ellipsis:!0},{key:"moduleNo",dataIndex:"moduleNo",title:"生产型号",width:120,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>d("div",{class:"fonw-800 color-#646cff"},[e.moduleNo])},{key:"custProdNo",dataIndex:"custProdNo",title:"客户型号",width:120,align:"center",checked:!0,ellipsis:!0},{key:"issueType",dataIndex:"issueType",title:"发料类型",width:120,align:"center",checked:!0,ellipsis:!0},{key:"workType",dataIndex:"workType",title:"工单类型",width:120,align:"center",checked:!0,ellipsis:!0},{key:"qty",dataIndex:"qty",title:"交货数量(PCS)",width:120,align:"center",checked:!0,ellipsis:!0},{key:"sheetQty",dataIndex:"sheetQty",title:"大料数量(Sheet)",width:120,align:"center",checked:!0,ellipsis:!0},{key:"lotQty",dataIndex:"lotQty",title:"PNL数量",width:120,align:"center",checked:!0,ellipsis:!0},{key:"invProvideQty",dataIndex:"invProvideQty",title:"使用库存数量(PCS)",width:160,align:"center",checked:!0,ellipsis:!0},{key:"issPcsQty",dataIndex:"issPcsQty",title:"发料数量(PCS)",width:120,align:"center",checked:!0,ellipsis:!0},{key:"scrapRete",dataIndex:"scrapRete",title:"预投料率",width:120,align:"center",checked:!0,ellipsis:!0},{key:"liveUint",dataIndex:"liveUint",title:"有效单元数量(PCS)",width:160,align:"center",checked:!0,ellipsis:!0},{key:"invUnit",dataIndex:"invUnit",title:"入库数量(PCS)",width:140,align:"center",checked:!0,ellipsis:!0},{key:"practicalLength",dataIndex:"practicalLength",title:"实开大料长(mm)",width:140,align:"center",checked:!0,ellipsis:!0},{key:"practicalWidth",dataIndex:"practicalWidth",title:"实开大料宽(mm)",width:140,align:"center",checked:!0,ellipsis:!0},{key:"weight",dataIndex:"weight",title:"单元重量",width:120,align:"center",checked:!0,ellipsis:!0},{key:"pcsarea",dataIndex:"pcsarea",title:"单元面积(sq.ft)",width:140,align:"center",checked:!0,ellipsis:!0},{key:"remark",dataIndex:"remark",title:"备注",width:120,align:"center",checked:!0,ellipsis:!0},{key:"createDate",dataIndex:"createDate",title:"发料日期",width:120,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>{r(e.createDate).format("YYYY-MM-DD HH:mm:ss")}},{key:"createBy",dataIndex:"createBy",title:"发料人员",width:120,align:"center",checked:!0,ellipsis:!0},{key:"autoCalc",dataIndex:"autoCalc",title:"自动计算",width:120,align:"center",checked:!0,ellipsis:!0}];function $(){N.value.getData()}function K(){v(),y((()=>{$()}))}const z=i(null);function W(e){z.value=B(e),Y.value.prodId=e.prodID,y((()=>{O.value.getData(),L.value.getData({prodNo:e.liaohao})}))}function J(e){e.length&&(N.value.setCurrentRowId(e[0]),W(e[0]))}const G=i(!1);function X(){G.value=!0}const Z=i(null);function ee(){const e=Z.value.saveData();var a;e&&Promise.all([(a=e.data,l({url:"/mes/BasePpcprodissue/insertBasePpcprodissue",method:"post",data:a})),H(e.list)]).then((([e,a])=>{e.error||a.error||(window.$message.success("保存成功"),$())})).finally((()=>{G.value=!1}))}function ae(){G.value=!1,Z.value.resetTopModel()}return(l,i)=>{const s=t,r=a,y=I,v=S,m=M,g=x,b=C,P=e;return n(),c("div",ve,[u("div",me,[d(g,{class:"h-full",gutter:16},{default:o((()=>[d(y,{span:16,class:"h-full min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},{default:o((()=>[d(s,{ref_key:"commonSearchRef",ref:h,searchParams:k(f),"onUpdate:searchParams":i[0]||(i[0]=e=>w(f)?f.value=e:null),"form-list":Q,onSearch:$,onReset:K},null,8,["searchParams"]),d(r,{ref_key:"topTableRef",ref:N,searchParams:k(T),"onUpdate:searchParams":i[1]||(i[1]=e=>w(T)?T.value=e:null),column:R,"show-row-selection":!1,"auto-generate-uuid":"","row-key":"screenId",scroll:{y:"auto"},"is-init-get-data":"",url:"/mes/BaseVppcissueplanodr/select",onTableRowClick:W,onTableDataLoadSucess:J},{title:o((()=>i[5]||(i[5]=[u("span",{class:"color-#646cff"},"生产工单",-1)]))),_:1},8,["searchParams"])])),_:1}),d(y,{class:"h-full",span:8},{default:o((()=>[d(m,{activeKey:F.value,"onUpdate:activeKey":i[2]||(i[2]=e=>F.value=e),type:"card",class:"my-tabs h-full"},{default:o((()=>[d(v,{key:"1","force-render":""},{tab:o((()=>i[6]||(i[6]=[u("span",null,[u("span",{class:"iconfont icon-jiaohuojihua"}),p(" 交货计划 ")],-1)]))),default:o((()=>[d(A,{ref_key:"deliveryScheduleRef",ref:q},null,512)])),_:1}),d(v,{key:"2","force-render":""},{tab:o((()=>i[7]||(i[7]=[u("span",null,[u("span",{class:"iconfont icon-gongchengwenjian"}),p(" 工程文件 ")],-1)]))),default:o((()=>[d(V,{ref_key:"engineeringDocumentRef",ref:L},null,512)])),_:1})])),_:1},8,["activeKey"])])),_:1})])),_:1})]),u("div",ke,[d(r,{ref_key:"bottomTableRef",ref:O,searchParams:Y.value,"onUpdate:searchParams":i[3]||(i[3]=e=>Y.value=e),class:"h-full",column:j,"show-row-selection":!1,"auto-generate-uuid":"","row-key":"screenId",scroll:{y:"auto"},"is-init-get-data":!1,"is-pagination":!1,url:"/mes/BasePpcprodissue/selectBasePpcprodissue"},{title:o((()=>[i[9]||(i[9]=u("span",{class:"mr15px color-#646cff"},"投产明细",-1)),d(b,{type:"primary",class:"mini-btn mr-8px",size:"small",ghost:"",disabled:!z.value,onClick:X},{icon:o((()=>[d(k(_),{class:"align-sub"})])),default:o((()=>[i[8]||(i[8]=p(" 添加 "))])),_:1},8,["disabled"])])),_:1},8,["searchParams"])]),d(P,{visible:G.value,"onUpdate:visible":i[4]||(i[4]=e=>G.value=e),"destroy-on-close":!0,centered:!0,title:"投料输入",width:"100%",height:"100vh","modal-warp-style":{padding:"5px"},onClose:ae},{footer:o((()=>[u("div",ge,[d(b,{onClick:ae},{default:o((()=>i[10]||(i[10]=[p("关闭")]))),_:1}),d(b,{type:"primary",onClick:ee},{default:o((()=>i[11]||(i[11]=[p("保存")]))),_:1})])])),default:o((()=>[d(fe,{ref_key:"addRef",ref:Z,"row-data":z.value},null,8,["row-data"])])),_:1},8,["visible"])])}}}),[["__scopeId","data-v-426d397e"]]);export{we as default};
