import{_ as e}from"./table-DoFSI9NT.js";import{_ as a}from"./round-edit-DZi1TDWc.js";import{_ as n}from"./round-add-MytOGm9O.js";import{_ as t}from"./common-search.vue_vue_type_script_setup_true_lang-BX9APgbN.js";import{g as i}from"./form-setup-CpeSHwGr.js";import{g as l,Y as o,Z as s,r as c,a0 as r,o as d,c as p,a1 as u,W as m,J as h,a2 as g,e as y,w as v,a3 as f,f as b,i as k,a4 as x,a5 as w,B as F}from"./index-B3PZsRwT.js";import{S as _}from"./SwapOutlined-WSjUvGaB.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import"./api-By23aosn.js";import"./index-BThgVJ70.js";var M={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372 0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884zm288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372 0 89-31.3 170.8-83.5 234.8z"}}]},name:"stop",theme:"outlined"};function O(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?Object(arguments[a]):{},t=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),t.forEach((function(a){I(e,a,n[a])}))}return e}function I(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}var j=function(e,a){var n=O({},e,a.attrs);return l(o,O({},n,{icon:M}),null)};j.displayName="StopOutlined",j.inheritAttrs=!1;const N=h({__name:"add",props:{operationType:{type:String,default:"add"},rowData:{type:Object,default:()=>null},formOptions:{type:Array,default:()=>[]}},setup(e,{expose:a}){const n=e,t=c(24);r((()=>n.operationType),(e=>{"add"===n.operationType?t.value=24:t.value=0}));const i=c(null),l=c([{type:"select",key:"form",label:"点检关联表单",placeholder:"请选择点检关联表单",span:24,search:!0,selectOptions:n.formOptions,change(e){o.value.inspectionFormId=n.formOptions.find((a=>a.value===e)).id}},{type:"input",key:"inspectionMachineName",label:"设备名称",placeholder:"请输入设备名称",span:"bindForm"===n.operationType?0:24,rule:{required:!0,message:"请输入设备名称",trigger:"change"}},{type:"input",key:"inspectionMachineCode",label:"设备编号",placeholder:"请输入设备编号",span:"bindForm"===n.operationType?0:24,rule:{required:!0,message:"请输入设备编号",trigger:"change"}},{type:"input",key:"inspectionMachineDept",label:"设备部门",placeholder:"请输入设备部门",span:"bindForm"===n.operationType?0:24,rule:{required:!0,message:"请输入设备部门",trigger:"change"}},{type:"input",key:"inspectionMachineNo",label:"设备机台号",placeholder:"请输入设备机台号",span:"bindForm"===n.operationType?0:24,rule:{required:!0,message:"请输入设备机台号",trigger:"change"}}]),o=c({...function(){const e={inspectionFormId:null};return l.value.forEach((a=>{var t,i;"form"===a.key?(null==(t=n.rowData)?void 0:t.inspectionFormId)?(e[a.key]=n.formOptions.find((e=>e.id===n.rowData.inspectionFormId)).value,e.inspectionFormId=n.rowData.inspectionFormId):e[a.key]=null:e[a.key]=(null==(i=n.rowData)?void 0:i[a.key])||null})),e}()});return a({model:o.value,validateForm:async function(){await i.value.validateForm()}}),(e,a)=>{const t=m;return d(),p(t,{ref_key:"formRef",ref:i,model:o.value,"onUpdate:model":a[0]||(a[0]=e=>o.value=e),"form-list":l.value,class:u("bindForm"===n.operationType?"bind-form":"add-form")},null,8,["model","form-list","class"])}}},[["__scopeId","data-v-caea178d"]]),C={class:"device-setup-page jl-main-page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},D=Object.assign({name:"check-inventory-manage_device-setup"},{__name:"index",setup(o){const r=c(null),u=c(null),m=c([]),h=c({form:null,inspectionMachineName:null,inspectionMachineNo:null,inspectionFormId:null,delFlag:"0"}),M=[{type:"select",key:"form",label:"关联表单",placeholder:"请输入关联表单",span:24,md:12,lg:5,xl:5,xxl:4,search:!0,selectOptions:m,change(e){h.value.inspectionFormId=m.value.find((a=>a.value===e)).id}},{type:"input",key:"inspectionMachineName",label:"设备名称",placeholder:"请输入设备名称",span:24,md:12,lg:5,xl:5,xxl:4},{type:"input",key:"inspectionMachineNo",label:"机台号",placeholder:"请输入机台号",span:24,md:12,lg:5,xl:5,xxl:4},{type:"select",key:"delFlag",label:"状态",placeholder:"请选择状态",span:24,clear:!1,md:12,lg:5,xl:5,xxl:4,selectOptions:[{label:"启用",value:"0"},{label:"禁用",value:"1"}],change(){I()}}],O=c([{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,fixed:"left",align:"center",checked:!0,ellipsis:!0},{key:"inspectionMachineName",dataIndex:"inspectionMachineName",title:"设备名称",align:"center",checked:!0,ellipsis:!0},{key:"inspectionMachineCode",dataIndex:"inspectionMachineCode",title:"设备编号",width:150,align:"center",checked:!0,ellipsis:!0},{key:"inspectionMachineDept",dataIndex:"inspectionMachineDept",title:"部门",width:150,align:"center",checked:!0,ellipsis:!0},{key:"inspectionMachineNo",dataIndex:"inspectionMachineNo",title:"机台号",width:150,align:"center",checked:!0,ellipsis:!0},{key:"inspectionFormName",dataIndex:"inspectionFormName",title:"关联表单",width:150,align:"center",checked:!0,ellipsis:!0},{key:"delFlag",dataIndex:"delFlag",title:"状态",width:100,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>l("span",{class:"0"===e.delFlag?"color-green":"color-red"},[["启用","禁用"][e.delFlag]])},{key:"createBy",dataIndex:"createBy",title:"创建人",width:100,align:"center",checked:!0,ellipsis:!0},{key:"createDate",dataIndex:"createDate",title:"创建时间",width:180,align:"center",checked:!0,ellipsis:!0},{key:"updateDate",dataIndex:"updateDate",title:"修改时间",width:180,align:"center",checked:!0,ellipsis:!0},{key:"updateBy",dataIndex:"updateBy",title:"修改人",width:100,align:"center",checked:!0,ellipsis:!0}]);function I(){u.value.getData(1)}function D(){w((()=>{h.value={inspectionMachineName:null},I()}))}!async function(){const{data:e,error:a}=await i();a||(m.value=e.map((e=>({...e,label:e.inspectionFormName,value:e.inspectionFormName}))))}();const S=c([]),T=c(null);function P(e){S.value=e}const z=c("add"),B=c(null),{handleShow:R,handleLoading:$,updateModalOptions:q,handleClose:A}=window.$useModal({modalOption:{title:"新增检查项",destroyOnClose:!0,height:"430px"},component:()=>l(N,{ref:B,operationType:z.value,"row-data":T.value,formOptions:m.value},null),onOk:async()=>{const e={...B.value};await e.validateForm(),$(!0);try{const a={...e.model};let n;"add"===z.value?n=await function(e){return s({url:"/inspection/inspectionform/insertMachine",method:"post",data:e})}(a):(a.id=T.value.id,n=await function(e){return s({url:"/inspection/inspectionform/updateMachine",method:"post",data:e})}(a));const{error:t}=await n;t||(window.$message.success("操作成功"),A(),I())}finally{$(!1)}}});function U(e){z.value=e,"edit"===e&&(q({title:"修改点检设备"}),T.value=S.value[0]),"add"===e&&(q({title:"新增点检设备"}),T.value=null),"bindForm"===e&&(q({title:"绑定表单"}),T.value=S.value[0]),R()}async function E(){const e="0"===h.value.delFlag?"禁用":"启用";S.value.length?window.$modal.confirm({title:"确认".concat(e,'设备名称为:"').concat(S.value.map((e=>e.inspectionMachineName)).join(","),'"吗?'),onOk:async()=>{const{error:a}=await("0"===h.value.delFlag?(n=[...S.value],s({url:"/inspection/inspectionform/deleteMachine",method:"post",data:n})):function(e){return s({url:"/inspection/inspectionform/startMachine",method:"post",data:e})}([...S.value]));var n;a||(window.$message.success("".concat(e,"成功")),h.value.delFlag="0"===h.value.delFlag?"1":"0",I())}}):window.$message.error("请选择需要".concat(e,"的设备!"))}return(i,o)=>{const s=t,c=n,m=F,w=a,N=e,T=g("hasAuth");return d(),y("div",C,[l(s,{ref_key:"commonSearchRef",ref:r,searchParams:h.value,"onUpdate:searchParams":o[0]||(o[0]=e=>h.value=e),"form-list":M,"is-search":!0,onSearch:I,onReset:D},null,8,["searchParams"]),l(N,{ref_key:"tableRef",ref:u,searchParams:h.value,"onUpdate:searchParams":o[4]||(o[4]=e=>h.value=e),column:O.value,"show-row-selection":!0,"row-key":"tableUuid",scroll:{y:"auto"},"is-init-get-data":"",url:"/inspection/inspectionform/selectMachines","auto-generate-uuid":!0,onTableSelectChange:P},{tableTitle:v((()=>[f((d(),p(m,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:o[1]||(o[1]=e=>U("add"))},{icon:v((()=>[l(c,{class:"align-sub text-icon"})])),default:v((()=>[o[5]||(o[5]=b("span",{class:"ml-3px"},"新增",-1))])),_:1})),[[T,["check-inventory-manage:device-setup:add"]]]),f((d(),p(m,{type:"primary",size:"small",disabled:1!==S.value.length,ghost:"",class:"mini-btn mr-8px",onClick:o[2]||(o[2]=e=>U("edit"))},{icon:v((()=>[l(w,{class:"align-sub text-icon"})])),default:v((()=>[o[6]||(o[6]=b("span",{class:"ml-3px"},"修改",-1))])),_:1},8,["disabled"])),[[T,["check-inventory-manage:device-setup:edit"]]]),"0"==h.value.delFlag?f((d(),p(m,{key:0,type:"primary",size:"small",danger:"",disabled:!S.value.length,ghost:"",class:"mini-btn mr-8px",onClick:E},{icon:v((()=>[l(k(j))])),default:v((()=>[o[7]||(o[7]=b("span",{class:"ml-3px"},"禁用",-1))])),_:1},8,["disabled"])),[[T,["check-inventory-manage:device-setup:change-status"]]]):f((d(),p(m,{key:1,type:"primary",size:"small",disabled:!S.value.length,ghost:"",class:"mini-btn mr-8px",onClick:E},{icon:v((()=>[l(k(x))])),default:v((()=>[o[8]||(o[8]=b("span",{class:"ml-3px"},"启用",-1))])),_:1},8,["disabled"])),[[T,["check-inventory-manage:device-setup:change-status"]]]),f((d(),p(m,{type:"primary",size:"small",disabled:1!==S.value.length,ghost:"",class:"mini-btn mr-8px",onClick:o[3]||(o[3]=e=>U("bindForm"))},{icon:v((()=>[l(k(_))])),default:v((()=>[o[9]||(o[9]=b("span",{class:"ml-3px"},"绑定表单",-1))])),_:1},8,["disabled"])),[[T,["check-inventory-manage:device-setup:bind-form"]]])])),_:1},8,["searchParams","column"])])}}});export{D as default};
