import{_ as e}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import{d as a,K as l,L as t,r as s,q as n,n as o,o as i,c as r,w as c,g as d,f as u,s as m,t as p,I as f,v,N as h,O as g,B as x,P as w,Q as _,F as y,ae as b,U as k,p as C,a9 as I,b as P,S as j,e as R,J as L}from"./index-B3PZsRwT.js";import{g as N,p as S}from"./api-By23aosn.js";import{_ as U}from"./modal.vue_vue_type_style_index_0_lang-Gjmj9w7c.js";import{C as $}from"./index-BThgVJ70.js";const q={class:"w-full flex"},z={class:"flex"},D={class:"w-full flex-y-center justify-end gap-12px"},O={class:"ml-3px"},F={class:"ml-3px"},A=a({__name:"search",props:{model:{required:!0},modelModifiers:{}},emits:l(["search","handleReturnPIN"],["update:model"]),setup(e,{emit:a}){const l=a,k=t(e,"model");function C(){l("search",k.value)}function I(){k.value={materiel:"",status:""},l("search",k.value)}const P=s(0),j=s(!1),R=s({eqpPositionList:[]}),{createRequiredRule:L}=n(),{formRef:N,validate:S,resetFields:A}=o(),B={eqpPositionList:L("不能为空")};async function K(){await S()}function E(){R.value.upPinList=null}function J(){l("handleReturnPIN")}return(e,a)=>{const l=f,t=v,s=h,n=g,o=x,L=w,S=_,A=y,M=b,Q=$;return i(),r(Q,{title:null,bordered:!1,class:"search-card card-wrapper"},{default:c((()=>[d(A,{ref_key:"formRef",ref:N,model:k.value,"label-col":{span:5,md:7},class:"search-form"},{default:c((()=>[u("div",q,[d(S,{gutter:[15,8],wrap:"",class:"w-full"},{default:c((()=>[d(s,{span:24,md:12,lg:6,xl:6,xxl:6},{default:c((()=>[d(t,{label:"料号",name:"materiel",class:"m-0","label-col":{}},{default:c((()=>[d(l,{value:k.value.materiel,"onUpdate:value":a[0]||(a[0]=e=>k.value.materiel=e),placeholder:"请输入料号",class:"min-form-control","allow-clear":"",autocomplete:"off",onKeypress:m(C,["enter"])},null,8,["value"])])),_:1})])),_:1}),u("div",z,[d(t,{class:"m-0"},{default:c((()=>[u("div",D,[d(o,{type:"primary",ghost:"",class:"mini-btn",onClick:C},{icon:c((()=>[d(n,{class:"align-sub text-icon"})])),default:c((()=>[u("span",O,p(e.$t("common.search")),1)])),_:1}),d(o,{class:"mini-btn",onClick:I},{icon:c((()=>[d(L,{class:"align-sub text-icon"})])),default:c((()=>[u("span",F,p(e.$t("common.reset")),1)])),_:1}),d(o,{type:"primary",ghost:"",class:"mini-btn",onClick:J},{default:c((()=>a[3]||(a[3]=[u("span",{class:"ml-3px"},"一键退PIN",-1)]))),_:1})])])),_:1})])])),_:1})])])),_:1},8,["model"]),d(U,{visible:j.value,"onUpdate:visible":a[2]||(a[2]=e=>j.value=e),title:0==P.value?"批量退PIN取料":"批量反空托",width:"500px",height:"193px","destroy-on-close":"",onOk:K,onClose:E},{default:c((()=>[d(A,{ref_key:"formRef",ref:N,model:R.value,rules:B,class:"search-form"},{default:c((()=>[d(t,{label:"工位位置",name:"upPinList",class:"m-0","label-col":{}},{default:c((()=>[d(M,{value:R.value.upPinList,"onUpdate:value":a[1]||(a[1]=e=>R.value.upPinList=e),placeholder:"请选择工位位置",mode:"multiple","allow-clear":""},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])])),_:1})}}}),B={class:"jl-main-page one-code-ascend min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},K=L(a({name:"intelligent-iogistics_list-materials-drilled-machine",__name:"index",setup(a){k((e=>({"400dd666":b.value})));const l=s({materiel:null}),t=C({current:1,pageSize:200,showSizeChanger:!0,pageSizeOptions:["50","100","200","300","500"],showQuickJumper:!0,showTotal:e=>"共".concat(e,"条"),total:0,onChange:async(e,a)=>{t.current=e,t.pageSize=a,f()}}),n=s([]),o=s(!1),r=s([{key:"index",dataIndex:"index",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"podCode",dataIndex:"podCode",title:"货架编号",align:"center",checked:!0,ellipsis:!0},{key:"materialLot",dataIndex:"materialLot",title:"物料批次",align:"center",checked:!0,ellipsis:!0},{key:"positionCode",dataIndex:"positionCode",title:"位置编号",align:"center",checked:!0,ellipsis:!0},{key:"areaCode",dataIndex:"areaCode",title:"区域编号",align:"center",checked:!0,ellipsis:!0},{key:"mapDataCode",dataIndex:"mapDataCode",title:"地码编号",align:"center",checked:!0,ellipsis:!0},{key:"bindDate",dataIndex:"bindDate",title:"上架时间",align:"center",checked:!0,ellipsis:!0}]);function m(){p()}function p(){t.current=1,f()}function f(){o.value=!0,N("/mes/jlagv/machine/woker/selectDownPinMateriel?materiel=".concat(l.value.materiel)).then((({data:e,error:a})=>{a||(e.forEach(((e,a)=>{e.index=a+1})),n.value=e)})).finally((()=>o.value=!1))}f();const v=s(null),h=e=>({style:{background:e.id===v.value?"#BAEAFA":"",backgroundColor:0===Number(e.timeOutFlag)?"rgb(244, 56, 56)":""},class:"".concat(e.positionCode===v.value?"jl-table-row-selected":""),onClick:()=>{v.value=e.positionCode}}),g=s([]);function x(e){g.value=e}function w(){var e,a,l;return 0==g.value.length?null==(e=window.$message)?void 0:e.error("请选择数据!"):g.value.length>20?null==(a=window.$message)?void 0:a.error("不能一次性超过20条!"):void(null==(l=window.$modal)||l.confirm({title:"是否进行一键退PIN?",onOk:()=>{S("/mes/jlagv/machine/woker/downPinBatch",g.value).then((({data:e,error:a})=>{var l;a||(null==(l=window.$message)||l.success("操作成功!"),g.value=[],f())}))},onCancel:()=>{}}))}const _=s(null),{height:y}=I(_),b=P((()=>"".concat(y.value+20,"px")));return(a,s)=>{const f=e,v=j("STable"),_=$;return i(),R("div",B,[d(A,{model:l.value,"onUpdate:model":s[0]||(s[0]=e=>l.value=e),onReset:m,onSearch:p,onHandleReturnPIN:w},null,8,["model"]),d(_,{bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"table-card flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:c((()=>[d(f,{columns:r.value,"onUpdate:columns":s[1]||(s[1]=e=>r.value=e)},null,8,["columns"])])),default:c((()=>[d(v,{"row-selection":{selectedRowKeys:g.value,onChange:x},columns:r.value,"data-source":n.value,bordered:"",size:"small",loading:o.value,"row-key":"positionCode",pagination:t,"custom-row":h,scroll:{y:"auto"},"row-height":23,class:"has-footer-table h-full"},{footer:c((()=>s[2]||(s[2]=[u("div",{style:{display:"flex","align-items":"center"}},[u("div",{style:{width:"20px",height:"14px","background-color":"rgba(244, 56, 56)"}}),u("span",null,"背景为物料上架时间超过8小时")],-1)]))),_:1},8,["row-selection","columns","data-source","loading","pagination"])])),_:1})])}}}),[["__scopeId","data-v-e07a8d1e"]]);export{K as default};
