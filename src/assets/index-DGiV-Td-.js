import{_ as e}from"./table-DoFSI9NT.js";import{_ as l}from"./common-search.vue_vue_type_script_setup_true_lang-BX9APgbN.js";import{r as t,o as a,e as n,g as d,i,V as o,a9 as s,h as c,a$ as r,w as u,W as p,da as h,S as y,X as k,f as m,t as w,a5 as g,a7 as f,B as b,J as v}from"./index-B3PZsRwT.js";import{u as x}from"./resetTableRef-DZjcvemm.js";import{a as I,g as N,b as P}from"./interior-ecn-is1Hg8_6.js";import{_}from"./modal.vue_vue_type_style_index_0_lang-Gjmj9w7c.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import"./api-By23aosn.js";import"./index-BThgVJ70.js";const S={class:"h-full w-full flex-col-stretch gap-8px overflow-hidden lt-sm:overflow-auto"},C={__name:"search-module-no",setup(s,{expose:c}){const[r,u]=x({moduleNo:null,custProdNo:null,custAb:null}),p=[{type:"input",key:"moduleNo",label:"生产型号",span:6,placeholder:"请输入生产型号"},{type:"input",key:"custProdNo",label:"客户型号",span:6,placeholder:"请输入客户型号"},{type:"input",key:"custAb",label:"客户名称",span:6,placeholder:"请输入客户名称"}],h=t(null),y=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"moduleNo",dataIndex:"moduleNo",title:"生产型号",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>d("span",{class:"fonw-800 color-#646cff"},[e.moduleNo])},{key:"custProdNo",dataIndex:"custProdNo",title:"客户型号",align:"center",checked:!0,ellipsis:!0},{key:"peType",dataIndex:"peType",title:"类型",align:"center",checked:!0,ellipsis:!0,width:100},{key:"custAB",dataIndex:"custAB",title:"客户名称",align:"center",checked:!0,ellipsis:!0,width:160}],k=t(null);function m(e){k.value=e[0]}function w(){h.value.getData()}function g(){u(),w()}return c({getSelectRow:function(){return k.value}}),(t,s)=>{const c=l,u=e;return a(),n("div",S,[d(c,{searchParams:i(r),"onUpdate:searchParams":s[0]||(s[0]=e=>o(r)?r.value=e:null),"form-list":p,onSearch:w,onReset:g},null,8,["searchParams"]),d(u,{ref_key:"tableRef",ref:h,searchParams:i(r),"onUpdate:searchParams":s[1]||(s[1]=e=>o(r)?r.value=e:null),column:y,"show-row-selection":!0,"row-key":"ECNno",scroll:{y:"auto"},"is-init-get-data":!1,url:"/erpsyncmes/Mi/findModuleNo","auto-generate-uuid":!0,class:"h-full","row-selection-type":"radio",onTableSelectChange:m},null,8,["searchParams"])])}}},T={class:"h-full w-full"},R={__name:"add",setup(e,{expose:l}){const i=t(0),o=t(null);s(o);const h=t({moduleNo:null,fullProdNo:null,newCustProdNo:null,custProdNo:null,newSameModuleNo:null,surfTrea1:null,newSurfTrea1:null,custProdName:null,effectiveTiming:null,pnType:!1,customerCheck:!1,changeReason:[],otherReason:null,oldDataDeal:null,inventoryDealMethod:null,nowboardDealMethod:null}),y=[{type:"input",key:"moduleNo",label:"生产型号",placeholder:"请输入生产型号",span:12,readonly:!0},{type:"input",key:"fullProdNo",label:"新生产型号",placeholder:"请输入生产型号",span:12,disabled:!0},{type:"input",key:"custProdNo",label:"客户型号",disabled:!0,placeholder:"",span:12},{type:"input",key:"newCustProdNo",label:"新客户型号",disabled:!0,placeholder:"",span:12},{type:"input",key:"sameModuleNo",label:"同等型号",disabled:!0,placeholder:"",span:12},{type:"input",key:"newSameModuleNo",label:"新同等型号",placeholder:"",span:12},{type:"input",key:"surfTrea1",label:"旧型号特性",disabled:!0,placeholder:"",span:12},{type:"dictionary",dictCode:"model_characteristics",useGrid:!0,selectType:"select",key:"newSurfTrea1",label:"新同等型号特性",placeholder:"请选择新同等型号特性",span:12,showSearch:!0},{type:"input",key:"custProdName",label:"客户名称",disabled:!0,placeholder:"",span:12},{type:"select",key:"effectiveTiming",label:"生效时间",placeholder:"请选择生效时间",selectOptions:[{label:"立即生效",value:"立即生效"},{label:"下批订单",value:"下批订单"},{label:"其他",value:"其他"}],rule:{required:!0,message:"请选择生效时间",trigger:"blur"},span:12},{type:"customRender",span:12,customRender:d("div",null,[d("span",{class:"text-16px color-red font-800"},[c("样品转量产：")]),d(r,{value:h.value.pnType,"onUpdate:value":e=>h.value.pnType=e,onChange:e=>{h.value.pnType=e.target.checked}},null)])},{type:"customRender",span:12,customRender:d("div",null,[d("span",null,[c("客户确认：")]),d(r,{value:h.value.customerCheck,"onUpdate:value":e=>h.value.customerCheck=e,onChange:e=>{h.value.customerCheck=e.target.checked}},null)])},{type:"dictionary",key:"changeReason",label:"变更原因",dictCode:"ecn_change_reason",useGrid:!0,selectType:"checkbox",placeholder:"请选择变更原因",span:24,change:e=>{e.includes("其他")?i.value=24:(h.value.otherReason=null,i.value=0)}},{type:"textarea",key:"otherReason",label:"其他原因",span:i,placeholder:""},{type:"select",key:"oldDataDeal",label:"旧资料处理",placeholder:"请选择旧资料处理",placeholder:"",selectOptions:[{label:"报废",value:"报废"},{label:"共存",value:"共存"}],span:12},{type:"select",key:"inventoryDealMethod",label:"库存板处理方法",placeholder:"请选择库存板处理方法",placeholder:"",selectOptions:[{label:"可出货",value:"可出货"},{label:"无库存",value:"无库存"},{label:"报废",value:"报废"},{label:"下旧版本订单吸收",value:"下旧版本订单吸收"},{label:"分开包装用新订单出货",value:"分开包装用新订单出货"},{label:"待客户确认",value:"待客户确认"}],span:12},{type:"select",key:"nowboardDealMethod",label:"在线板处理方法",placeholder:"",selectOptions:[{label:"暂停待通知",value:"暂停待通知"},{label:"报废处理",value:"报废处理"},{label:"返工",value:"返工"},{label:"特采出货",value:"特采出货"},{label:"无在线板",value:"无在线板"},{label:"在线板正常生产",value:"在线板正常生产"},{label:"在线板按新资料",value:"在线板按新资料"}],placeholder:"请选择在线板处理方法",rule:{required:!0,message:"请选择在线板处理方法",trigger:"blur"},span:12}];t(null),t({});const k=t(!1),m=t(null),w=t(null);function g(){const e=m.value.getSelectRow();if(w.value=e,e){let l;h.value.moduleNo=e.moduleNo;let t=null;h.value.moduleNo.includes("-")?(t=h.value.moduleNo.split("-")[1],l=h.value.moduleNo.split("-")[0].split("")):l=h.value.moduleNo.split(""),l[l.length-1]=Number(l[l.length-1])+1,h.value.fullProdNo="".concat(l.join("")).concat(t?"-".concat(t):""),h.value.custProdNo=e.custProdNo,h.value.newCustProdNo=e.custProdNo,h.value.sameModuleNo=e.sameModuleNo,h.value.newSameModuleNo=e.sameModuleNo,h.value.surfTrea1=e.surfTrea1,h.value.newSurfTrea1=e.surfTrea1,h.value.custProdName=e.custAB,k.value=!1}}return l({model:h.value,validateForm:async function(){await o.value.validateForm()}}),(e,l)=>{const t=p,i=_;return a(),n("div",T,[d(t,{ref_key:"formRef",ref:o,model:h.value,"onUpdate:model":l[0]||(l[0]=e=>h.value=e),"form-list":y},null,8,["model"]),d(i,{visible:k.value,"onUpdate:visible":l[1]||(l[1]=e=>k.value=e),"destroy-on-close":!0,centered:!0,title:"查询生产型号",width:"1100px",height:"80vh","modal-warp-style":{padding:"5px"},mask:"",onOk:g},{default:u((()=>[d(C,{ref_key:"searchModuleNoRef",ref:m},null,512)])),_:1},8,["visible"])])}}},D={class:"h-full w-full flex-col-stretch gap-8px overflow-hidden lt-sm:overflow-auto"},M={class:"bottom mb-0.5% h-39.8%"},Q={class:"bottom-left bottom-table h-full"},U={class:"bottom-right bottom-table h-full"},j=v(Object.assign({name:"engineering-manage_interior-ecn"},{__name:"index",setup(s){const r=t(null),[p,v]=x({moduleNo:null}),_=window.$useModal,S=[{type:"input",key:"moduleNo",label:"新生产型号",span:24,md:12,lg:8,xl:8,xxl:4,placeholder:"请输入新生产型号"}],C=t(null),T=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"oldModuleNo",dataIndex:"oldModuleNo",title:"生产型号",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>d("span",{class:"fonw-800 color-red"},[e.oldModuleNo])},{key:"newModuleNo",dataIndex:"newModuleNo",title:"新生产型号",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>d("span",{class:"fonw-800 color-#646cff"},[e.newModuleNo])},{key:"newCustProdNo",dataIndex:"newCustProdNo",title:"新客户型号",align:"center",checked:!0,ellipsis:!0,width:160},{key:"newSameModuleNo",dataIndex:"newSameModuleNo",title:"新同等型号",align:"center",checked:!0,ellipsis:!0,width:160},{key:"newSurfTrea1",dataIndex:"newSurfTrea1",title:"新型号特性",align:"center",checked:!0,ellipsis:!0,width:140},{key:"effectiveTiming",dataIndex:"effectiveTiming",title:"生效时间",align:"center",checked:!0,ellipsis:!0,width:140},{key:"customerCheck",dataIndex:"customerCheck",title:"客户确认",align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>"1"===e.customerCheck?"已确认":"",width:120},{key:"oldDataDeal",dataIndex:"oldDataDeal",title:"旧资料处理方法",align:"center",checked:!0,ellipsis:!0,width:160},{key:"nowboardDealMethod",dataIndex:"nowboardDealMethod",title:"在线板处理方法",align:"center",checked:!0,ellipsis:!0,width:160},{key:"inventoryDealMethod",dataIndex:"inventoryDealMethod",title:"库存板处理方法",align:"center",checked:!0,ellipsis:!0,width:160},{key:"changeReason",dataIndex:"changeReason",title:"变更原因",align:"center",checked:!0,ellipsis:!0,width:160},{key:"otherReason",dataIndex:"otherReason",title:"其他原因",align:"center",checked:!0,ellipsis:!0,width:160},{key:"createBy",dataIndex:"createBy",title:"创建人",align:"center",checked:!0,ellipsis:!0,width:140},{key:"createDate",dataIndex:"createDate",title:"创建时间",align:"center",checked:!0,ellipsis:!0,width:160}],j=t(null),O=t({prodId:null}),B=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"techName",dataIndex:"techName",title:"工艺名称",align:"center",checked:!0,ellipsis:!0,width:120},{key:"repeatCount",dataIndex:"repeatCount",title:"工步",align:"center",checked:!0,ellipsis:!0,width:120},{key:"wipPnlQty",dataIndex:"wipPnlQty",title:"PNL结存",align:"center",checked:!0,ellipsis:!0,width:120},{key:"wipSetQty",dataIndex:"wipSetQty",title:"SET结存",align:"center",checked:!0,ellipsis:!0,width:120},{key:"wipscrapSet",dataIndex:"wipscrapSet",title:"含废SET",align:"center",checked:!0,ellipsis:!0,width:120},{key:"wipscrapPcs",dataIndex:"wipscrapPcs",title:"含废PCS",align:"center",checked:!0,ellipsis:!0,width:120},{key:"wippcsQty",dataIndex:"wippcsQty",title:"有效PCS",align:"center",checked:!0,ellipsis:!0,width:120},{key:"applyScrapQty",dataIndex:"applyScrapQty",title:"报废申请",align:"center",checked:!0,ellipsis:!0,width:120},{key:"applyReworkQty",dataIndex:"applyReworkQty",title:"重工申请",align:"center",checked:!0,ellipsis:!0,width:120},{key:"assitQty",dataIndex:"assitQty",title:"外发数",align:"center",checked:!0,ellipsis:!0,width:120},{key:"holdPcsQty",dataIndex:"holdPcsQty",title:"暂停PCS数",align:"center",checked:!0,ellipsis:!0,width:120},{key:"iqcPcsQty",dataIndex:"iqcPcsQty",title:"IQC数量",align:"center",checked:!0,ellipsis:!0,width:120},{key:"delayDate",dataIndex:"delayDate",title:"结存小时",align:"center",checked:!0,ellipsis:!0,width:120}],E=t(null),{handleClose:A,handleLoading:q,handleShow:L}=_({modalOption:{title:"新增",destroyOnClose:!0,width:"800px",height:"600px"},component:()=>d(R,{ref:E},null),onOk:async()=>{var e;const l={...E.value},t=h(l.model);t.changeReason=(null==(e=null==t?void 0:t.changeReason)?void 0:e.join(","))||null,t.customerCheck=t.customerCheck?"1":"0",t.pnType=t.pnType?"量产":null,await l.validateForm(),q(!0),I({...t}).then((({error:e})=>{e||(window.$message.success("操作成功"),A(),Z())})).finally((()=>{q(!1)}))}});const W=t([]);function F(e){W.value=e}const $=t([]);function G(e){g((()=>{N(e.oldModuleNo).then((({data:e,error:l})=>{var t;l||(null==(t=null==e?void 0:e.list)?void 0:t.length)&&(O.value.prodId=e.list[0].prodId,V.value=!0,P({prodId:O.value.prodId}).then((({data:e,error:l})=>{l?$.value=[]:(e.pubtechnology.forEach(((e,l)=>{e.dataIndex=l+1,e.tableUuid=f.genV4().hexNoDelim})),$.value=e.pubtechnology)})).finally((()=>{V.value=!1})))}))}))}const V=t(!1);function z(e){(null==e?void 0:e.length)&&(C.value.setCurrentRowId(e[0]),g((()=>G(e[0]))))}const J=t(null),X=t({prodId:null,techId:null}),H=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"wipState",dataIndex:"wipState",title:"结存状态",align:"center",checked:!0,ellipsis:!0,width:120},{key:"barCode",dataIndex:"barCode",title:"批卡号",align:"center",checked:!0,ellipsis:!0,width:180},{key:"prodOrderNo",dataIndex:"prodOrderNo",title:"工单号",align:"center",checked:!0,ellipsis:!0,width:180},{key:"custDateCode",dataIndex:"custDateCode",title:"客户周期",align:"center",checked:!0,ellipsis:!0,width:180},{key:"dateCode",dataIndex:"dateCode",title:"厂内周期",align:"center",checked:!0,ellipsis:!0,width:180},{key:"wipUnit",dataIndex:"wipUnit",title:"结存单位",align:"center",checked:!0,ellipsis:!0,width:120},{key:"wipQty",dataIndex:"wipQty",title:"结存数量",align:"center",checked:!0,ellipsis:!0,width:120},{key:"wipScrapSet",dataIndex:"wipScrapSet",title:"结存报废SET",align:"center",checked:!0,ellipsis:!0,width:120},{key:"wipScrapPcs",dataIndex:"wipScrapPcs",title:"结存报废PCS",align:"center",checked:!0,ellipsis:!0,width:120},{key:"outUnit",dataIndex:"outUnit",title:"出账单位",align:"center",checked:!0,ellipsis:!0,width:120},{key:"outQty",dataIndex:"outQty",title:"出账数",align:"center",checked:!0,ellipsis:!0,width:120},{key:"outScrapSet",dataIndex:"outScrapSet",title:"出账报废SET",align:"center",checked:!0,ellipsis:!0,width:120},{key:"outScrapPcs",dataIndex:"outScrapPcs",title:"出账报废PCS",align:"center",checked:!0,ellipsis:!0,width:120},{key:"workingQty",dataIndex:"workingQty",title:"在产数量",align:"center",checked:!0,ellipsis:!0,width:120},{key:"finishQty",dataIndex:"finishQty",title:"完成数量",align:"center",checked:!0,ellipsis:!0,width:120},{key:"workDate",dataIndex:"workDate",title:"生产时间",align:"center",checked:!0,ellipsis:!0,width:120},{key:"finishDate",dataIndex:"finishDate",title:"完成时间",align:"center",checked:!0,ellipsis:!0,width:120},{key:"scrapUnit",dataIndex:"scrapUnit",title:"申请单位",align:"center",checked:!0,ellipsis:!0,width:120},{key:"scrapQty",dataIndex:"scrapQty",title:"申请数量",align:"center",checked:!0,ellipsis:!0,width:120},{key:"inDate",dataIndex:"inDate",title:"入账时间",align:"center",checked:!0,ellipsis:!0,width:120},{key:"workDays",dataIndex:"workDays",title:"生产时长",align:"center",checked:!0,ellipsis:!0,width:120},{key:"qty",dataIndex:"qty",title:"批卡数量",align:"center",checked:!0,ellipsis:!0,width:120},{key:"unit",dataIndex:"unit",title:"批卡单位",align:"center",checked:!0,ellipsis:!0,width:120},{key:"weight",dataIndex:"weight",title:"单重",align:"center",checked:!0,ellipsis:!0,width:120},{key:"createBy",dataIndex:"createBy",title:"入账员",align:"center",checked:!0,ellipsis:!0,width:120}];function K(e){X.value={prodId:e.prodId,techId:e.techId},g((()=>{J.value.getData()}))}function Y(e){(null==e?void 0:e.length)&&(j.value.setCurrentRowId(e[0]),K(e[0]))}function Z(){C.value.getData()}function ee(){v(),Z()}return(t,s)=>{const h=l,g=b,f=e,v=y("STableSummaryCell"),x=y("STableSummaryRow");return a(),n("div",D,[d(h,{ref_key:"commonSearchRef",ref:r,searchParams:i(p),"onUpdate:searchParams":s[0]||(s[0]=e=>o(p)?p.value=e:null),"form-list":S,onSearch:Z,onReset:ee},null,8,["searchParams"]),d(f,{ref_key:"topTableRef",ref:C,searchParams:i(p),"onUpdate:searchParams":s[2]||(s[2]=e=>o(p)?p.value=e:null),column:T,"show-row-selection":!1,"row-key":"ECNno",scroll:{y:"auto"},"is-init-get-data":"",url:"/erpsyncmes/Ecn/findModuleNo","auto-generate-uuid":!0,class:"top mb-0.5% h-60%",onTableRowClick:G,onTableDataLoadSucess:z,onTableSelectChange:F},{title:u((()=>[d(g,{type:"primary",class:"mini-btn mr-8px",size:"small",ghost:"",onClick:s[1]||(s[1]=e=>{L()})},{icon:u((()=>[d(i(k),{class:"align-sub"})])),default:u((()=>[s[5]||(s[5]=c(" 新增 "))])),_:1})])),_:1},8,["searchParams"]),m("div",M,[m("div",Q,[d(f,{ref_key:"bottomLeftTableRef",ref:j,searchParams:O.value,"onUpdate:searchParams":s[3]||(s[3]=e=>O.value=e),column:B,"show-row-selection":!1,"row-key":"tableUuid",scroll:{y:"auto"},"is-init-get-data":"",loading:V.value,"data-source":$.value,url:"/erpsyncmes/wip/selectWipPubtechnology","auto-generate-uuid":!1,class:"h-full","is-pagination":!1,"summary-fixed":"",onTableRowClick:K,onTableDataLoadSucess:Y},{title:u((()=>s[6]||(s[6]=[m("span",{class:"mr15px color-#646cff"},"WIP结存",-1)]))),summary:u((()=>[d(x,null,{default:u((()=>[d(v,{index:0,"col-span":2,class:"text-center color-blue-600 font-bold"},{default:u((()=>s[7]||(s[7]=[c(" 本页合计: ")]))),_:1}),d(v,{index:2,class:"text-center color-blue-600 font-bold"}),d(v,{index:3,class:"text-center color-blue-600 font-bold"},{default:u((({total:e})=>[c(w(Number(e)||""),1)])),_:1}),d(v,{index:4,class:"text-center color-blue-600 font-bold"},{default:u((({total:e})=>[c(w(Number(e)||""),1)])),_:1}),d(v,{index:5,class:"text-center color-blue-600 font-bold"},{default:u((({total:e})=>[c(w(Number(e)||""),1)])),_:1}),d(v,{index:6,class:"text-center color-blue-600 font-bold"},{default:u((({total:e})=>[c(w(Number(e)||""),1)])),_:1}),d(v,{index:7,class:"text-center color-blue-600 font-bold"},{default:u((({total:e})=>[c(w(Number(e)||""),1)])),_:1}),d(v,{index:8,class:"text-center color-blue-600 font-bold"},{default:u((({total:e})=>[c(w(Number(e)||""),1)])),_:1}),d(v,{index:9,class:"text-center color-blue-600 font-bold"},{default:u((({total:e})=>[c(w(Number(e)||""),1)])),_:1}),d(v,{index:10,class:"text-center color-blue-600 font-bold"},{default:u((({total:e})=>[c(w(Number(e)||""),1)])),_:1}),d(v,{index:11,class:"text-center color-blue-600 font-bold"},{default:u((({total:e})=>[c(w(Number(e)||""),1)])),_:1}),d(v,{index:12,class:"text-center color-blue-600 font-bold"},{default:u((({total:e})=>[c(w(Number(e)||""),1)])),_:1})])),_:1})])),_:1},8,["searchParams","loading","data-source"])]),m("div",U,[d(f,{ref_key:"bottomRightTableRef",ref:J,searchParams:X.value,"onUpdate:searchParams":s[4]||(s[4]=e=>X.value=e),column:H,"show-row-selection":!1,scroll:{y:"auto"},"is-init-get-data":!1,url:"/erpsyncmes/wip/selectWipByProdIdAndTechId","auto-generate-uuid":!0,class:"h-full","is-pagination":!1},null,8,["searchParams"])])])])}}}),[["__scopeId","data-v-7aee4445"]]);export{j as default};
