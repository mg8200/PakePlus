import{_ as e}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import{d as a,K as l,L as t,o as n,c as i,w as s,g as r,f as o,s as u,h as d,t as c,I as p,v as m,N as v,ad as f,ae as g,O as h,B as y,P as w,Q as x,F as b,U as k,r as _,p as T,db as C,a9 as S,b as I,S as $,e as R,a6 as U,W as N,J as z}from"./index-B3PZsRwT.js";import{Q as B,R as P,S as j,T as O,U as L,V as E,W as A,X as q,Y as D}from"./index-DqnulfE2.js";import{_ as F}from"./modal.vue_vue_type_style_index_0_lang-Gjmj9w7c.js";import{C as K}from"./index-BThgVJ70.js";const Q={class:"w-full flex"},W={class:"flex"},J={class:"w-full flex-y-center justify-end gap-12px"},M={class:"ml-3px"},V={class:"ml-3px"},X=a({__name:"search",props:{model:{required:!0},modelModifiers:{}},emits:l(["search","reset"],["update:model"]),setup(e,{emit:a}){const l=a,k=t(e,"model");function _(){l("search",k.value)}function T(){k.value.supplierName=null,k.value.state=null,k.value.auditingState=null,l("reset",k.value)}return(e,a)=>{const l=p,t=m,C=v,S=f,I=g,$=h,R=y,U=w,N=x,z=b,B=K;return n(),i(B,{title:null,bordered:!1,class:"search-card card-wrapper"},{default:s((()=>[r(z,{model:k.value,"label-col":{span:5,md:7},class:"search-form"},{default:s((()=>[o("div",Q,[r(N,{gutter:[15,8],wrap:"",class:"w-full"},{default:s((()=>[r(C,{span:24,md:12,lg:6,xl:8,xxl:4},{default:s((()=>[r(t,{label:"供应商名称",name:"supplierName",class:"m-0","label-col":{}},{default:s((()=>[r(l,{value:k.value.supplierName,"onUpdate:value":a[0]||(a[0]=e=>k.value.supplierName=e),placeholder:"请输入供应商名称",class:"min-form-control","allow-clear":"",autocomplete:"off",onKeypress:u(_,["enter"])},null,8,["value"])])),_:1})])),_:1}),r(C,{span:24,md:12,lg:6,xl:8,xxl:4},{default:s((()=>[r(t,{label:"过期状态",name:"state",class:"m-0","label-col":{}},{default:s((()=>[r(I,{value:k.value.state,"onUpdate:value":a[1]||(a[1]=e=>k.value.state=e),placeholder:"请选择状态",class:"min-form-control","allow-clear":""},{default:s((()=>[r(S,{value:"1"},{default:s((()=>a[3]||(a[3]=[d("正常")]))),_:1}),r(S,{value:"2"},{default:s((()=>a[4]||(a[4]=[d("即将过期")]))),_:1}),r(S,{value:"3"},{default:s((()=>a[5]||(a[5]=[d("已过期")]))),_:1}),r(S,{value:"4"},{default:s((()=>a[6]||(a[6]=[d("库存不足")]))),_:1})])),_:1},8,["value"])])),_:1})])),_:1}),r(C,{span:24,md:12,lg:6,xl:8,xxl:4},{default:s((()=>[r(t,{label:"审核状态",name:"auditingState",class:"m-0","label-col":{}},{default:s((()=>[r(I,{value:k.value.auditingState,"onUpdate:value":a[2]||(a[2]=e=>k.value.auditingState=e),placeholder:"请选择状态",class:"min-form-control","allow-clear":""},{default:s((()=>[r(S,{value:"1"},{default:s((()=>a[7]||(a[7]=[d("未审核")]))),_:1}),r(S,{value:"2"},{default:s((()=>a[8]||(a[8]=[d("已审核")]))),_:1})])),_:1},8,["value"])])),_:1})])),_:1}),o("div",W,[r(t,{class:"m-0"},{default:s((()=>[o("div",J,[r(R,{type:"primary",ghost:"",class:"mini-btn",onClick:_},{icon:s((()=>[r($,{class:"align-sub text-icon"})])),default:s((()=>[o("span",M,c(e.$t("common.search")),1)])),_:1}),r(R,{class:"mini-btn",onClick:T},{icon:s((()=>[r(U,{class:"align-sub text-icon"})])),default:s((()=>[o("span",V,c(e.$t("common.reset")),1)])),_:1})])])),_:1})])])),_:1})])])),_:1},8,["model"])])),_:1})}}}),Y={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},G={class:"event-form"},H={class:"modal-footer"},Z={class:"event-form"},ee={class:"modal-footer"},ae=z(Object.assign({name:"material-management_pp-management"},{__name:"index",setup(a){k((e=>({"4e79e3f2":fe.value})));const l=_({supplierName:"",state:"",auditingState:""}),t=T({current:1,pageSize:200,showSizeChanger:!0,pageSizeOptions:["50","100","200","300","500","1000"],showQuickJumper:!0,showTotal:e=>"共".concat(e,"条"),total:0,onChange:async(e,a)=>{t.current=e,t.pageSize=a,h()}}),u=_(!1),c=_([{key:"index",dataIndex:"index",title:"序号",width:100,fixed:"left",align:"center",checked:!0},{key:"batchNumber",dataIndex:"batchNumber",title:"生产批号",width:230,fixed:"left",align:"center",checked:!0,ellipsis:!0},{key:"failureState",dataIndex:"failureState",title:"过期状态",width:120,fixed:"left",align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>1==e.failureState?"正常":2==e.failureState?"即将过期":3==e.failureState?"已过期":4==e.failureState?"库存不足":void 0},{key:"auditingState",dataIndex:"auditingState",title:"审核状态",width:120,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>1==e.auditingState?"未审核":2==e.auditingState?"已审核":void 0},{key:"supplierName",dataIndex:"supplierName",title:"供应商名称",width:100,align:"center",checked:!0,ellipsis:!0},{key:"specif",dataIndex:"specif",title:"物料规格",width:240,align:"center",checked:!0,ellipsis:!0},{key:"inventory",dataIndex:"inventory",title:"库存",width:140,align:"center",checked:!0,ellipsis:!0},{key:"productionTime",dataIndex:"productionTime",title:"生产时间",width:200,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>null==e.productionTime?null:C(e.productionTime)},{key:"expirationTime",dataIndex:"expirationTime",title:"失效时间",width:200,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>null==e.expirationTime?null:C(e.expirationTime)},{key:"storageTime",dataIndex:"storageTime",title:"入库时间",width:200,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>null==e.storageTime?null:C(e.storageTime)},{key:"createBy",dataIndex:"createBy",title:"入库员",width:140,align:"center",checked:!0,ellipsis:!0},{key:"outbound",dataIndex:"outbound",title:"出库员",width:140,align:"center",checked:!0,ellipsis:!0},{key:"changeTime",dataIndex:"changeTime",title:"更改时间",width:200,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>null==e.changeTime?null:C(e.changeTime)},{key:"auditing",dataIndex:"auditing",title:"审核人",width:140,align:"center",checked:!0,ellipsis:!0},{key:"auditingTime",dataIndex:"auditingTime",title:"审核时间",width:200,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>null==e.auditingTime?null:C(e.auditingTime)}]),p=[{type:"input",key:"batchNumber",label:"生产批号",placeholder:"请输入生产批号",span:24},{type:"input",key:"supplierName",label:"供应商名称",placeholder:"请输入供应商名称",span:24},{type:"input",key:"specif",label:"物料规格",placeholder:"请输入物料规格",span:24},{type:"input",key:"inventory",label:"库存",placeholder:"请输入库存",span:24},{type:"datePicker",key:"productionTime",label:"生产时间",span:24,showTime:!0},{type:"datePicker",key:"expirationTime",label:"失效时间",span:24,showTime:!0},{type:"datePicker",key:"storageTime",label:"入库时间",span:24,showTime:!0},{type:"input",key:"createBy",label:"入库员",span:24,showTime:!0}],m=[{type:"input",key:"quantity",label:"数量",placeholder:"请输入数量",span:24}],v=_([]),f=_(!1),g=_([]);function h(){f.value=!0,B({pageSize:t.pageSize,pageNum:t.current,...l.value}).then((({data:e,error:a,otherData:l})=>{a||(e.forEach(((e,a)=>{e.index=a+1})),v.value=l.data,t.total=l.total)})).finally((()=>{f.value=!1}))}const w=_([]);function x(e){w.value=e}const b=_(!1),z=_("");function Q(){b.value=!1,u.value=!1,w.value=[]}function W(){P(z.value).then((({data:e,error:a})=>{var l;a||(b.value=!1,z.value="",null==(l=window.$message)||l.success("修改成功"),w.value=[],u.value=!1,h())}))}function J(){var e,a;0!=w.value.length?null==(a=window.$modal)||a.confirm({title:"是否确认删除数据?",onOk:()=>{const e=v.value.filter((e=>w.value.includes(e.id)));j(e).then((({data:e,error:a})=>{var l;a||(null==(l=window.$message)||l.success("删除成功"),w.value=[],h())}))},onCancel:()=>{}}):null==(e=window.$message)||e.error("请先选择一条数据")}const M=_(!1);function V(){var e;if(1!=w.value.length)return null==(e=window.$message)?void 0:e.error("请先选择数据");const a={quantity:1,category:3,codeInfo:v.value.find((e=>w.value[0]==e.id)).barcode};O(a).then((({data:e,error:a})=>{M.value=!1,w.value=[];const l=new Blob([e],{type:"application/pdf"}),t=document.getElementById("printPdf");t&&t.parentNode.removeChild(t);const n=document.createElement("iframe");n.style.frameborder="no",n.style.display="none",n.style.pageBreakBefore="always",n.setAttribute("id","printPdf"),n.setAttribute("name","printPdf"),n.src=window.URL.createObjectURL(l),document.body.appendChild(n),ae("printPdf"),window.URL.revokeObjectURL(n.src)}))}function ae(e){const a=document.getElementById(e).contentWindow;setTimeout((()=>{a.print()}),500)}const le=_(""),te=_({});function ne(){var e;if(0==w.value.length)return null==(e=window.$message)?void 0:e.error("请选择数据!");le.value="出库",M.value=!0}function ie(){var e;if(0==w.value.length)return null==(e=window.$message)?void 0:e.error("请选择数据!");le.value="入库",M.value=!0}function se(){var e,a;if(0==w.value.length)return null==(e=window.$message)?void 0:e.error("请先选择数据!");null==(a=window.$modal)||a.confirm({title:"是否确认审核数据?",onOk:()=>{const e=v.value.filter((e=>w.value.includes(e.id)));A(e).then((({data:e,error:a})=>{var l;a||(w.value=[],h(),null==(l=window.$message)||l.success("审核成功"))}))},onCancel:()=>{}})}function re(){var e,a;if(0==w.value.length)return null==(e=window.$message)?void 0:e.error("请先选择数据!");null==(a=window.$modal)||a.confirm({title:"是否确认撤审数据?",onOk:()=>{const e=v.value.filter((e=>w.value.includes(e.id)));q(e).then((({data:e,error:a})=>{var l;a||(null==(l=window.$message)||l.success("撤审成功"),w.value=[],h())}))},onCancel:()=>{}})}const oe=_(null);function ue(e,a){return{onDblclick:a=>{z.value=v.value.find((a=>e.id==a.id)),b.value=!0},style:{"background-color":(()=>{if(e.id===oe.value)return"#BAEAFA";const a=Number(e.expirationDays);return a<10?"rgb(247, 109, 109,0.7)":a<20?"rgb(173, 216, 230,0.7)":"rgb(144, 238, 144,0.7)"})()},class:"".concat(e.id===oe.value?"jl-table-row-selected":""),onClick(){oe.value=e.id}}}function de(){t.current=1,h()}h();const ce=_(!1);function pe(){var e;if(0==w.value.length)return null==(e=window.$message)?void 0:e.error("请先选择数据!");ce.value=!0;const a=v.value.filter((e=>w.value.includes(e.id)));D(a).then((({data:e,error:a})=>{const l=new Blob([e],{type:"application/pdf"}),t=document.getElementById("printPdf");t&&t.parentNode.removeChild(t);const n=document.createElement("iframe");n.style.frameborder="none",n.style.display="none",n.style.pageBreakBefore="always",n.setAttribute("id","printPdf"),n.setAttribute("name","printPdf"),n.src=window.URL.createObjectURL(l),document.body.appendChild(n),ae("printPdf"),window.URL.revokeObjectURL(n.src)})).finally((()=>{ce.value=!1}))}const me=_(null),{height:ve}=S(me),fe=I((()=>"".concat(ve.value+20,"px")));return(a,k)=>{const _=y,T=e,C=$("STable"),S=K;return n(),R("div",Y,[r(X,{model:l.value,"onUpdate:model":k[0]||(k[0]=e=>l.value=e),onReset:k[1]||(k[1]=e=>de()),onSearch:k[2]||(k[2]=e=>de())},null,8,["model"]),r(S,{bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"table-card flex-col-stretch sm:flex-1-hidden card-wrapper"},{title:s((()=>[r(_,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:k[3]||(k[3]=e=>function(){var e;if(1!=w.value.length)return null==(e=window.$message)?void 0:e.error("请先选择一条数据");z.value=v.value.find((e=>w.value[0]==e.id)),u.value=!0,b.value=!0}())},{default:s((()=>k[11]||(k[11]=[o("span",{class:"ml-3px"},"修改",-1)]))),_:1}),r(_,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:J},{default:s((()=>k[12]||(k[12]=[o("span",{class:"ml-3px"},"删除",-1)]))),_:1}),r(_,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:ne},{default:s((()=>k[13]||(k[13]=[o("span",{class:"ml-3px"},"出库",-1)]))),_:1}),r(_,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:ie},{default:s((()=>k[14]||(k[14]=[o("span",{class:"ml-3px"},"入库",-1)]))),_:1}),r(_,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:se},{default:s((()=>k[15]||(k[15]=[o("span",{class:"ml-3px"},"审核",-1)]))),_:1}),r(_,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:re},{default:s((()=>k[16]||(k[16]=[o("span",{class:"ml-3px"},"撤审",-1)]))),_:1}),r(_,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:V},{default:s((()=>k[17]||(k[17]=[o("span",{class:"ml-3px"},"二维码",-1)]))),_:1}),r(_,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:pe,loading:ce.value},{default:s((()=>k[18]||(k[18]=[o("span",{class:"ml-3px"},"打印",-1)]))),_:1},8,["loading"])])),extra:s((()=>[r(T,{columns:c.value,"onUpdate:columns":k[4]||(k[4]=e=>c.value=e)},null,8,["columns"])])),default:s((()=>[r(C,{columns:c.value,"data-source":v.value,size:"small",bordered:"",loading:f.value,"custom-row":ue,"row-selection":{selectedRowKeys:w.value,onChange:x},"default-expanded-row-keys":g.value,"row-key":"id","default-expand-all-rows":!0,scroll:{y:"auto"},pagination:t,class:"has-footer-table h-full","row-height":23},{footer:s((()=>[o("div",{ref_key:"tableFooterRef",ref:me,style:{display:"flex","align-items":"center"}},k[19]||(k[19]=[o("div",{style:{width:"20px",height:"14px","background-color":"rgba(244, 56, 56, 0.7)"}},null,-1),o("span",null,"背景为10天内过期",-1),o("div",{style:{width:"20px",height:"14px","background-color":"rgba(173, 216, 230, 0.7)"}},null,-1),o("span",null,"背景为20天内过期",-1),o("div",{style:{width:"20px",height:"14px","background-color":"rgba(44, 238, 144, 0.7)"}},null,-1),o("span",null,"背景为超过20天过期",-1)]),512)])),_:1},8,["columns","data-source","loading","row-selection","default-expanded-row-keys","pagination"])])),_:1}),r(F,{visible:b.value,"onUpdate:visible":k[6]||(k[6]=e=>b.value=e),"destroy-on-close":!0,title:"PP信息修改",width:"750px",height:"550px"},{footer:s((()=>[o("div",H,[r(_,{onClick:Q},{default:s((()=>k[20]||(k[20]=[d("关闭")]))),_:1}),u.value?(n(),i(_,{key:0,type:"primary",onClick:W},{default:s((()=>k[21]||(k[21]=[d("保存")]))),_:1})):U("",!0)])])),default:s((()=>[o("div",G,[r(N,{model:z.value,"onUpdate:model":k[5]||(k[5]=e=>z.value=e),"form-list":p},null,8,["model"])])])),_:1},8,["visible"]),r(F,{visible:M.value,"onUpdate:visible":k[10]||(k[10]=e=>M.value=e),title:le.value,width:"550px",height:"350px"},{footer:s((()=>[o("div",ee,[r(_,{onClick:k[8]||(k[8]=e=>M.value=!1)},{default:s((()=>k[22]||(k[22]=[d("关闭")]))),_:1}),r(_,{type:"primary",onClick:k[9]||(k[9]=e=>function(e){var a;if(!te.value.quantity)return null==(a=window.$message)?void 0:a.error("请输入数量!");te.value.id=w.value[0],"出库"==e?L(te.value).then((({error:e,data:a})=>{var l;e||(null==(l=window.$message)||l.success("出库成功!"),te.value={},M.value=!1,w.value="",le.value="",h())})):E(te.value).then((({error:e,data:a})=>{var l;e||(null==(l=window.$message)||l.success("入库成功!"),te.value={},M.value=!1,w.value="",le.value="",h())}))}(le.value))},{default:s((()=>k[23]||(k[23]=[d("保存")]))),_:1})])])),default:s((()=>[o("div",Z,[r(N,{model:te.value,"onUpdate:model":k[7]||(k[7]=e=>te.value=e),"form-list":m},null,8,["model"])])])),_:1},8,["visible","title"])])}}}),[["__scopeId","data-v-69ce187e"]]);export{ae as default};
