import{_ as e}from"./count-to.vue_vue_type_script_setup_true_lang-B2gd1OWh.js";import{Z as a,d as l,K as t,L as s,o as i,c as u,w as d,g as n,f as o,s as r,t as c,I as v,v as p,N as m,O as f,B as b,P as h,Q as g,F as x,cT as _,r as y,a0 as N,af as q,e as E,J as w,h as T,a1 as P,cF as S,b as k,aj as R,al as C,ac as O,i as j,cU as I,a7 as W,cH as A}from"./index-B3PZsRwT.js";import{C as L}from"./index-BThgVJ70.js";import{u as M}from"./echarts-B3HHInsl.js";import{D,a as F}from"./index-BrhnYIjA.js";import{_ as U}from"./index-81pxjwat.js";import"./installCanvasRenderer-Dfk03Uyn.js";const K={class:"w-full flex"},z={class:"flex"},B={class:"w-full flex-y-center justify-end gap-12px"},$={class:"ml-3px"},G={class:"ml-3px"},H=l({__name:"search",props:{model:{required:!0},modelModifiers:{}},emits:t(["search","reset"],["update:model"]),setup(e,{emit:a}){const l=a,t=s(e,"model");function _(){l("search",t.value)}function y(){t.value={subEqpName:null,pgmPathName:null},l("reset",t.value)}return(e,a)=>{const l=v,s=p,N=m,q=f,E=b,w=h,T=g,P=x,S=L;return i(),u(S,{title:null,bordered:!1,class:"search-card card-wrapper"},{default:d((()=>[n(P,{ref:"formRef",model:t.value,"label-col":{span:5,md:7},class:"search-form"},{default:d((()=>[o("div",K,[n(T,{gutter:[15,8],wrap:"",class:"w-full"},{default:d((()=>[n(N,{span:24,md:16,lg:12,xl:8,xxl:6},{default:d((()=>[n(s,{label:"设备名称",name:"subEqpName",class:"m-0","label-col":{}},{default:d((()=>[n(l,{value:t.value.subEqpName,"onUpdate:value":a[0]||(a[0]=e=>t.value.subEqpName=e),placeholder:"请输入设备名称",class:"min-form-control","allow-clear":"",autocomplete:"off",onKeypress:r(_,["enter"])},null,8,["value"])])),_:1})])),_:1}),n(N,{span:24,md:16,lg:12,xl:8,xxl:6},{default:d((()=>[n(s,{label:"生产型号",name:"pgmPathName",class:"m-0","label-col":{}},{default:d((()=>[n(l,{value:t.value.pgmPathName,"onUpdate:value":a[1]||(a[1]=e=>t.value.pgmPathName=e),placeholder:"请输入生产型号",class:"min-form-control","allow-clear":"",autocomplete:"off",onKeypress:r(_,["enter"])},null,8,["value"])])),_:1})])),_:1}),o("div",z,[n(s,{class:"m-0"},{default:d((()=>[o("div",B,[n(E,{type:"primary",ghost:"",class:"mini-btn",onClick:_},{icon:d((()=>[n(q,{class:"align-sub text-icon"})])),default:d((()=>[o("span",$,c(e.$t("common.search")),1)])),_:1}),n(E,{class:"mini-btn",onClick:y},{icon:d((()=>[n(w,{class:"align-sub text-icon"})])),default:d((()=>[o("span",G,c(e.$t("common.reset")),1)])),_:1})])])),_:1})])])),_:1})])])),_:1},8,["model"])])),_:1})}}}),J={__name:"state-chart",props:{list:{type:Array,default:()=>[]}},setup(e){const a=e,{store:l}=_(),t=y([]),s=N((()=>l.drilling_equipment_state),(e=>{t.value=null==e?void 0:e.map((e=>({key:e.value,name:e.label,value:0})))}),{deep:!0}),{domRef:u,updateOptions:d}=M((()=>({tooltip:{trigger:"item"},title:{text:"设备状态统计",left:"center",top:"15",textStyle:{color:"#646cff",fontWeight:"bold",fontSize:"1.5rem"}},legend:{bottom:"1%",left:"center",itemStyle:{borderWidth:0}},series:[{color:["#1CD66C","#8e9dff","#FF3030","#26deca","#fedc69"],name:"设备状态",type:"pie",radius:["45%","70%"],avoidLabelOverlap:!1,center:["50%","50%"],itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:1},label:{show:!1,position:"center"},labelLine:{show:!1},data:t.value}]})),!1);return N((()=>a.list),(e=>{const a=e.reduce(((e,a)=>(a.equipmentStatus&&(e[a.equipmentStatus]=(e[a.equipmentStatus]||0)+1),e)),{});t.value.forEach((e=>{e.value=a[e.key]})),d((e=>(e.series[0].data=t.value,e)))}),{deep:!0}),q((()=>{s()})),(e,a)=>(i(),E("div",{ref_key:"domRef",ref:u,class:"h-360px overflow-hidden"},null,512))}},Q=w({__name:"details",props:{data:{type:Object,default:()=>({})},dataModifiers:{}},emits:["update:data"],setup(e){const a=s(e,"data"),{store:l}=_(),t=y({WORK:"",WAIT:"",ALARM:"",IDLE:"",STOP:""});return l.drilling_equipment_state.forEach((e=>{t.value[e.value]=e.label})),(e,l)=>{const s=D,r=U,v=F;return i(),u(v,{title:"",column:2,bordered:"",size:"small"},{default:d((()=>[n(s,{label:"设备名称"},{default:d((()=>[T(c(a.value.subEqpName),1)])),_:1}),n(s,{label:"时间"},{default:d((()=>[T(c(a.value.dateTime),1)])),_:1}),n(s,{label:"直径表名称"},{default:d((()=>[T(c(a.value.diaPath),1)])),_:1}),n(s,{label:"程序加工百分数"},{default:d((()=>[n(r,{percent:Number(a.value.runPresent),"stroke-color":{"0%":"#108ee9","100%":"#87d068"}},null,8,["percent"])])),_:1}),n(s,{label:"钻带名称"},{default:d((()=>[T(c(a.value.pgmPath),1)])),_:1}),n(s,{label:"稼动率"},{default:d((()=>[T(c(a.value.duty),1)])),_:1}),n(s,{label:"开机时间"},{default:d((()=>[T(c(a.value.shiftOperateTime),1)])),_:1}),n(s,{label:"加工时间"},{default:d((()=>[T(c(a.value.lotRunTime),1)])),_:1}),n(s,{label:"等待时间"},{default:d((()=>[T(c(a.value.shiftWaitTime),1)])),_:1}),n(s,{label:"错误时间"},{default:d((()=>[T(c(a.value.shiftErrorTime),1)])),_:1}),n(s,{label:"机台当前状态"},{default:d((()=>[o("span",{class:P(["equipment-status",a.value.equipmentStatus])},c(t.value[a.value.equipmentStatus]),3)])),_:1}),n(s,{label:"轴开启状态"},{default:d((()=>[T(c(a.value.axisStatus),1)])),_:1}),n(s,{label:"主轴开启数量"},{default:d((()=>[T(c(a.value.axisRunCount),1)])),_:1})])),_:1})}}},[["__scopeId","data-v-95aac095"]]),V={class:"borehole-data-page h-full w-full flex"},X={class:"left-list min-h-500px flex-col-stretch gap-5px overflow-hidden lt-sm:overflow-auto"},Y={class:"list h-full w-full overflow-auto"},Z={key:0,class:"row flex flex-wrap"},ee={class:"device-data"},ae={class:"data"},le=["title"],te={class:"data"},se=["title"],ie={class:"data"},ue=["title"],de={class:"data"},ne=["title"],oe={class:"data"},re=["title"],ce={class:"data flex"},ve={class:"value flex gap-3px color-#646cff"},pe=["onClick"],me={class:"state w-full"},fe={class:"right-msg"},be={class:"right-card bg-#fff pb-30px pt10px"},he={class:"card-content flex flex-center gap-15px"},ge={class:"right-card mt15px bg-#fff pb-30px pt10px"},xe={class:"card-content"},_e={class:"right-card mt15px bg-#fff pb-30px pl10px pt15px"},ye={class:"card-content"},Ne={class:"text"},qe=w(Object.assign({name:"collection-management_forming-machine-data-acquisition"},{__name:"index",setup(l){const{getDict:t}=_(),s=y([]);t("drilling_equipment_state").then((e=>{s.value=e}));const r=S.PRESENTED_IMAGE_SIMPLE,v=y({subEqpName:null,pgmPathName:null}),p=y([]),m=y(!1),f=y([]),b=y(!1);function h(){b.value=!0,(v.value,a({url:"/mes/agv/plan/rhythm/rate/milling/monitor",method:"GET"})).then((({data:e,error:a})=>{a||(null==e||e.forEach(((e,a)=>{e.index=a+1,e.TUuid=W.generate()})),p.value=e,f.value=e)})).finally((()=>b.value=!1))}function g(e){return f.value.filter((a=>e(a)))}function x(){p.value=v.value.subEqpName||v.value.pgmPathName?v.value.subEqpName&&v.value.pgmPathName?g((e=>{var a,l;return(null==(a=null==e?void 0:e.subEqpName)?void 0:a.includes(v.value.subEqpName))&&(null==(l=null==e?void 0:e.pgmPath)?void 0:l.includes(v.value.pgmPathName))})):v.value.subEqpName?g((e=>{var a;return null==(a=null==e?void 0:e.subEqpName)?void 0:a.includes(v.value.subEqpName)})):v.value.pgmPathName?g((e=>{var a;return null==(a=null==e?void 0:e.pgmPath)?void 0:a.includes(v.value.pgmPathName)})):[]:f.value}h();let w=null;N((()=>v.value),(()=>{w||(w=setTimeout((()=>{clearTimeout(w),w=null,x()}),500))}),{deep:!0});let L=setInterval((()=>{h()}),3e5);function M(){p.value=f.value}function D(e){return Number(e)>=100?"完成":"".concat(e,"%")}const F=k((()=>f.value.length.toString().padStart(3,"0").split(""))),K={WORK:"#1CD66C",WAIT:"#8e9dff",ALARM:"#FF3030",IDLE:"#26deca",STOP:"#fedc69"},z=y(null),{updateModalOptions:B,handleShow:$}=window.$useModal({modalOption:{title:"设备详情",showConfirmBtn:!1,confirmBtnText:"关闭",destroyOnClose:!0,width:"955px"},component:()=>n(Q,{data:z.value,"onUpdate:data":e=>z.value=e},null)});return q((()=>{clearInterval(L),L=null})),(a,l)=>{const t=U,b=S,h=A,g=e;return i(),E("div",V,[o("div",X,[n(H,{model:v.value,"onUpdate:model":l[0]||(l[0]=e=>v.value=e),onReset:M,onSearch:x},null,8,["model"]),o("div",Y,[n(h,{tip:"数据加载中...",spinning:m.value,class:"h-full w-full"},{default:d((()=>[p.value.length?(i(),E("div",Z,[(i(!0),E(R,null,C(p.value,((e,a)=>{var s;return i(),E("div",{key:a,class:"col col-1100-24 col-1400-12 col-xxl-6 col-1500-8"},[o("div",{class:"card flex",style:O({border:"2px solid ".concat(K[e.equipmentStatus])})},[o("div",ee,[o("div",ae,[l[1]||(l[1]=o("div",{class:"label"},"设备名称",-1)),o("div",{class:"value",title:e.subEqpName},c(e.subEqpName),9,le)]),o("div",te,[l[2]||(l[2]=o("div",{class:"label"},"时 间",-1)),o("div",{class:"value",title:e.dateTime},c(e.dateTime),9,se)]),o("div",ie,[l[3]||(l[3]=o("div",{class:"label"},"稼动率",-1)),o("div",{class:"value",title:e.duty},c(e.duty),9,ue)]),o("div",de,[l[4]||(l[4]=o("div",{class:"label"},"开机时间",-1)),o("div",{class:"value",title:e.startTime},c(e.shiftOperateTime),9,ne)]),o("div",oe,[l[5]||(l[5]=o("div",{class:"label"},"加工时间",-1)),o("div",{class:"value",title:e.lotRunTime},c(e.lotRunTime),9,re)]),o("div",ce,[l[6]||(l[6]=o("div",{class:"label font-bold"},"轴开启状态",-1)),o("div",ve,[(i(!0),E(R,null,C(null==(s=e.axisStatus)?void 0:s.split(""),((e,a)=>(i(),E("span",{key:a,class:P(["pl-3px pr-3px",1===Number(e)?"bg-green":"bg-#eee"])},c(a+1),3)))),128))])])]),o("div",{class:"view-device-data cursor-pointer color-#646cff",onClick:a=>function(e){B({title:"".concat(e.subEqpName,"设备详情")}),z.value=e,$()}(e)},"查看详情",8,pe),o("div",me,[l[7]||(l[7]=o("div",{class:"label"},"加工进度",-1)),n(t,{percent:Number(e.runPresent),format:D,type:"dashboard",size:[90,90],"stroke-color":{"0%":"#87d068","100%":"#108ee9"}},null,8,["percent"])])],4)])})),128))])):(i(),u(b,{key:1,image:j(r)},null,8,["image"]))])),_:1},8,["spinning"])])]),o("div",fe,[o("div",be,[l[8]||(l[8]=I('<div class="angle" data-v-63ebf542><div class="left-top" data-v-63ebf542></div><div class="right-top" data-v-63ebf542></div><div class="left-bottom" data-v-63ebf542></div><div class="right-bottom" data-v-63ebf542></div></div><div class="card-title" data-v-63ebf542>设备总数</div>',2)),o("div",he,[(i(!0),E(R,null,C(F.value,((e,a)=>(i(),u(g,{key:a,"start-value":0,"end-value":Number(e),class:"device-count text-30px dark:text-dark"},null,8,["end-value"])))),128))])]),o("div",ge,[l[9]||(l[9]=I('<div class="angle" data-v-63ebf542><div class="left-top" data-v-63ebf542></div><div class="right-top" data-v-63ebf542></div><div class="left-bottom" data-v-63ebf542></div><div class="right-bottom" data-v-63ebf542></div></div>',1)),o("div",xe,[n(J,{list:f.value},null,8,["list"])])]),o("div",_e,[l[12]||(l[12]=I('<div class="angle" data-v-63ebf542><div class="left-top" data-v-63ebf542></div><div class="right-top" data-v-63ebf542></div><div class="left-bottom" data-v-63ebf542></div><div class="right-bottom" data-v-63ebf542></div></div>',1)),o("div",ye,[l[11]||(l[11]=o("div",{class:"card-title"},"左侧设备状态说明",-1)),(i(!0),E(R,null,C(s.value,((e,a)=>(i(),E("div",{key:a,class:"card-instructions flex-center justify-start"},[l[10]||(l[10]=T(" 边框为 ")),o("div",{class:P(["equipment-status type h-14px w-14px",e.value])},null,2),o("div",Ne,"代表"+c(e.label)+"的设备",1)])))),128))])])])])}}}),[["__scopeId","data-v-63ebf542"]]);export{qe as default};
