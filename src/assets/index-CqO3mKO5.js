import{_ as e}from"./round-download-DUbhM0Ds.js";import{_ as a}from"./round-add-MytOGm9O.js";import{r as l,o as t,e as s,g as n,W as r,a5 as d,w as o,h as i,f as p,t as u,aa as c,B as m}from"./index-B3PZsRwT.js";import{_ as k}from"./table-DoFSI9NT.js";import{_ as y}from"./common-search.vue_vue_type_script_setup_true_lang-BX9APgbN.js";import{_ as v}from"./modal.vue_vue_type_style_index_0_lang-Gjmj9w7c.js";import{g as f,a as g,e as h,d as _,b as x}from"./mold-maintenance-BvseXw5G.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import"./api-By23aosn.js";import"./index-BThgVJ70.js";const b={class:"event-form"},w={__name:"add",props:{rowData:{type:Object,default:()=>null},operateType:{type:String,default:()=>"add"}},setup(e,{expose:a}){const o=e,i=l([]),p=[{type:"tabs",name:"基本项目",span:24},{type:"select",key:"moldIds",label:"模具型号",placeholder:"请输入模具型号",span:8,rule:{required:!0,message:"请输入模具型号",trigger:"blur"},selectOptions:i,search:!0,change(e){c.value.moldId=i.value.find((a=>a.value===e)).moldUuid}},{type:"input",key:"moldDesc",label:"问题点描述",placeholder:"请输入问题点描述",span:8},{type:"input",key:"replacePart",label:"更换配件",placeholder:"请输入更换配件",span:8},{span:8,type:"datePicker",key:"upkeepDate",label:"日期",rule:{required:!0,message:"请选择日期",trigger:"change"},tansfromDisabled:e=>"look"===e},{span:8,type:"datePicker",key:"upkeepStartTime",label:"维修时间",rule:{required:!0,message:"请选择维修时间",trigger:"change"},tansfromDisabled:e=>"look"===e,showTime:!0},{span:8,type:"datePicker",key:"upkeepEndTime",label:"修复时间",rule:{required:!0,message:"请选择修复时间",trigger:"change"},tansfromDisabled:e=>"look"===e,showTime:!0},{type:"tabs",name:"人员信息",span:24},{type:"input",key:"upkeeper",label:"操作人",placeholder:"请输入操作人",span:8},{type:"select",key:"upkeepType",label:"类别",placeholder:"请选择类别",span:8,selectOptions:[{value:1,label:"维修"},{value:2,label:"保养"}]},{type:"textarea",key:"remark",label:"备注",placeholder:"请输入备注",span:8,textareaRows:1}];const u=l(null),c=l({...function(){const e={};return p.forEach((a=>{a.key&&a.span&&("add"===o.operateType?e[a.key]=null:e[a.key]=o.rowData[a.key])})),e}(),moldNo:null});return f({pageNum:1,pageSize:9999}).then((({data:e,error:a})=>{a||(i.value=e.list.map((e=>({value:e.moldNo,label:e.moldNo,...e}))),d((()=>{"add"!==o.operateType&&(c.value.moldIds=i.value.find((e=>e.moldUuid===o.rowData.moldId)).value)})))})),a({model:c.value,validateForm:function(){return u.value.validateForm()}}),(e,a)=>(t(),s("div",b,[n(r,{ref_key:"formRef",ref:u,model:c.value,"onUpdate:model":a[0]||(a[0]=e=>c.value=e),"form-list":p},null,8,["model"])]))}},I={class:"mold-maintenance-page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},D={class:"modal-footer"},T=Object.assign({name:"workwear_stamping-die-management_mold-maintenance"},{__name:"index",setup(r){const b=l(null),T=l(null),U=l({moldNo:null}),j=[{type:"input",key:"moldNo",label:"模具编号",placeholder:"请输入模具编号",span:24,md:12,lg:8,xl:8,xxl:6}],N=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"moldNo",dataIndex:"moldNo",title:"模具型号",align:"center",checked:!0,ellipsis:!0,width:150},{key:"upkeepTypeName",dataIndex:"upkeepTypeName",title:"类别",align:"center",checked:!0,ellipsis:!0},{key:"moldDesc",dataIndex:"moldDesc",title:"问题点描述",align:"center",checked:!0,ellipsis:!0,width:140},{key:"replacePart",dataIndex:"replacePart",title:"更换配件",align:"center",checked:!0,ellipsis:!0},{key:"upkeepDate",dataIndex:"upkeepDate",title:"日期",align:"center",checked:!0,ellipsis:!0,width:130},{key:"upkeepStartTime",dataIndex:"upkeepStartTime",title:"维修时间",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>c(e.upkeepStartTime).format("YYYY-MM-DD HH:mm:ss")},{key:"upkeepEndTime",dataIndex:"upkeepEndTime",title:"修复时间",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>c(e.upkeepEndTime).format("YYYY-MM-DD HH:mm:ss")},{key:"upkeeper",dataIndex:"upkeeper",title:"操作人",align:"center",checked:!0,ellipsis:!0},{key:"remark",dataIndex:"remark",title:"备注",align:"center",checked:!0,ellipsis:!0},{key:"table-cz",dataIndex:"table-cz",title:"操作",align:"center",checked:!0,ellipsis:!0,width:140,fixed:"right",customRender:({record:e})=>n("div",null,[n(m,{type:"link",danger:!0,class:"pl-3px pr-3px",onClick:()=>{var a;a=e,window.$modal.confirm({title:"确定删除?",onOk:()=>{_(a.moldUpkeepUuid).then((({error:e})=>{e||(window.$message.success("删除成功"),P())}))},onCancel:()=>{}})}},{default:()=>[i("删除")]}),n(m,{type:"link",class:"pl-3px pr-3px",onClick:()=>{E(e)}},{default:()=>[i("修改")]})])}];function P(){T.value.getData(1)}function R(){d((()=>{U.value={keywords:null,noticeState:null},P()}))}const S=l("add"),C=l(!1),Y=l(!1),z=l(null),q=l(null);function E(e){f({pageNum:1,pageSize:9999}).then((({data:e,error:a})=>{a||(O.value=e.list)})),z.value=e,C.value=!0,S.value=e?"edit":"add"}function H(){C.value=!1}const O=l([]);async function M(){const e={...q.value};let a;await e.validateForm(),Y.value=!0;const l={...e.model};"add"===S.value?a=g(l):(l.moldIds=O.value.find((e=>e.moldNo===l.moldIds)).moldUuid,a=h({...l,moldUpkeepUuid:z.value.moldUpkeepUuid})),a.then((({error:e})=>{e||(window.$message.success("".concat("add"===S.value?"新增":"修改","成功")),H(),R())})).finally((()=>Y.value=!1))}function F(){x({...U.value})}return l(null),(l,r)=>{const d=a,c=m,f=e;return t(),s("div",I,[n(y,{ref_key:"commonSearchRef",ref:b,searchParams:U.value,"onUpdate:searchParams":r[0]||(r[0]=e=>U.value=e),"form-list":j,"is-search":!0,onSearch:P,onReset:R},null,8,["searchParams"]),n(k,{ref_key:"tableRef",ref:T,searchParams:U.value,"onUpdate:searchParams":r[2]||(r[2]=e=>U.value=e),column:N,"show-row-selection":!1,"row-key":"moldUpkeepUuid",scroll:{y:"auto"},"is-init-get-data":"",url:"/qms/agv/frock/mold/upkeep/record/list"},{tableTitle:o((()=>[n(c,{type:"primary",class:"mini-btn mr-8px",size:"small",ghost:"",onClick:r[1]||(r[1]=e=>E(null))},{icon:o((()=>[n(d,{class:"align-sub text-icon"})])),default:o((()=>[r[4]||(r[4]=i(" 新增 "))])),_:1}),n(c,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:F},{icon:o((()=>[n(f,{class:"align-sub text-icon"})])),default:o((()=>[r[5]||(r[5]=p("span",{class:"ml-3px"},"导出",-1))])),_:1})])),_:1},8,["searchParams"]),n(v,{visible:C.value,"onUpdate:visible":r[3]||(r[3]=e=>C.value=e),title:"模具维修保养".concat("add"===S.value?"新增":"修改"),width:"70vw",height:"500px",centered:!0,"destroy-on-close":!0,onClose:H},{footer:o((()=>[p("div",D,[n(c,{loading:Y.value,type:"primary",onClick:M},{default:o((()=>[i(u("add"===S.value?"新增":"修改"),1)])),_:1},8,["loading"]),n(c,{onClick:H},{default:o((()=>r[6]||(r[6]=[i("关 闭")]))),_:1})])])),default:o((()=>[n(w,{ref_key:"addRef",ref:q,"row-data":z.value,"operate-type":S.value},null,8,["row-data","operate-type"])])),_:1},8,["visible","title"])])}}});export{T as default};
