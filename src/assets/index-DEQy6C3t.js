import{_ as e}from"./table-DoFSI9NT.js";import{_ as a}from"./common-search.vue_vue_type_script_setup_true_lang-BX9APgbN.js";import{Z as l,r as t,b as s,aa as n,o as i,e as o,g as d,w as r,i as m,X as c,f as u,bD as p,B as h}from"./index-B3PZsRwT.js";import{E as f}from"./EditOutlined-5FYoGiVM.js";import{D as x}from"./DeleteOutlined-CWT7lRAZ.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import"./api-By23aosn.js";import"./index-BThgVJ70.js";const y={class:"jl-main-page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},g=Object.assign({name:"manage_form-service-record"},{__name:"index",setup(g){const v=t([]),k=t([]),b=t({formName:null,system:null,module:null,time:null}),w=[{type:"input",key:"formName",label:"表单名称",placeholder:"请输入表单名称",span:24,md:12,lg:8,xl:8,xxl:4},{type:"select",key:"system",label:"系统",placeholder:"请选择系统",span:24,md:12,lg:8,xl:8,xxl:4,selectOptions:v,change:()=>{var e;const a=null==(e=v.value.find((e=>e.value===b.value.system)))?void 0:e.id;k.value=[],_(a,(e=>{k.value=e}))}},{type:"select",key:"module",label:"模块",placeholder:"请选择模块",span:24,md:12,lg:8,xl:8,xxl:4,selectOptions:k},{type:"select",key:"state",label:"状态",placeholder:"请选择状态",span:24,md:12,lg:8,xl:8,xxl:4,selectOptions:[{label:"未完成",value:0},{label:"已完成",value:1}]},{type:"dateRangePicker",key:"time",label:"日期",showTime:!0,span:24,md:12,lg:10,xl:8,xxl:6}];function _(e,a){(function(e){return l({url:"/mes/formModification/module",method:"GET",params:{sysId:e}})})(e).then((({data:e,error:l})=>{const t=null==e?void 0:e.map((e=>({...e,label:e.module,value:e.module})));a&&a(t)}))}l({url:"/mes/formModification/system",method:"GET"}).then((({data:e,error:a})=>{v.value=null==e?void 0:e.map((e=>({...e,label:e.system,value:e.system})))}));const O=s((()=>{var e,a;const l={...b.value};return(null==(a=null==(e=b.value)?void 0:e.time)?void 0:a[0])&&(l.startTime=n(b.value.time[0]).format("YYYY-MM-DD"),l.endTime=n(b.value.time[0]).format("YYYY-MM-DD")),delete l.time,l})),T=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,fixed:"left",align:"center",checked:!0,ellipsis:!0},{key:"system",dataIndex:"system",title:"系统",align:"center",checked:!0,ellipsis:!0},{key:"module",dataIndex:"module",title:"模块",align:"center",checked:!0,ellipsis:!0},{key:"formName",dataIndex:"formName",title:"表单名称",align:"center",width:180,checked:!0,ellipsis:!0},{key:"state",dataIndex:"state",title:"状态",align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>d("span",{class:0===e.state?"text-red-500":"text-green-500"},[["未完成","已完成"][e.state]])},{key:"oaCountersignTime",dataIndex:"oaCountersignTime",title:"OA会签时间",align:"center",width:160,checked:!0,ellipsis:!0},{key:"completionTime",dataIndex:"completionTime",title:"完成时间",width:180,align:"center",checked:!0,ellipsis:!0},{key:"elapsedTime",dataIndex:"elapsedTime",title:"耗时",width:180,align:"center",checked:!0,ellipsis:!0},{key:"remark",dataIndex:"remark",title:"备注",align:"center",checked:!0,ellipsis:!0},{key:"operator",dataIndex:"operator",title:"创建人",align:"center",checked:!0,ellipsis:!0},{key:"createDate",dataIndex:"createDate",title:"创建时间",align:"center",checked:!0,width:160,ellipsis:!0,customRender:({record:e})=>n(e.createDate).format("YYYY-MM-DD HH:mm:ss")},{key:"updateUser",dataIndex:"updateUser",title:"修改人",align:"center",checked:!0,ellipsis:!0},{key:"updateDate",dataIndex:"updateDate",title:"修改时间",width:160,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>n(e.updateDate).format("YYYY-MM-DD HH:mm:ss")}],D=t(null);function M(){D.value.getData(1)}function I(){nextTick((()=>{b.value={formName:null,system:null,module:null,time:null},M()}))}const Y=t([]);function C(e){Y.value=e}const P=t([]),j=t("add"),{handleClose:N,handleLoading:$,handleShow:S,updateModalOptions:R}=window.$useModal({modalOption:{title:"新增",width:"600px",destroyOnClose:!0},formData:{system:null,module:null,formName:null,oaCountersignTime:null,remark:null},formList:[{type:"select",key:"system",label:"系统",placeholder:"请选择系统",span:24,selectOptions:v,change:e=>{var a;const l=null==(a=v.value.find((a=>a.value===e)))?void 0:a.id;P.value=[],_(l,(e=>{P.value=e}))}},{type:"select",key:"module",label:"模块",placeholder:"请选择模块",span:24,selectOptions:P},{type:"input",key:"formName",label:"表单名称",placeholder:"请输入表单名称",span:24},{type:"datePicker",key:"oaCountersignTime",label:"OA会签时间",placeholder:"请输入OA会签时间",showTime:!0,span:24},{type:"textarea",key:"remark",label:"表单名称",placeholder:"请输入表单名称",span:24}],onOk:e=>{let a;a="add"===j.value?l({url:"/mes/formModification/add/new",method:"POST",data:e}):function(e){return l({url:"/mes/formModification/update",method:"POST",data:e})}(e),$(!0),a.then((({error:e})=>{e||(window.$message.success("操作成功!"),M(),N())})).finally((()=>{$(!1),Y.value=[]}))},onClose:()=>{P.value=[]}});function z(e){j.value=e,"add"===e?(S({system:null,module:null,formName:null,oaCountersignTime:null,remark:null}),R({title:"新增表单服务记录"})):(S(Y.value[0]),R({title:"修改表单服务记录"}))}function A(){0!==Y.value.length?window.$modal.confirm({title:"确认删除所选择的记录吗?",onOk:()=>{var e;(e=Y.value,l({url:"/mes/formModification/deleteBatch",method:"POST",data:e})).then((({error:e})=>{e||(window.$message.success("删除成功!"),M(),Y.value=[])}))},onCancel:()=>{}}):window.$message.error("请选择要删除的记录")}function E(){0!==Y.value.length?window.$modal.confirm({title:"确认完成所选择的记录吗?",onOk:()=>{var e;(e=Y.value,l({url:"/mes/formModification/complete",method:"POST",data:e})).then((({error:e})=>{e||(window.$message.success("操作成功!"),M(),Y.value=[])}))},onCancel:()=>{}}):window.$message.error("请选择要完成的记录")}return(l,t)=>{const s=a,n=h,g=e;return i(),o("div",y,[d(s,{searchParams:b.value,"onUpdate:searchParams":t[0]||(t[0]=e=>b.value=e),"form-list":w,onSearch:M,onReset:I},null,8,["searchParams"]),d(g,{ref_key:"tableRef",ref:D,searchParams:O.value,"onUpdate:searchParams":t[3]||(t[3]=e=>O.value=e),column:T,"auto-generate-uuid":"",scroll:{y:"auto"},"is-init-get-data":"",url:"/mes/formModification/list",onTableSelectChange:C},{title:r((()=>[d(n,{type:"primary",ghost:"",class:"mini-btn mr-8px",onClick:t[1]||(t[1]=e=>z("add"))},{default:r((()=>[d(m(c),{class:"align-sub text-size-18px"}),t[4]||(t[4]=u("span",{class:"ml-3px"},"新增",-1))])),_:1}),d(n,{type:"primary",ghost:"",class:"mini-btn mr-8px",disabled:1!==Y.value.length,onClick:t[2]||(t[2]=e=>z("edit"))},{default:r((()=>[d(m(f),{class:"align-sub text-size-18px"}),t[5]||(t[5]=u("span",{class:"ml-3px"},"修改",-1))])),_:1},8,["disabled"]),d(n,{type:"primary",ghost:"",class:"mini-btn mr-8px",disabled:0===Y.value.length,onClick:E},{default:r((()=>[d(m(p),{class:"align-sub text-size-18px"}),t[6]||(t[6]=u("span",{class:"ml-3px"},"批量完成",-1))])),_:1},8,["disabled"]),d(n,{type:"primary",danger:"",ghost:"",class:"mini-btn mr-8px",disabled:0===Y.value.length,onClick:A},{default:r((()=>[d(m(x),{class:"align-sub text-size-18px"}),t[7]||(t[7]=u("span",{class:"ml-3px"},"批量删除",-1))])),_:1},8,["disabled"])])),_:1},8,["searchParams"])])}}});export{g as default};
