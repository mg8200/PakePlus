import{_ as e}from"./table-DoFSI9NT.js";import{_ as a}from"./round-delete-DScxCu5A.js";import{_ as l}from"./round-edit-DZi1TDWc.js";import{_ as t}from"./round-add-MytOGm9O.js";import{_ as n}from"./common-search.vue_vue_type_script_setup_true_lang-BX9APgbN.js";import{r as o,o as r,e as s,g as i,w as u,f as c,a3 as d,dR as m,h as p,ah as v,ai as y,W as f,B as h,aa as b,S as g,t as w,a7 as x,a5 as _}from"./index-B3PZsRwT.js";import{_ as k}from"./modal.vue_vue_type_style_index_0_lang-Gjmj9w7c.js";import{a as Y,b as N}from"./hole-inspection-CuWZ7OzN.js";import{m as M,b as F,c as D,d as K}from"./index-DSSNONhA.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import"./api-By23aosn.js";import"./index-BThgVJ70.js";const j={class:"h-full w-full"},U={__name:"add",props:{rowData:{type:Object,default:()=>null}},setup(e,{expose:a}){const l=e,t=o(),n=o([]),b=[{type:"input",key:"sumOneLayer",label:"单面合计",className:"data-input",span:6,disabled:!0},{type:"input",key:"sumTwoLayer",label:"双面合计",span:6,disabled:!0,className:"data-cell"},{type:"input",key:"sumFourLayer",label:"四层合计",span:6,disabled:!0,className:"data-cell"},{type:"input",key:"sumSixLayer",label:"六层及以上合计",span:6,disabled:!0,className:"data-cell"}],g=o({month:null,layer:null,deliverytarget:null}),w=o({sumFourLayer:null,sumOneLayer:null,sumSixLayer:null,sumTotal:null,sumTwoLayer:null}),x=o(""),_=[{type:"datePicker",key:"time",label:"年月",placeholder:"请输入年月",span:8,picker:"month",format:"YYYY-MM",valueFormat:"YYYY-MM",disabled:l.rowData,rule:[{required:!0,message:"请选择年月"}],change(e){N(e)}},{type:"select",key:"layer",label:"层数",placeholder:"请选择层数",clear:!0,span:8,disabled:l.rowData,rule:[{required:!0,message:"请选择层数"}],selectOptions:[{label:"一层",value:"1层"},{label:"二层",value:"2层"},{label:"四层",value:"4层"},{label:"六层及以上",value:"6层及以上"}]},{type:"input",key:"deliverytarget",label:"交货目标产量",placeholder:"自动计算合计产量",span:8,className:"data-cell",value:0,readonly:!0,watch(e){k()}}];function k(e){const a=[],l=x.value.split("-"),t=M(Number(l[0]),Number(l[1]));for(let o=1;o<=t;o++){const e="day".concat(o),l=g.value[e];l&&a.push(Number(l))}const n=a.reduce(((e,a)=>e+a),0);g.value.deliverytarget=n}function N(e){const a=e.split("-");x.value=e;const t=function(e,a){var t;const n={topFormModel:{},topFormList:[],bottomFormModel:[]},o=M(e,a);for(let r=1;r<=o;r++)n.topFormModel["day".concat(Number(r))]=(null==(t=l.rowData)?void 0:t["day".concat(Number(r))])||null,n.topFormList.push({type:"input",key:"day".concat(Number(r)),placeholder:"请输入".concat(r,"号数据"),label:"".concat(r,"号"),span:6,blur(e){k()}});return n}(Number(a[0]),Number(a[1]),Number(a[2]));g.value={month:e,...t.topFormModel},n.value=[..._,...t.topFormList],w.value=[...t.bottomFormModel],async function(e){try{const{error:a,data:l}=await Y({startDate:e});w.value=l}catch(a){}}(x.value)}function M(e,a){return new Date(e,a,0).getDate()}o([]),n.value=[..._];const F=o("请输入数字");function D(){const e=F.value,a=x.value.split("-"),l=M(Number(a[0]),Number(a[1]));for(let t=1;t<=l;t++)g.value["day".concat(t)]=e;k()}return l.rowData&&(N(l.rowData.month),g.value=l.rowData),a({topFormModel:g,validateForm:async function(){await t.value.validateForm()}}),(e,a)=>{const l=v,o=y,x=f,_=h;return r(),s("div",j,[i(o,{activeKey:e.activeKey,"onUpdate:activeKey":a[0]||(a[0]=a=>e.activeKey=a)},{default:u((()=>[i(l,{key:"1",tab:"新增计划"})])),_:1},8,["activeKey"]),i(x,{ref_key:"formRef",ref:t,model:g.value,"onUpdate:model":a[1]||(a[1]=e=>g.value=e),"form-list":n.value},null,8,["model","form-list"]),i(o,{activeKey:e.activeKey,"onUpdate:activeKey":a[2]||(a[2]=a=>e.activeKey=a)},{default:u((()=>[i(l,{key:"1",tab:"一键补全工具"})])),_:1},8,["activeKey"]),c("div",null,[d(c("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>F.value=e),type:"number",placeholder:"请输入数字",style:{border:"1px solid #ccc",padding:"5px",width:"150px","margin-right":"10px",outline:"none"}},null,512),[[m,F.value]]),i(_,{type:"primary",class:"buttonstyle",onClick:D},{default:u((()=>a[6]||(a[6]=[p("确定")]))),_:1})]),i(o,{activeKey:e.activeKey,"onUpdate:activeKey":a[4]||(a[4]=a=>e.activeKey=a)},{default:u((()=>[i(l,{key:"1",tab:"产能合计"})])),_:1},8,["activeKey"]),i(x,{ref_key:"formRef",ref:t,model:w.value,"onUpdate:model":a[5]||(a[5]=e=>w.value=e),"form-list":b},null,8,["model"])])}}},L={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},C={style:{"font-size":"20px","font-weight":"400"}},S={class:"h-full w-full"},I={class:"modal-footer"},O=Object.assign({name:"manage_plan-monthly-production"},{__name:"index",setup(d){const m=o(null),v=o({layer:null,deliverytarget:null,time:b(new Date).format("YYYY-MM")}),y=o([]),f=[{type:"select",key:"layer",label:"层数",placeholder:"请选择层数",span:24,md:12,lg:8,xl:8,xxl:5,selectOptions:y},{type:"datePicker",key:"time",label:"年月",placeholder:"请输入年月",span:24,md:12,lg:8,xl:8,xxl:5,picker:"month",format:"YYYY-MM",valueFormat:"YYYY-MM"}];N().then((({data:e,error:a})=>{y.value=null==e?void 0:e.map((e=>({label:e,value:e})))}));const Y=[{key:"layer",dataIndex:"layer",title:"层数",fixed:"left",width:100,align:"center",checked:!0,ellipsis:!0},{key:"deliverytarget",dataIndex:"deliverytarget",title:i("span",{style:"color: #0000ff; font-weight: 600; font-size: larger;"},[p("交货目标产量")]),width:130,fixed:"left",align:"center",checked:!0,ellipsis:!0,className:"data-cell-sum"}],j=[{key:"operator",dataIndex:"operator",title:"创建人",width:80,align:"center",checked:!0},{key:"createDate",dataIndex:"createDate",title:"创建时间",width:150,align:"center",checked:!0},{key:"updateUser",dataIndex:"updateUser",title:"修改人",width:80,align:"center",checked:!0},{key:"updateDate",dataIndex:"updateDate",title:"修改时间",width:150,align:"center",checked:!0}],O=o([]),R=o({}),$=o(!1),z=o([]),T=o(!1),P=o(null);function q(){var e;v.value.layer,v.value.deliverytarget,v.value.time,(null==(e=v.value.time)?void 0:e[0])?(v.value.time[0],T.value=!0,M({startDate:v.value.time,...v.value}).then((e=>{const a=[];e.header.forEach(((e,l)=>{a.push({key:"day".concat(Number(e.split("-")[2])),dataIndex:"day".concat(Number(e.split("-")[2])),title:e,width:130,align:"center",checked:!0,ellipsis:!0,type:"number"})})),z.value=e.tableData.map((e=>({...e,tableUUid:x.generate()}))),O.value=[...Y,...a,...j]})).finally((()=>T.value=!1))):window.$message.error("请选择计划月份")}function B(){q()}q();const A=o(""),E=o([]),G=o(null);function H(){R.value={},$.value=!0,A.value="月计划产能目标新增"}function V(){var e;if(1!==E.value.length)return null==(e=window.$message)?void 0:e.error("请选择一条数据");A.value="月计划产能目标修改",G.value=E.value[0],$.value=!0}function W(){var e;if(0==E.value.length)return null==(e=window.$message)?void 0:e.error("请选择数据");window.$modal.confirm({title:"提醒",content:"确认删除所选数据吗？",onOk:()=>{const e=E.value;K(e).then((({error:e,data:a})=>{var l;e||(null==(l=window.$message)||l.success("删除成功"),E.value=[],q())}))},onCancel:()=>{}})}function Z(e){E.value=e}function J(){_((()=>{v.value={layer:null,time:b(new Date).format("YYYY-MM")},B()}))}return q(),(o,d)=>{const y=n,b=t,x=h,_=l,Y=a,N=g("STableSummaryCell"),M=g("STableSummaryRow"),K=e;return r(),s("div",L,[i(y,{ref_key:"commonSearchRef",ref:m,searchParams:v.value,"onUpdate:searchParams":d[0]||(d[0]=e=>v.value=e),"form-list":f,"is-search":!0,onSearch:B,onReset:J},null,8,["searchParams"]),i(K,{"row-class-name":o.rowClassName,"header-class-name":"custom-header",column:O.value,"data-source":z.value,loading:T.value,"summary-fixed":!0,"row-key":"tableUUid","row-height":55,scroll:{y:"auto"},"is-pagination":!1,class:"h-full","show-row-selection":!0,onTableSelectChange:Z},{title:u((()=>[i(x,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:H},{icon:u((()=>[i(b,{class:"align-sub text-icon"})])),default:u((()=>[d[4]||(d[4]=c("span",{class:"ml-3px"},"新增",-1))])),_:1}),i(x,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",disabled:1!==E.value.length,onClick:V},{icon:u((()=>[i(_,{class:"align-sub text-icon"})])),default:u((()=>[d[5]||(d[5]=c("span",{class:"ml-3px"},"修改",-1))])),_:1},8,["disabled"]),i(x,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:W},{icon:u((()=>[i(Y,{class:"align-sub text-icon"})])),default:u((()=>[d[6]||(d[6]=c("span",{class:"ml-3px"},"删除",-1))])),_:1})])),summary:u((()=>[i(M,null,{default:u((()=>[i(N,{index:0,"col-span":2,class:"text-center"},{default:u((()=>d[7]||(d[7]=[c("div",null,[c("span",{style:{"font-size":"26px","font-weight":"600"}},"总合计")],-1)]))),_:1}),i(N,{index:2,class:"text-center"},{default:u((({total:e})=>[c("span",C,w(e),1)])),_:1})])),_:1})])),_:1},8,["row-class-name","column","data-source","loading"]),i(k,{visible:$.value,"onUpdate:visible":d[3]||(d[3]=e=>$.value=e),"destroy-on-close":!0,centered:!0,title:A.value,width:"1200px",height:"730px"},{footer:u((()=>[c("div",I,[i(x,{onClick:d[1]||(d[1]=e=>$.value=!1)},{default:u((()=>d[8]||(d[8]=[p("关闭")]))),_:1}),i(x,{type:"primary",onClick:d[2]||(d[2]=e=>async function(e){const a={...P.value};await a.validateForm();const l=a.topFormModel;"月计划产能目标新增"===e?F(l).then((({data:e,error:a})=>{var l;a||(null==(l=window.$message)||l.success("新增成功"),$.value=!1)})):D(l).then((({data:e,error:a})=>{var l;a||(null==(l=window.$message)||l.success("修改成功"),E.value=[],G.value=null,$.value=!1)})),topFormModel.value.deliverytarget=""}(A.value))},{default:u((()=>d[9]||(d[9]=[p("保存")]))),_:1})])])),default:u((()=>[c("div",S,[i(U,{ref_key:"addFormRef",ref:P,"row-data":G.value},null,8,["row-data"])])])),_:1},8,["visible","title"])])}}});export{O as default};
