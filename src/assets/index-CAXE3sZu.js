import{_ as e}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import{d as l,K as a,L as t,o as i,c as n,w as s,g as r,f as o,s as d,h as u,t as c,I as m,v as p,N as v,ad as f,ae as g,O as h,B as x,P as w,Q as y,F as k,U as b,r as _,p as S,db as T,a9 as C,b as I,S as $,e as R,W as N,J as z}from"./index-B3PZsRwT.js";import{K as U,L as j,M as O,N as B,O as D,P as K}from"./index-DqnulfE2.js";import{_ as A}from"./modal.vue_vue_type_style_index_0_lang-Gjmj9w7c.js";import{C as E}from"./index-BThgVJ70.js";const F={class:"w-full flex"},J={class:"flex"},L={class:"w-full flex-y-center justify-end gap-12px"},M={class:"ml-3px"},P={class:"ml-3px"},Q=l({__name:"search",props:{model:{required:!0},modelModifiers:{}},emits:a(["search","reset"],["update:model"]),setup(e,{emit:l}){const a=l,b=t(e,"model");function _(){a("search",b.value)}function S(){b.value.matNo=null,b.value.state=null,b.value.auditingState=null,a("reset",b.value)}return(e,l)=>{const a=m,t=p,T=v,C=f,I=g,$=h,R=x,N=w,z=y,U=k,j=E;return i(),n(j,{title:null,bordered:!1,class:"search-card card-wrapper"},{default:s((()=>[r(U,{model:b.value,"label-col":{span:5,md:7},class:"search-form"},{default:s((()=>[o("div",F,[r(z,{gutter:[15,8],wrap:"",class:"w-full"},{default:s((()=>[r(T,{span:24,md:12,lg:6,xl:8,xxl:4},{default:s((()=>[r(t,{label:"物料编号",name:"matNo",class:"m-0","label-col":{}},{default:s((()=>[r(a,{value:b.value.matNo,"onUpdate:value":l[0]||(l[0]=e=>b.value.matNo=e),placeholder:"请输入物料编号",class:"min-form-control","allow-clear":"",autocomplete:"off",onKeypress:d(_,["enter"])},null,8,["value"])])),_:1})])),_:1}),r(T,{span:24,md:12,lg:6,xl:8,xxl:4},{default:s((()=>[r(t,{label:"过期状态",name:"state",class:"m-0","label-col":{}},{default:s((()=>[r(I,{value:b.value.state,"onUpdate:value":l[1]||(l[1]=e=>b.value.state=e),placeholder:"请选择状态",class:"min-form-control","allow-clear":""},{default:s((()=>[r(C,{value:"1"},{default:s((()=>l[3]||(l[3]=[u("正常")]))),_:1}),r(C,{value:"2"},{default:s((()=>l[4]||(l[4]=[u("即将过期")]))),_:1}),r(C,{value:"3"},{default:s((()=>l[5]||(l[5]=[u("已过期")]))),_:1}),r(C,{value:"4"},{default:s((()=>l[6]||(l[6]=[u("库存不足")]))),_:1})])),_:1},8,["value"])])),_:1})])),_:1}),r(T,{span:24,md:12,lg:6,xl:8,xxl:4},{default:s((()=>[r(t,{label:"审核状态",name:"auditingState",class:"m-0","label-col":{}},{default:s((()=>[r(I,{value:b.value.auditingState,"onUpdate:value":l[2]||(l[2]=e=>b.value.auditingState=e),placeholder:"请选择状态",class:"min-form-control","allow-clear":""},{default:s((()=>[r(C,{value:"1"},{default:s((()=>l[7]||(l[7]=[u("未审核")]))),_:1}),r(C,{value:"2"},{default:s((()=>l[8]||(l[8]=[u("已审核")]))),_:1})])),_:1},8,["value"])])),_:1})])),_:1}),o("div",J,[r(t,{class:"m-0"},{default:s((()=>[o("div",L,[r(R,{type:"primary",ghost:"",class:"mini-btn",onClick:_},{icon:s((()=>[r($,{class:"align-sub text-icon"})])),default:s((()=>[o("span",M,c(e.$t("common.search")),1)])),_:1}),r(R,{class:"mini-btn",onClick:S},{icon:s((()=>[r(N,{class:"align-sub text-icon"})])),default:s((()=>[o("span",P,c(e.$t("common.reset")),1)])),_:1})])])),_:1})])])),_:1})])])),_:1},8,["model"])])),_:1})}}}),q={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},W={class:"event-form"},G={class:"modal-footer"},H=z(Object.assign({name:"material-management_outer-dry-film"},{__name:"index",setup(l){b((e=>({ba5ed966:Z.value})));const a=_({matNo:"",state:"",auditingState:""}),t=S({current:1,pageSize:200,showSizeChanger:!0,pageSizeOptions:["50","100","200","300","500"],showQuickJumper:!0,showTotal:e=>"共".concat(e,"条"),total:0,onChange:async(e,l)=>{t.current=e,t.pageSize=l,v()}}),n=_([{key:"index",dataIndex:"index",title:"序号",width:100,align:"center",checked:!0},{key:"matNo",dataIndex:"matNo",title:"物料编号",width:230,align:"center",checked:!0,ellipsis:!0},{key:"failureState",dataIndex:"failureState",title:"过期状态",width:120,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>1==e.failureState?"正常":2==e.failureState?"即将过期":3==e.failureState?"已过期":4==e.failureState?"库存不足":void 0},{key:"auditingState",dataIndex:"auditingState",title:"审核状态",width:120,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>1==e.auditingState?"未审核":2==e.failureState?"已审核":void 0},{key:"specif",dataIndex:"specif",title:"物料规格",width:220,align:"center",checked:!0,ellipsis:!0},{key:"inventory",dataIndex:"inventory",title:"库存",width:140,align:"center",checked:!0,ellipsis:!0},{key:"productionTime",dataIndex:"productionTime",title:"生产时间",width:200,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>null==e.productionTime?null:T(e.productionTime)},{key:"expirationTime",dataIndex:"expirationTime",title:"失效时间",width:200,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>null==e.expirationTime?null:T(e.expirationTime)},{key:"storageTime",dataIndex:"storageTime",title:"入库时间",width:200,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>null==e.storageTime?null:T(e.storageTime)},{key:"expirationDays",dataIndex:"expirationDays",title:"距离到期时间",width:140,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>"".concat(e.expirationDays,"天")},{key:"createBy",dataIndex:"createBy",title:"入库员",width:140,align:"center",checked:!0,ellipsis:!0},{key:"changeTime",dataIndex:"changeTime",title:"更改时间",width:200,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>null==e.changeTime?null:T(e.changeTime)},{key:"outbound",dataIndex:"outbound",title:"出库员",width:140,align:"center",checked:!0,ellipsis:!0},{key:"auditing",dataIndex:"auditing",title:"审核人",width:140,align:"center",checked:!0,ellipsis:!0},{key:"auditingTime",dataIndex:"auditingTime",title:"审核时间",width:200,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>null==e.auditingTime?null:T(e.auditingTime)}]),d=[{type:"input",key:"inventory",label:"数量",placeholder:"请输入数量",span:24}],c=_([]),m=_(!1),p=_([]);function v(){m.value=!0,U({pageSize:t.pageSize,pageNum:t.current,...a.value}).then((({data:e,error:l})=>{l||(e.list.forEach(((e,l)=>{e.index=l+1})),c.value=e.list,t.total=e.total)})).finally((()=>{m.value=!1}))}const f=_([]);function g(e){f.value=e}function h(e){return 3===Number(e.failureState)?{backgroundColor:"rgb(243, 195, 195)"}:2===Number(e.failureState)?{backgroundColor:"rgb(238, 190, 140)"}:1===Number(e.failureState)?{backgroundColor:"rgb(150, 212, 150)"}:""}function w(){var e,l;if(0==f.value.length)return null==(e=window.$message)?void 0:e.error("请先选择一条数据");null==(l=window.$modal)||l.confirm({title:"是否确认删除数据?",onOk:()=>{delRoyiUser(delIds).then((({data:e,error:l})=>{var a,t;if(l)null==(t=window.$message)||t.error("删除失败!");else{const e=c.value.filter((e=>f.value.includes(e.id)));j(e).then((({data:e,error:l})=>{l||(f.value=[],v())})),null==(a=window.$message)||a.success("删除成功")}}))},onCancel:()=>{}})}const y=_(!1),k=_(""),z=_({});function F(){var e;if(0==f.value.length)return null==(e=window.$message)?void 0:e.error("请选择数据!");k.value="出库",y.value=!0}function J(){var e,l;if(0==f.value.length)return null==(e=window.$message)?void 0:e.error("请先选择数据!");null==(l=window.$modal)||l.confirm({title:"是否确认审核数据?",onOk:()=>{delRoyiUser(delIds).then((({data:e,error:l})=>{var a,t;if(l)null==(t=window.$message)||t.error("审核失败!");else{const e=c.value.filter((e=>f.value.includes(e.id)));B(e).then((({data:e,error:l})=>{l||(f.value=[],v())})),null==(a=window.$message)||a.success("审核成功")}}))},onCancel:()=>{}})}function L(){var e,l;if(0==f.value.length)return null==(e=window.$message)?void 0:e.error("请先选择数据!");null==(l=window.$modal)||l.confirm({title:"是否确认撤审数据?",onOk:()=>{delRoyiUser(delIds).then((({data:e,error:l})=>{var a,t;if(l)null==(t=window.$message)||t.error("撤审失败!");else{const e=c.value.filter((e=>f.value.includes(e.id)));D(e).then((({data:e,error:l})=>{l||(f.value=[],v())})),null==(a=window.$message)||a.success("撤审成功")}}))},onCancel:()=>{}})}function M(){K().then((({error:e,data:l})=>{var a;e||(null==(a=window.$message)||a.success("数据同步成功!"),v())}))}const P=_(null);function H(e,l){return{onDblclick:l=>{k.value="出库",f.value[0]=e.id,y.value=!0},style:{background:e.id===P.value?"#BAEAFA":"",...h(e)},class:e.id===P.value?"jl-table-row-selected":"",onClick:()=>{P.value=e.id}}}function V(){t.current=1,v()}v();const X=_(null),{height:Y}=C(X),Z=I((()=>"".concat(Y.value+20,"px")));return(l,h)=>{const b=x,_=e,S=$("STable"),T=E;return i(),R("div",q,[r(Q,{model:a.value,"onUpdate:model":h[0]||(h[0]=e=>a.value=e),onReset:h[1]||(h[1]=e=>V()),onSearch:h[2]||(h[2]=e=>V())},null,8,["model"]),r(T,{bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"table-card flex-col-stretch sm:flex-1-hidden card-wrapper"},{title:s((()=>[r(b,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:M},{default:s((()=>h[8]||(h[8]=[o("span",{class:"ml-3px"},"数据同步",-1)]))),_:1}),r(b,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:w},{default:s((()=>h[9]||(h[9]=[o("span",{class:"ml-3px"},"删除",-1)]))),_:1}),r(b,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:F},{default:s((()=>h[10]||(h[10]=[o("span",{class:"ml-3px"},"出库",-1)]))),_:1}),r(b,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:J},{default:s((()=>h[11]||(h[11]=[o("span",{class:"ml-3px"},"审核",-1)]))),_:1}),r(b,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:L},{default:s((()=>h[12]||(h[12]=[o("span",{class:"ml-3px"},"撤审",-1)]))),_:1})])),extra:s((()=>[r(_,{columns:n.value,"onUpdate:columns":h[3]||(h[3]=e=>n.value=e)},null,8,["columns"])])),default:s((()=>[r(S,{columns:n.value,"data-source":c.value,size:"small",bordered:"",loading:m.value,"row-selection":{selectedRowKeys:f.value,onChange:g},"custom-row":H,"default-expanded-row-keys":p.value,"row-key":"id","default-expand-all-rows":!0,scroll:{y:"auto"},pagination:t,"row-height":23,class:"has-footer-table h-full"},{footer:s((()=>[o("div",{ref_key:"tableFooterRef",ref:X,style:{display:"flex"}},h[13]||(h[13]=[o("div",{style:{display:"flex","line-height":"14px","margin-top":"5px","align-items":"center"}},[o("div",{style:{width:"20px",height:"14px","background-color":"rgb(243, 195, 195)"}}),o("span",null,"背景为10天内过期")],-1),o("div",{style:{display:"flex","line-height":"14px","margin-top":"5px","align-items":"center"}},[o("div",{style:{width:"20px",height:"14px","background-color":"rgb(238, 190, 140)"}}),o("span",null,"背景为15天内过期")],-1),o("div",{style:{display:"flex","line-height":"14px","margin-top":"5px","align-items":"center"}},[o("div",{style:{width:"20px",height:"14px","background-color":"rgb(150, 212, 150)"}}),o("span",null,"背景为正常")],-1)]),512)])),_:1},8,["columns","data-source","loading","row-selection","default-expanded-row-keys","pagination"])])),_:1}),r(A,{visible:y.value,"onUpdate:visible":h[7]||(h[7]=e=>y.value=e),"destroy-on-close":!0,centered:!0,title:k.value,width:"550px",height:"350px"},{footer:s((()=>[o("div",G,[r(b,{onClick:h[5]||(h[5]=e=>y.value=!1)},{default:s((()=>h[14]||(h[14]=[u("关闭")]))),_:1}),r(b,{onClick:h[6]||(h[6]=e=>function(){var e;if(!z.value.inventory)return null==(e=window.$message)?void 0:e.error("请输入数量!");z.value.id=f.value[0],O(z.value).then((({error:e,data:l})=>{var a;e||(null==(a=window.$message)||a.success("出库成功!"),z.value={},y.value=!1,f.value=[],k.value="",v())}))}(k.value))},{default:s((()=>h[15]||(h[15]=[u("保存")]))),_:1})])])),default:s((()=>[o("div",W,[r(N,{model:z.value,"onUpdate:model":h[4]||(h[4]=e=>z.value=e),"form-list":d},null,8,["model"])])])),_:1},8,["visible","title"])])}}}),[["__scopeId","data-v-0f41a77c"]]);export{H as default};
