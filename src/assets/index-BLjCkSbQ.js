import{_ as e}from"./round-download-DUbhM0Ds.js";import{_ as l}from"./round-add-MytOGm9O.js";import{_ as a}from"./table-DoFSI9NT.js";import{_ as t}from"./common-search.vue_vue_type_script_setup_true_lang-BX9APgbN.js";import{_ as n}from"./modal.vue_vue_type_style_index_0_lang-Gjmj9w7c.js";import{Z as d,ag as i,aa as o,r,o as s,e as c,g as u,W as m,c as p,a3 as h,a2 as g,B as y,h as v,b as k,w as f,i as b,f as x,t as w,a5 as _}from"./index-B3PZsRwT.js";import{_ as I}from"./index-Cn-BWYp5.js";import{E as N}from"./EditOutlined-5FYoGiVM.js";import{D as T}from"./DeleteOutlined-CWT7lRAZ.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import"./api-By23aosn.js";import"./index-BThgVJ70.js";import"./fromPairs-BI-MgVCs.js";const C={class:"event-form"},R={__name:"add",props:{rowData:{type:Object,default:()=>null},operateType:{type:String,default:()=>"add"}},setup(e,{expose:l}){const a=e,t=[{type:"tabs",name:"基本项目",span:24},{type:"input",key:"moldNo",label:"模具型号",placeholder:"请输入模具型号",span:12,rule:{required:!0,message:"请输入模具型号",trigger:"blur"}},{type:"select",key:"moldType",label:"模具类型",placeholder:"请选择模具类型",span:12,rule:{required:!0,message:"请选择模具类型",trigger:"blur"},selectOptions:[{value:1,label:"软模"},{value:2,label:"硬模"}]},{type:"select",key:"applyType",label:"申请类型",placeholder:"请选择申请类型",rule:{required:!0,message:"请选择申请类型",trigger:"blur"},span:12,selectOptions:[{value:1,label:"新开"},{value:2,label:"重开"}]},{type:"input",key:"moldAddress",label:"存放位置",placeholder:"请输入存放位置",span:12},{type:"select",key:"boardMaterial",label:"板材",placeholder:"请选择板材",span:12,selectOptions:[{value:"FR-1",label:"FR-1"},{value:"CEM-1",label:"CEM-1"},{value:"FR-4",label:"FR-4"},{value:"CEM-3",label:"CEM-3"}]},{type:"input",key:"boardThick",label:"板厚(MM)",placeholder:"请输入板厚(MM)",span:12},{type:"input",key:"moldInDate",label:"入厂日期",placeholder:"请输入入厂日期",span:12},{type:"input",key:"supplier",label:"供应商",placeholder:"请输入供应商",span:12},{type:"select",key:"moldState",label:"状态修改",placeholder:"请选择状态修改",span:"add"===a.operateType?0:12,selectOptions:[{value:1,label:"生效"},{value:2,label:"报废"},{value:3,label:"暂停"},{value:4,label:"调出"}]},{type:"textarea",key:"remark",label:"备注",placeholder:"请输入备注",span:24}];const n=r(null),d=r(function(){const e={};return t.forEach((l=>{l.key&&l.span&&("add"===a.operateType?e[l.key]=null:e[l.key]=a.rowData[l.key])})),e}());return l({model:d.value,validateForm:function(){return n.value.validateForm()}}),(e,l)=>(s(),c("div",C,[u(m,{ref_key:"formRef",ref:n,model:d.value,"onUpdate:model":l[0]||(l[0]=e=>d.value=e),"form-list":t},null,8,["model"])]))}},M={__name:"list",props:{moldId:{type:String,default:null}},setup(e){const l=e,a=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,fixed:"left",align:"center",checked:!0,ellipsis:!0},{key:"lotNo",dataIndex:"lotNo",title:"lot号",align:"center",checked:!0,ellipsis:!0,width:120},{key:"dateTime",dataIndex:"dateTime",title:"日期",align:"center",checked:!0,ellipsis:!0,width:120},{key:"punchNum",dataIndex:"punchNum",title:"当日冲次",align:"center",checked:!0,ellipsis:!0,width:100},{key:"punchTotal",dataIndex:"punchTotal",title:"累计冲次",align:"center",checked:!0,ellipsis:!0,width:100},{key:"grindNum",dataIndex:"grindNum",title:"研磨次数",align:"center",checked:!0,ellipsis:!0,width:100},{key:"grindPunchTotal",dataIndex:"grindPunchTotal",title:"研磨后累计冲次",align:"center",checked:!0,ellipsis:!0,width:100},{key:"grindFlagName",dataIndex:"grindFlagName",title:"是否研磨",align:"center",checked:!0,ellipsis:!0,width:100},{key:"createBy",dataIndex:"createBy",title:"创建人",align:"center",checked:!0,ellipsis:!0,width:100},{key:"operator",dataIndex:"operator",title:"作业员",align:"center",checked:!0,ellipsis:!0,width:100},{key:"remark",dataIndex:"remark",title:"备注",align:"center",checked:!0,ellipsis:!0,width:100},{key:"table-cz",dataIndex:"table-cz",title:"操作",align:"center",checked:!0,ellipsis:!0,width:100,fixed:"right",customRender:({record:e})=>u("div",null,[h(u(y,{type:"link",danger:!0,class:"pl-3px pr-3px",onClick:()=>{var l;l=e,window.$modal.confirm({title:"确定删除?",onOk:()=>{var e;(e=l.moldUseRecordUuid,d({url:"/qms/agv/frock/mold/use/record/delete/".concat(e),method:"delete"})).then((({error:e})=>{e||(window.$message.success("删除成功"),i())}))},onCancel:()=>{}})}},{default:()=>[v("删除")]}),[[g("hasAuth"),["stamping-die-management:mold-management:update"]]])])}],t=r([]),n=r(!1);function i(){var e;n.value=!0,(e={moldId:l.moldId},d({url:"/qms/agv/frock/mold/use/record/list",method:"get",params:e})).then((({data:e,error:l})=>{e.forEach(((e,l)=>{e.dataIndex=l+1})),t.value=e})).finally((()=>n.value=!1))}return i(),(e,l)=>{const d=I;return s(),p(d,{columns:a,"data-source":t.value,"row-key":"moldUseRecordUuid",scroll:{x:1800,y:"auto"},loading:n.value,pagination:!1,class:"h-full",bordered:"",size:"small"},null,8,["data-source","loading"])}}},q={class:"event-form"},D={__name:"records",setup(e,{expose:l}){const a=r([]);d({url:"/qms/agv/frock/mold/record/list?pageNum=1&pageSize=999999",method:"get"}).then((({error:e,data:l})=>{e||(a.value=l.list.map((e=>({value:e.moldNo,label:e.moldNo}))))}));const t=[{type:"tabs",name:"基本项目",span:24},{type:"searchInput",key:"lotNo",label:"LOT号",placeholder:"请输入LOT号",span:12,rule:{required:!0,message:"请输入模具型号",trigger:"blur"},handleSearch(){var e;(e=n.value.lotNo,d({url:"/qms/agv/frock/mold/use/record/punchQty",method:"get",params:{lotNo:e}})).then((({data:e,error:l})=>{l||(n.value.punchNum=e.setQty)}))}},{type:"select",key:"moldNo",label:"模具型号",placeholder:"请选择模具型号",search:!0,span:12,rule:{required:!0,message:"请选择模具类型",trigger:"blur"},selectOptions:a},{type:"input",key:"punchNum",label:"使用次数",placeholder:"请输入使用次数",span:12},{span:12,type:"datePicker",key:"dateTime",label:"日期",rule:{required:!0,message:"请选择日期",trigger:"change"},tansfromDisabled:e=>"look"===e},{type:"select",key:"moldState",label:"是否研磨",span:12,selectOptions:[{value:"0",label:"否"},{value:"1",label:"是"}]},{type:"input",key:"grindNum",label:"研磨次数",placeholder:"请输入研磨次数",span:12},{type:"input",key:"operator",label:"作业员",rule:{required:!0,message:"请输入作业员",trigger:"blur"},placeholder:"请输入作业员",span:12},{type:"textarea",key:"remark",label:"备注",placeholder:"请输入备注",span:12,textareaRows:1}],n=r(function(){const e={};return t.forEach((l=>{l.key&&l.span&&(e[l.key]=null)})),e}());const i=r(null);return l({model:n.value,validateForm:function(){return i.value.validateForm()}}),(e,l)=>(s(),c("div",q,[u(m,{ref_key:"formRef",ref:i,model:n.value,"onUpdate:model":l[0]||(l[0]=e=>n.value=e),"form-list":t},null,8,["model"])]))}},U={class:"mold-management-page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},j={class:"modal-footer"},O={class:"modal-footer"},S={class:"modal-footer"},P=Object.assign({name:"workwear_stamping-die-management_mold-management"},{__name:"index",setup(I){const C=r(null),q=r(null),P=r({moldNo:null,moldState:null,time:null}),F=[{type:"input",key:"moldNo",label:"模具编号",placeholder:"请输入模具编号",span:24,md:12,lg:8,xl:8,xxl:6},{type:"select",key:"moldState",label:"状态",placeholder:"请输入状态",span:24,md:12,lg:8,xl:8,xxl:6,selectOptions:r([{value:1,label:"生效"},{value:2,label:"报废"},{value:3,label:"暂停"},{value:4,label:"调出"}])},{type:"dateRangePicker",key:"time",label:"日期",span:24,md:12,lg:10,xl:8,xxl:6}],Y=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,fixed:"left",align:"center",checked:!0,ellipsis:!0},{key:"moldNo",dataIndex:"moldNo",title:"模具型号",align:"center",checked:!0,ellipsis:!0,fixed:"left",width:180,customRender:({record:e})=>u(y,{type:"link",onClick:()=>{return l=e,ce.value=l.moldUuid,void(ue.value=!0);var l}},{default:()=>[e.moldNo]})},{key:"moldStateName",dataIndex:"moldStateName",title:"状态",align:"center",checked:!0,ellipsis:!0,width:100},{key:"moldTypeName",dataIndex:"moldTypeName",title:"模具类型",align:"center",checked:!0,ellipsis:!0,width:120},{key:"applyTypeName",dataIndex:"applyTypeName",title:"申请类型",align:"center",checked:!0,ellipsis:!0,width:120},{key:"boardMaterial",dataIndex:"boardMaterial",title:"板材",align:"center",checked:!0,ellipsis:!0,width:100},{key:"moldTypeNames",dataIndex:"moldTypeNames",title:"使用寿命",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>"软模"===e.moldTypeName?"20万次":"硬模"===e.moldTypeName?"12万次":""},{key:"moldTypeName1",dataIndex:"moldTypeName1",title:"管控研磨冲次",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>"软模"===e.moldTypeName?"4万次":"硬模"===e.moldTypeName?"3万次":""},{key:"boardThick",dataIndex:"boardThick",title:"板厚(MM)",align:"center",checked:!0,ellipsis:!0,width:160},{key:"punchTotal",dataIndex:"punchTotal",title:"总使用次数",align:"center",checked:!0,ellipsis:!0,width:160},{key:"grindPunchTotal",dataIndex:"grindPunchTotal",title:"研磨后累计使用次数",align:"center",checked:!0,ellipsis:!0,width:190},{key:"moldAddress",dataIndex:"moldAddress",title:"存放位置",align:"center",checked:!0,ellipsis:!0,width:100},{key:"applyBy",dataIndex:"applyBy",title:"申请人",align:"center",checked:!0,ellipsis:!0,width:100},{key:"applyDate",dataIndex:"applyDate",title:"申请时间",align:"center",checked:!0,ellipsis:!0,width:180},{key:"moldInDate",dataIndex:"moldInDate",title:"入场日期",align:"center",checked:!0,ellipsis:!0,width:180},{key:"supplier",dataIndex:"supplier",title:"供应商",align:"center",checked:!0,ellipsis:!0,width:120},{key:"repealBy",dataIndex:"repealBy",title:"报废人",align:"center",checked:!0,ellipsis:!0,width:120},{key:"repealDate",dataIndex:"repealDate",title:"报废日期",align:"center",checked:!0,ellipsis:!0,width:180},{key:"repealRemark",dataIndex:"repealRemark",title:"报废原因",align:"center",checked:!0,ellipsis:!0,width:150},{key:"remark",dataIndex:"remark",title:"备注",align:"center",checked:!0,ellipsis:!0,width:180}],z=k((()=>{var e;const l={...P.value};return(null==(e=P.value)?void 0:e[0])&&(l.startTime=dayjs(P.value.time[0]).format("YYYY-MM-DD"),l.endTime=dayjs(P.value.time[1]).format("YYYY-MM-DD")),delete l.time,l}));function E(){q.value.getData(1)}function B(){_((()=>{P.value={keywords:null,noticeState:null},E()}))}const $=r("add"),A=r(!1),H=r(!1),L=r(null),Q=r(null);function W(e){L.value=e,A.value=!0,$.value=e?"edit":"add"}function Z(){A.value=!1}async function G(){const e={...Q.value};let l;await e.validateForm(),H.value=!0;const a={...e.model};l="add"===$.value?d({url:"/qms/agv/frock/mold/record/save",method:"post",data:a}):function(e){return d({url:"/qms/agv/frock/mold/record/update",method:"put",data:e})}({...a,moldUuid:L.value.moldUuid}),l.then((({error:e})=>{e||(window.$message.success("".concat("add"===$.value?"新增":"修改","成功")),Z(),B())})).finally((()=>H.value=!1))}function J(e){window.$modal.confirm({title:"确定删除?",onOk:()=>{var l;(l=e.moldUuid,d({url:"/qms/agv/frock/mold/record/delete/".concat(l),method:"delete"})).then((({error:e})=>{e||(window.$message.success("删除成功"),E())}))},onCancel:()=>{}})}function K(){var e;e={...z.value},i({url:"/qms/agv/frock/mold/record/export",params:e,method:"get",fileName:"冲压模具导出".concat(o().format("YYYY-MM-DD HH:mm:ss"),".xlsx")})}const V=r(!1),X=r({repealRemark:null}),ee=[{type:"textarea",key:"repealRemark",label:"报废原因",rule:{required:!0,message:"请输入报废原因",trigger:"blur"},placeholder:"请输入报废原因",span:24}],le=r(!1),ae=r(null),te=r(null);function ne(){V.value=!1,X.value.repealRemark=null}async function de(){const e={...X.value,moldUuid:te.value.moldUuid};var l;await ae.value.validateForm(),le.value=!0,(l=e,d({url:"/qms/agv/frock/mold/record/repeal",method:"put",data:l})).then((({error:e})=>{e||(window.$message.success("报废成功"),ne(),B())})).finally((()=>le.value=!1))}function ie(e){if(1===Number(e.moldState)){if("硬模"===e.moldTypeName&&(e.punchTotal>=1e5||e.grindPunchTotal>=26e3))return{backgroundColor:"rgb(155, 240, 217)"};if("软模"===e.moldTypeName&&(e.punchTotal>=18e4||e.grindPunchTotal>=36e3))return{backgroundColor:"rgb(239, 239, 136)"}}return 2===Number(e.moldState)?{backgroundColor:"rgb(247, 109, 109)"}:{}}const oe=e=>({style:ie(e)}),re=r([]);function se(e){re.value=e}const ce=r(null),ue=r(!1),me=r(null);function pe(){ue.value=!1}const he=r(!1),ge=r(!1);function ye(){he.value=!0}function ve(){he.value=!1}async function ke(){const e={...me.value};await e.validateForm();const l={...e.model};ge.value=!0,function(e){return d({url:"/qms/agv/frock/mold/use/record/save",method:"post",data:e})}(l).then((({error:e})=>{e||(window.$message.success("保存成功"),ve(),B())})).finally((()=>ge.value=!1))}return(d,i)=>{const o=l,r=y,k=e,_=g("hasAuth");return s(),c("div",U,[u(t,{ref_key:"commonSearchRef",ref:C,searchParams:P.value,"onUpdate:searchParams":i[0]||(i[0]=e=>P.value=e),"form-list":F,"is-search":!0,onSearch:E,onReset:B},null,8,["searchParams"]),u(a,{ref_key:"tableRef",ref:q,searchParams:z.value,"onUpdate:searchParams":i[5]||(i[5]=e=>z.value=e),column:Y,"show-row-selection":!0,"auto-generate-uuid":!0,class:"h-full",scroll:{x:3010,y:"auto"},"is-init-get-data":"","table-custom-row":oe,url:"/qms/agv/frock/mold/record/list",onTableSelectChange:se},{tableTitle:f((()=>[h((s(),p(r,{type:"primary",class:"mini-btn mr-8px",size:"small",ghost:"",onClick:i[1]||(i[1]=e=>W(null))},{icon:f((()=>[u(o,{class:"align-sub text-icon"})])),default:f((()=>[i[11]||(i[11]=v(" 新增 "))])),_:1})),[[_,["stamping-die-management:mold-management:add"]]]),h((s(),p(r,{type:"primary",class:"mini-btn mr-8px",size:"small",ghost:"",disabled:1!=re.value.length,onClick:i[2]||(i[2]=e=>W(re.value[0]))},{icon:f((()=>[u(b(N),{class:"align-sub"})])),default:f((()=>[i[12]||(i[12]=v(" 修改 "))])),_:1},8,["disabled"])),[[_,["stamping-die-management:mold-management:update"]]]),h((s(),p(r,{type:"primary",danger:"",class:"mini-btn mr-8px",size:"small",ghost:"",disabled:1!=re.value.length,onClick:i[3]||(i[3]=e=>J(re.value[0]))},{icon:f((()=>[u(b(T),{class:"align-sub"})])),default:f((()=>[i[13]||(i[13]=v(" 删除 "))])),_:1},8,["disabled"])),[[_,["stamping-die-management:mold-management:del"]]]),h((s(),p(r,{type:"primary",class:"mini-btn mr-8px",size:"small",ghost:"",disabled:1!=re.value.length,onClick:i[4]||(i[4]=e=>{return l=re.value[0],V.value=!0,void(te.value=l);var l})},{icon:f((()=>i[14]||(i[14]=[x("em",{class:"iconfont icon-baofei align-sub"},null,-1)]))),default:f((()=>[i[15]||(i[15]=v(" 报废 "))])),_:1},8,["disabled"])),[[_,["stamping-die-management:mold-management:scrap"]]]),h((s(),p(r,{type:"primary",class:"mini-btn mr-8px",size:"small",ghost:"",onClick:ye},{icon:f((()=>i[16]||(i[16]=[x("span",{class:"icon iconfont icon-jilubiao"},null,-1)]))),default:f((()=>[i[17]||(i[17]=v(" 记录 "))])),_:1})),[[_,["stamping-die-management:mold-management:records"]]]),h((s(),p(r,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:K},{icon:f((()=>[u(k,{class:"align-sub text-icon"})])),default:f((()=>[i[18]||(i[18]=x("span",{class:"ml-3px"},"导出",-1))])),_:1})),[[_,["stamping-die-management:mold-management:upload"]]])])),footer:f((()=>i[19]||(i[19]=[x("div",{class:"flex gap-15px"},[x("div",{style:{display:"flex","line-height":"14px","margin-top":"5px"}},[x("div",{style:{width:"20px",height:"14px","background-color":"rgb(155, 240, 217)"}}),x("span",null,"背景为硬模总冲次达到100000或者研磨后累计使用次数达到26000")]),x("div",{style:{display:"flex","line-height":"14px","margin-top":"5px"}},[x("div",{style:{width:"20px",height:"14px","background-color":"rgb(239, 239, 136)"}}),x("span",null,"背景为软模总冲次达到180000或者研磨后累计使用次数达到36000")]),x("div",{style:{display:"flex","line-height":"14px","margin-top":"5px"}},[x("div",{style:{width:"20px",height:"14px","background-color":"rgb(247, 109, 109)"}}),x("span",null,"背景为已报废模具")])],-1)]))),_:1},8,["searchParams"]),u(n,{visible:A.value,"onUpdate:visible":i[6]||(i[6]=e=>A.value=e),title:"模具管理".concat("add"===$.value?"新增":"修改"),width:"800px",height:"500px","destroy-on-close":!0,onClose:Z},{footer:f((()=>[x("div",j,[u(r,{loading:H.value,type:"primary",onClick:G},{default:f((()=>[v(w("add"===$.value?"新增":"修改"),1)])),_:1},8,["loading"]),u(r,{onClick:Z},{default:f((()=>i[20]||(i[20]=[v("关 闭")]))),_:1})])])),default:f((()=>[u(R,{ref_key:"addRef",ref:Q,"row-data":L.value,"operate-type":$.value},null,8,["row-data","operate-type"])])),_:1},8,["visible","title"]),u(n,{visible:V.value,"onUpdate:visible":i[8]||(i[8]=e=>V.value=e),title:"报废",width:"700px",height:"232px","destroy-on-close":!0,onClose:ne},{footer:f((()=>[x("div",O,[u(r,{loading:le.value,type:"primary",onClick:de},{default:f((()=>i[21]||(i[21]=[v("报废")]))),_:1},8,["loading"]),u(r,{onClick:ne},{default:f((()=>i[22]||(i[22]=[v("关 闭")]))),_:1})])])),default:f((()=>[u(m,{ref_key:"formRef",ref:ae,model:X.value,"onUpdate:model":i[7]||(i[7]=e=>X.value=e),"form-list":ee},null,8,["model"])])),_:1},8,["visible"]),u(n,{visible:ue.value,"onUpdate:visible":i[9]||(i[9]=e=>ue.value=e),title:"使用记录详情",width:"80vw",height:"70vh",centered:!0,"destroy-on-close":!0,onClose:pe},{footer:f((()=>i[23]||(i[23]=[x("div",null,null,-1)]))),default:f((()=>[u(M,{"mold-id":ce.value},null,8,["mold-id"])])),_:1},8,["visible"]),u(n,{visible:he.value,"onUpdate:visible":i[10]||(i[10]=e=>he.value=e),title:"使用记录填写",width:"900px",height:"488px",centered:!0,"destroy-on-close":!0,onClose:ve},{footer:f((()=>[x("div",S,[u(r,{loading:ge.value,type:"primary",onClick:ke},{default:f((()=>i[24]||(i[24]=[v("保存")]))),_:1},8,["loading"]),u(r,{onClick:ve},{default:f((()=>i[25]||(i[25]=[v("关 闭")]))),_:1})])])),default:f((()=>[u(D,{ref_key:"recordsRef",ref:me},null,512)])),_:1},8,["visible"])])}}});export{P as default};
