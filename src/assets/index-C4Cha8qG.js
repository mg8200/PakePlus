import{Z as e,r as l,o as t,e as a,g as n,W as o,a5 as i,f as r,ac as c,w as s,h as d,aj as u,aa as p,B as m,b as v}from"./index-B3PZsRwT.js";import{_ as k}from"./table-DoFSI9NT.js";import{_ as y}from"./common-search.vue_vue_type_script_setup_true_lang-BX9APgbN.js";import{_ as h}from"./modal.vue_vue_type_style_index_0_lang-Gjmj9w7c.js";import{_ as f}from"./index-Cn-BWYp5.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import"./api-By23aosn.js";import"./index-BThgVJ70.js";import"./fromPairs-BI-MgVCs.js";const g={class:"event-form"},x={__name:"edit",props:{rowData:{type:Object,default:()=>null}},setup(e,{expose:i}){const r=e;const c=l(function(){if(r.rowData){const{operator:e,operatorTime:l,evenReason:t,evenSolution:a}=r.rowData;return{operator:e,operatorTime:l,evenReason:t,evenSolution:a}}return{operator:null,operatorTime:null,evenReason:null,evenSolution:null}}()),s=[{type:"tabs",name:"基本信息",span:24},{type:"input",key:"operator",disabled:!0,label:"处理人",placeholder:"请输入处理人",span:24},{type:"datePicker",key:"operatorTime",label:"处理时间",span:24,showTime:!0},{type:"textarea",key:"evenReason",label:"原因分析",placeholder:"请输入原因分析",span:24},{type:"textarea",key:"evenSolution",label:"改善措施",placeholder:"请输入改善措施",span:24}];return i({model:c.value}),(e,l)=>(t(),a("div",g,[n(o,{model:c.value,"onUpdate:model":l[0]||(l[0]=e=>c.value=e),"form-list":s},null,8,["model"])]))}},w={class:"event-form"},_={__name:"check",props:{rowData:{type:Object,default:()=>null}},setup(e,{expose:i}){const r=e;const c=l(function(){if(r.rowData){const{checkResult:e,checkDesc:l}=r.rowData;return{checkResult:e,checkDesc:l}}return{checkResult:null,checkDesc:null}}()),s=[{type:"tabs",name:"基本信息",span:24},{type:"radio",key:"checkResult",label:"确认结果",span:24,rule:{required:!0,message:"请选择确认结果",trigger:"change"},selectOptions:[{label:"通过",value:"1"},{label:"不通过",value:"2"}]},{type:"textarea",key:"checkDesc",label:"验证备注",placeholder:"请输入验证备注",span:24}],d=l(null);return i({model:c.value,validateForm:async function(){await d.value.validateForm()}}),(e,l)=>(t(),a("div",w,[n(o,{ref_key:"formRef",ref:d,model:c.value,"onUpdate:model":l[0]||(l[0]=e=>c.value=e),"form-list":s},null,8,["model"])]))}},b={class:"h-50% table"},R={class:"modal-footer"},I={class:"modal-footer"},D={__name:"recover",props:{row:{type:Object,default:()=>null}},setup(v,{expose:k}){const y=v,g=l(null),w=l(300);i((()=>{w.value=g.value.clientHeight/2}));const D=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,fixed:"left",align:"center",checked:!0,ellipsis:!0},{key:"evenReason",dataIndex:"evenReason",title:"原因分析",align:"center",checked:!0,ellipsis:!0},{key:"evenSolution",dataIndex:"evenSolution",title:"改善措施",align:"center",checked:!0,ellipsis:!0},{key:"operator",dataIndex:"operator",title:"处理人",align:"center",checked:!0,ellipsis:!0},{key:"operatorTime",dataIndex:"operatorTime",title:"时间",align:"center",checked:!0,ellipsis:!0},{key:"checkResultName",dataIndex:"checkResultName",title:"验证结果",align:"center",checked:!0,ellipsis:!0},{key:"checkTime",dataIndex:"checkTime",title:"验证时间",align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>p(e.checkTime).format("YYYY-MM-DD HH:mm:ss")},{key:"checkDesc",dataIndex:"checkDesc",title:"验证备注",align:"center",checked:!0,ellipsis:!0},{key:"checker",dataIndex:"checker",title:"验证人",align:"center",checked:!0,ellipsis:!0},{key:"czRow",dataIndex:"czRow",title:"操作",align:"center",checked:!0,ellipsis:!0,customRender:({record:l})=>l.checkResultName?"":n("div",null,[n(m,{type:"link",danger:!0,class:"pl-3px pr-3px",onClick:()=>{var t;t=l,window.$modal.confirm({title:"确定删除?",onOk:()=>{var l;(l=t.noticetReplyUuid,e({url:"/qms/agv/notice/delete/".concat(l),method:"delete"})).then((({error:e})=>{e||(window.$message.success("删除成功"),T())}))},onCancel:()=>{}})}},{default:()=>[d("删除")]}),n(m,{type:"link",class:"pl-3px pr-3px",onClick:()=>{var e;e=l,Y.value=e,C.value=!0}},{default:()=>[d("修改")]}),n(m,{type:"link",class:"pl-3px pr-3px",onClick:()=>{return e=l,A.value=e,void(F.value=!0);var e}},{default:()=>[d("验证")]})])}],U=l([]);function T(){var l;(l={noticeId:y.row.noticeUuid},e({url:"/qms/agv/notice/reply/list",method:"get",params:l})).then((({data:e,error:l})=>{l||(null==e||e.forEach(((e,l)=>{e.dataIndex=l+1})),U.value=e)}))}T();const C=l(!1),S=l(!1),j=l(null),Y=l(null);function q(){C.value=!1}function N(){S.value=!0;const l={...{...j.value.model},noticetReplyUuid:Y.value.noticetReplyUuid};var t;(t=l,e({url:"/qms/agv/notice/reply/update",method:"put",data:t})).then((({error:e})=>{e||(window.$message.success("修改成功"),C.value=!1,T())})).finally((()=>S.value=!1))}const M=[{type:"tabs",span:24,name:"回复信息"},{type:"textarea",key:"evenReason",label:"原因分析",placeholder:"请输入原因分析",span:24,rule:{required:!0,message:"请输入原因分析",trigger:"blur"}},{type:"textarea",key:"evenSolution",label:"改善措施",placeholder:"请输入改善措施",rule:{required:!0,message:"请输入改善措施",trigger:"blur"},span:24}],O=l({evenReason:null,evenSolution:null}),P=l(null);const $=l(null),z=e=>({style:{},class:e.noticetReplyUuid===$.value?"jl-table-row-selected":"",onClick:()=>{$.value=e.noticetReplyUuid}}),F=l(!1),H=l(!1),B=l(null),A=l(null);function E(){F.value=!1}async function W(){const l={...{...B.value.model},noticetReplyUuid:A.value.noticetReplyUuid};if(!l.checkResult)return void window.$message.error("请选择验证结果");H.value=!0;const{error:t}=await function(l){return e({url:"/qms/agv/notice/reply/check",method:"put",data:l})}(l);t||(window.$message.success("操作成功"),E(),T()),H.value=!1}return k({submitForm:async function(){await P.value.validateForm();const l={noticeId:y.row.noticeUuid,...O.value},{error:t}=await function(l){return e({url:"/qms/agv/notice/reply/save",method:"post",data:l})}(l);t||(window.$message.success("回复成功"),handleClose())}}),(e,l)=>{const i=f,p=m;return t(),a(u,null,[r("div",{ref_key:"recoverModalRef",ref:g,class:"recover-modal h-full w-full"},[r("div",b,[n(i,{"data-source":U.value,columns:D,pagination:!1,size:"small","row-key":"noticetReplyUuid",bordered:"",scroll:{y:w.value}},null,8,["data-source","scroll"])]),r("div",{class:"form",style:c({height:"calc(100% - ".concat(w.value+29,"px)")})},[n(o,{ref_key:"formRef",ref:P,model:O.value,"onUpdate:model":l[0]||(l[0]=e=>O.value=e),"form-list":M},null,8,["model"])],4)],512),n(h,{visible:C.value,"onUpdate:visible":l[1]||(l[1]=e=>C.value=e),title:"修改",width:"666px",height:"460px","row-key":"noticetReplyUuid","custom-row":z,centered:!0,"destroy-on-close":!0,onClose:q},{footer:s((()=>[r("div",R,[n(p,{loading:S.value,type:"primary",onClick:N},{default:s((()=>l[3]||(l[3]=[d("回 复")]))),_:1},8,["loading"]),n(p,{onClick:q},{default:s((()=>l[4]||(l[4]=[d("关 闭")]))),_:1})])])),default:s((()=>[n(x,{ref_key:"editRef",ref:j,"row-data":Y.value},null,8,["row-data"])])),_:1},8,["visible"]),n(h,{visible:F.value,"onUpdate:visible":l[2]||(l[2]=e=>F.value=e),title:"验证",width:"666px",height:"460px","custom-row":z,centered:!0,"destroy-on-close":!0,onClose:q},{footer:s((()=>[r("div",I,[n(p,{loading:H.value,type:"primary",onClick:W},{default:s((()=>l[5]||(l[5]=[d("验 证")]))),_:1},8,["loading"]),n(p,{onClick:E},{default:s((()=>l[6]||(l[6]=[d("关 闭")]))),_:1})])])),default:s((()=>[n(_,{ref_key:"checkRef",ref:B,"row-data":A.value},null,8,["row-data"])])),_:1},8,["visible"])],64)}}},U={class:"message jl-main-page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},T={class:"modal-footer"},C=Object.assign({name:"manage_message-manage_list"},{__name:"index",setup(o){const c=l(null),u=l(null),f=l({keywords:null,noticeState:null,time:null}),g=l([]),x=[{type:"input",key:"keywords",label:"消息标题",placeholder:"请输入消息标题",span:24,md:12,lg:8,xl:8,xxl:6},{type:"select",key:"noticeState",label:"消息状态",placeholder:"请输入消息状态",span:24,md:12,lg:8,xl:8,xxl:6,selectOptions:g},{type:"dateRangePicker",key:"time",label:"日期",span:24,md:12,lg:10,xl:8,xxl:6}],w=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,fixed:"left",align:"center",checked:!0,ellipsis:!0},{key:"noticeTitle",dataIndex:"noticeTitle",title:"消息标题",align:"center",checked:!0,ellipsis:!0},{key:"noticeDescription",dataIndex:"noticeDescription",title:"消息内容",align:"center",checked:!0,ellipsis:!0},{key:"noticeUrl",dataIndex:"noticeUrl",title:"消息链接",align:"center",checked:!0,ellipsis:!0},{key:"noticeTypeName",dataIndex:"noticeTypeName",title:"消息类型",align:"center",checked:!0,ellipsis:!0},{key:"noticeStateName",dataIndex:"noticeStateName",title:"消息状态",align:"center",checked:!0,ellipsis:!0},{key:"sender",dataIndex:"sender",title:"发件人",align:"center",checked:!0,ellipsis:!0},{key:"recipientName",dataIndex:"recipientName",title:"收件人",align:"center",checked:!0,ellipsis:!0},{key:"createTime",dataIndex:"createTime",title:"创建时间",align:"center",checked:!0,ellipsis:!0,width:180,customRender:({record:e})=>p(e.createTime).format("YYYY-MM-DD HH:mm:ss")},{key:"czRow",dataIndex:"czRow",title:"操作",align:"center",checked:!0,ellipsis:!0,width:180,customRender:({record:l})=>n("div",null,[n(m,{type:"link",danger:!0,class:"pl-3px pr-3px",onClick:()=>{var t;t=l,window.$modal.confirm({title:"确定删除?",onOk:()=>{var l;(l=t.noticeUuid,e({url:"/qms/agv/notice/reply/delete/".concat(l),method:"delete"})).then((({error:e})=>{e||(window.$message.success("删除成功"),b())}))},onCancel:()=>{}})}},{default:()=>[d("删除")]}),1!==Number(l.noticeType)?n(m,{type:"link",class:"pl-3px pr-3px",onClick:()=>{var e;e=l,S.value=e,I.value=!0}},{default:()=>[d("回复")]}):""])}],_=v((()=>{var e,l;const t={...f.value};return(null==(l=null==(e=f.value)?void 0:e.time)?void 0:l[0])&&(t.startTime=p(f.value.time[0]).format("YYYY-MM-DD"),t.endTime=p(f.value.time[1]).format("YYYY-MM-DD")),delete t.time,t}));function b(){u.value.getData(1)}function R(){i((()=>{f.value={keywords:null,noticeState:null,time:null},b()}))}e({url:"/qms/agv/notice/noticeState",method:"get"}).then((({data:e,error:l})=>{l||(g.value=e.map((e=>({label:e.noticeStateName,value:e.noticeState}))))}));const I=l(!1),C=l(!1),S=l(null);function j(){I.value=!1}const Y=l(null);async function q(){Y.value.submitForm()&&j()}return(e,l)=>{const o=m;return t(),a("div",U,[n(y,{ref_key:"commonSearchRef",ref:c,searchParams:f.value,"onUpdate:searchParams":l[0]||(l[0]=e=>f.value=e),"form-list":x,"is-search":!0,onSearch:b,onReset:R},null,8,["searchParams"]),n(k,{ref_key:"tableRef",ref:u,searchParams:_.value,"onUpdate:searchParams":l[1]||(l[1]=e=>_.value=e),column:w,"show-row-selection":!1,"row-key":"noticeUuid",scroll:{y:"auto"},"is-init-get-data":"",url:"/qms/agv/notice/list"},null,8,["searchParams"]),n(h,{visible:I.value,"onUpdate:visible":l[2]||(l[2]=e=>I.value=e),title:"回复",width:"70vw",height:"80vh",centered:!0,"destroy-on-close":!0,onClose:j},{footer:s((()=>[r("div",T,[n(o,{loading:C.value,type:"primary",onClick:q},{default:s((()=>l[3]||(l[3]=[d("回 复")]))),_:1},8,["loading"]),n(o,{onClick:j},{default:s((()=>l[4]||(l[4]=[d("关 闭")]))),_:1})])])),default:s((()=>[n(D,{ref_key:"recoverRef",ref:Y,row:S.value},null,8,["row"])])),_:1},8,["visible"])])}}});export{C as default};
