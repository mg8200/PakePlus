import{_ as e}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import{_ as l}from"./round-add-MytOGm9O.js";import{_ as a}from"./round-delete-DScxCu5A.js";import{_ as t}from"./round-edit-DZi1TDWc.js";import{d as s,K as u,L as d,o,c as n,w as r,g as c,f as i,s as p,h as m,t as f,I as v,v as _,N as h,ad as x,ae as y,O as b,B as g,P as w,Q as k,F as N,n as I,q as j,r as R,a0 as C,a6 as U,dr as O,ds as T,cn as z,de as F,dj as $,db as S,a3 as q,a2 as H,e as K,aD as M,dt as P,du as A}from"./index-B3PZsRwT.js";import{f as B,h as D,i as G,j as L}from"./system-manage-DyXHkc6D.js";import{_ as Q}from"./modal.vue_vue_type_style_index_0_lang-Gjmj9w7c.js";import{C as E}from"./index-BThgVJ70.js";import{_ as J}from"./index-Cn-BWYp5.js";import"./fromPairs-BI-MgVCs.js";const V={class:"w-full flex"},W={class:"flex"},X={class:"w-full flex-y-center justify-end gap-12px"},Y={class:"ml-3px"},Z={class:"ml-3px"},ee=s({__name:"search",props:{model:{required:!0},modelModifiers:{}},emits:u(["search","reset"],["update:model"]),setup(e,{emit:l}){const a=l,t=d(e,"model");function s(){a("search",t.value)}function u(){t.value.deptName=null,t.value.status=null,a("reset",t.value)}return(e,l)=>{const a=v,d=_,I=h,j=x,R=y,C=b,U=g,O=w,T=k,z=N,F=E;return o(),n(F,{title:null,bordered:!1,class:"search-card card-wrapper"},{default:r((()=>[c(z,{model:t.value,"label-col":{span:5,md:7},class:"search-form"},{default:r((()=>[i("div",V,[c(T,{gutter:[15,8],wrap:"",class:"w-full"},{default:r((()=>[c(I,{span:24,md:12,lg:6,xl:8,xxl:4},{default:r((()=>[c(d,{label:"部门名称",name:"deptName",class:"m-0","label-col":{}},{default:r((()=>[c(a,{value:t.value.deptName,"onUpdate:value":l[0]||(l[0]=e=>t.value.deptName=e),placeholder:"请输入部门名称",class:"min-form-control","allow-clear":"",autocomplete:"off",onKeypress:p(s,["enter"])},null,8,["value"])])),_:1})])),_:1}),c(I,{span:24,md:12,lg:6,xl:8,xxl:4},{default:r((()=>[c(d,{label:"部门状态",name:"status",class:"m-0","label-col":{}},{default:r((()=>[c(R,{value:t.value.status,"onUpdate:value":l[1]||(l[1]=e=>t.value.status=e),placeholder:"请选择部门状态","allow-clear":"",class:"min-form-control"},{default:r((()=>[c(j,{value:"0"},{default:r((()=>l[2]||(l[2]=[m("正常")]))),_:1}),c(j,{value:"1"},{default:r((()=>l[3]||(l[3]=[m("停用")]))),_:1})])),_:1},8,["value"])])),_:1})])),_:1}),i("div",W,[c(d,{class:"m-0"},{default:r((()=>[i("div",X,[c(U,{type:"primary",ghost:"",class:"mini-btn",onClick:s},{icon:r((()=>[c(C,{class:"align-sub text-icon"})])),default:r((()=>[i("span",Y,f(e.$t("common.search")),1)])),_:1}),c(U,{class:"mini-btn",onClick:u},{icon:r((()=>[c(O,{class:"align-sub text-icon"})])),default:r((()=>[i("span",Z,f(e.$t("common.reset")),1)])),_:1})])])),_:1})])])),_:1})])])),_:1},8,["model"])])),_:1})}}}),le={__name:"add",props:{deptOptions:{type:Array,default:()=>[]},currentRow:{type:Object,default:()=>null},operateType:{type:String,default:()=>null}},emits:["success"],setup(e,{expose:l,emit:a}){const t=e,s=a,{formRef:u,validate:d,resetFields:i}=I(),{createRequiredRule:p,patternRules:f}=j(),x={parentId:p("请选择上级部门"),deptName:p("请输入部门名称"),orderNum:p("请输入显示顺序"),email:f.email,phone:f.phone},y={children:"children",label:"deptName",key:"deptId",value:"deptId"},b=R({parentId:null,deptName:null,orderNum:null,leader:null,phone:null,email:null,status:"0"});return C((()=>t.currentRow),(e=>{if(e){const{parentId:l,deptName:a,orderNum:s,leader:u,phone:d,email:o,status:n}=e;"edit"===t.operateType&&(b.value={parentId:"".concat(l),deptName:a,orderNum:s,leader:u,phone:d,email:o,status:n})}else b.value={parentId:null,deptName:null,orderNum:null,leader:null,phone:null,email:null,status:"0"};"addChild"===t.operateType&&(b.value.parentId="".concat(e.deptId))}),{deep:!0,immediate:!0}),l({submitForm:async function(){if(!t.operateType)return;let e;await d(),e="edit"===t.operateType?B({deptId:t.currentRow.deptId,...b.value}):D(b.value),e.then((({error:e})=>{var l;e||(null==(l=null==window?void 0:window.$message)||l.success("操作成功!"),s("success"))}))}}),(e,l)=>{const a=O,s=_,d=h,i=v,p=T,f=z,g=F,w=k,I=N;return o(),n(I,{ref_key:"formRef",ref:u,model:b.value,rules:x,"label-col":{lg:8,xs:4},"label-wrap":""},{default:r((()=>[c(w,{gutter:20},{default:r((()=>[0!=b.value.parentId?(o(),n(d,{key:0,lg:24,xs:24},{default:r((()=>[c(s,{name:"parentId",label:"上级部门","label-col":{}},{default:r((()=>[c(a,{value:b.value.parentId,"onUpdate:value":l[0]||(l[0]=e=>b.value.parentId=e),"show-search":"","dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"请选择上级部门","allow-clear":"","tree-default-expand-all":"","tree-data":t.deptOptions,"replace-fields":y},null,8,["value","tree-data"])])),_:1})])),_:1})):U("",!0),c(d,{lg:12,xs:24},{default:r((()=>[c(s,{name:"deptName",label:"部门名称","label-col":{}},{default:r((()=>[c(i,{value:b.value.deptName,"onUpdate:value":l[1]||(l[1]=e=>b.value.deptName=e),placeholder:"请输入部门名称",autocomplete:"off"},null,8,["value"])])),_:1})])),_:1}),c(d,{lg:12,xs:24},{default:r((()=>[c(s,{name:"orderNum",label:"显示顺序","label-col":{}},{default:r((()=>[c(p,{value:b.value.orderNum,"onUpdate:value":l[2]||(l[2]=e=>b.value.orderNum=e),placeholder:"请输入显示顺序",class:"w-full",autocomplete:"off"},null,8,["value"])])),_:1})])),_:1}),c(d,{lg:12,xs:24},{default:r((()=>[c(s,{name:"leader",label:"负责人","label-col":{}},{default:r((()=>[c(i,{value:b.value.leader,"onUpdate:value":l[3]||(l[3]=e=>b.value.leader=e),placeholder:"请输入负责人",autocomplete:"off"},null,8,["value"])])),_:1})])),_:1}),c(d,{lg:12,xs:24},{default:r((()=>[c(s,{name:"phone",label:"联系电话","label-col":{}},{default:r((()=>[c(i,{value:b.value.phone,"onUpdate:value":l[4]||(l[4]=e=>b.value.phone=e),placeholder:"请输入联系电话",autocomplete:"off"},null,8,["value"])])),_:1})])),_:1}),c(d,{lg:12,xs:24},{default:r((()=>[c(s,{name:"email",label:"邮箱地址","label-col":{}},{default:r((()=>[c(i,{value:b.value.email,"onUpdate:value":l[5]||(l[5]=e=>b.value.email=e),placeholder:"请输入邮箱地址",autocomplete:"off"},null,8,["value"])])),_:1})])),_:1}),c(d,{lg:12,xs:24},{default:r((()=>[c(s,{name:"status",label:"部门状态","label-col":{}},{default:r((()=>[c(g,{value:b.value.status,"onUpdate:value":l[6]||(l[6]=e=>b.value.status=e)},{default:r((()=>[c(f,{value:"0"},{default:r((()=>l[7]||(l[7]=[m("正常")]))),_:1}),c(f,{value:"1"},{default:r((()=>l[8]||(l[8]=[m("停用")]))),_:1})])),_:1},8,["value"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])}}},ae={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},te={class:"modal-footer"};const se=Object.assign({name:"manage_dept"},{__name:"index",setup(s){const u=R({deptName:null,status:null}),d=R([{key:"deptName",dataIndex:"deptName",title:"部门名称",width:260,align:"center",checked:!0,ellipsis:!0},{key:"orderNum",dataIndex:"orderNum",title:"排序",width:200,align:"center",checked:!0,ellipsis:!0},{key:"status",dataIndex:"status",title:"状态",width:200,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>{if(null===e.status)return null;const l=0==e.status?"正常":"异常";return c($,{color:{0:"success",1:"error"}[e.status]||"error"},"function"==typeof(a=l)||"[object Object]"===Object.prototype.toString.call(a)&&!M(a)?l:{default:()=>[l]});var a}},{key:"createTime",dataIndex:"createTime",title:"创建时间",width:200,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>null==e.createTime?null:S(e.createTime)},{key:"cz",dataIndex:"createTime",title:"操作",width:200,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>c("div",null,[c(g,{type:"link",size:"small",onClick:()=>b("edit",e)},{default:()=>[c(t,{class:"align-sub text-icon"},null),m("修改")]}),c(g,{type:"link",size:"small",onClick:()=>b("addChild",e)},{default:()=>[c(l,{class:"align-sub text-icon"},null),m("新增")]}),0!=e.parentId?q(c(g,{type:"link",size:"small",danger:!0,onClick:()=>{var l;l=e,window.$modal.confirm({title:'是否确认删除名称为"'.concat(l.deptName,'"的数据项？'),onOk:()=>{G(l.deptId).then((({data:e,error:l})=>{l||(window.$message.success("删除成功"),v())}))}})}},{default:()=>[c(a,{class:"align-sub text-icon"},null),m("删除")]}),[[H("if"),0!==e.parentId]]):""])}]),n=R([]),p=R(!1),f=R([]);function v(){p.value=!0,L(u.value).then((({data:e,error:l})=>{l||(n.value=P(e,"deptId"),f.value=A(n.value).map((e=>e.deptId)))})).finally((()=>{p.value=!1}))}v();const _=R(null),h=R("add"),x=R(!1),y=R(null);function b(e,l=null){_.value=l,h.value=e,x.value=!0}function w(){y.value.submitForm()}function k(){x.value=!1,_.value=null}function N(){v(),k()}return(a,t)=>{const s=l,I=g,j=e,R=J,C=E;return o(),K("div",ae,[c(ee,{model:u.value,"onUpdate:model":t[0]||(t[0]=e=>u.value=e),onReset:t[1]||(t[1]=e=>v()),onSearch:t[2]||(t[2]=e=>v())},null,8,["model"]),c(C,{bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"table-card flex-col-stretch sm:flex-1-hidden card-wrapper"},{title:r((()=>[c(I,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:t[3]||(t[3]=e=>b("add"))},{icon:r((()=>[c(s,{class:"align-sub text-icon"})])),default:r((()=>[t[7]||(t[7]=i("span",{class:"ml-3px"},"新增",-1))])),_:1})])),extra:r((()=>[c(j,{columns:d.value,"onUpdate:columns":t[4]||(t[4]=e=>d.value=e)},null,8,["columns"])])),default:r((()=>[c(R,{columns:d.value,"data-source":n.value,size:"small",loading:p.value,"default-expanded-row-keys":f.value,"row-key":"deptId","default-expand-all-rows":!0,scroll:{x:"auto",y:"auto"},pagination:!1,class:"h-full"},null,8,["columns","data-source","loading","default-expanded-row-keys"])])),_:1}),c(Q,{visible:x.value,"onUpdate:visible":t[6]||(t[6]=e=>x.value=e),title:"".concat("add"==h.value?"新增":"修改","部门"),height:"500px",width:"650px","destroy-on-close":!0,onOk:w,onClose:k},{footer:r((()=>[i("div",te,[c(I,{type:"primary",onClick:t[5]||(t[5]=e=>w())},{default:r((()=>t[8]||(t[8]=[m("确定")]))),_:1}),c(I,{onClick:k},{default:r((()=>t[9]||(t[9]=[m("取消")]))),_:1})])])),default:r((()=>[c(le,{ref_key:"addFormRef",ref:y,"dept-options":n.value,"current-row":_.value,"operate-type":h.value,onSuccess:N},null,8,["dept-options","current-row","operate-type"])])),_:1},8,["visible","title"])])}}});export{se as default};
