import{_ as e}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import{_ as l}from"./round-download-DUbhM0Ds.js";import{Z as a,ag as t,aa as n,d as s,r as i,p as o,o as u,e as d,g as r,w as c,f as m,s as p,I as f,v,N as g,O as h,B as x,P as b,Q as k,F as w,K as _,L as y,c as I,t as Y,a5 as q,M as N,a7 as S,S as M}from"./index-B3PZsRwT.js";import{_ as T}from"./modal.vue_vue_type_style_index_0_lang-Gjmj9w7c.js";import{g as z}from"./equipment-alarm-info-RrvTGqWc.js";import{C as D}from"./index-BThgVJ70.js";import{_ as C}from"./index-Cn-BWYp5.js";import"./fromPairs-BI-MgVCs.js";const j={class:"jl-main-page h-full flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},H={class:"w-full flex"},K={class:"flex"},U={class:"w-full flex-y-center justify-end gap-12px"},O=s({__name:"code-list",setup(l,{expose:a}){const t=i(null),n=i([{key:"index",dataIndex:"index",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"equipmentId",dataIndex:"equipmentId",title:"设备代码",align:"center",checked:!0,ellipsis:!0},{key:"description",dataIndex:"description",title:"设备描述",align:"center",checked:!0,ellipsis:!0}]);i([]);const s=i(null),_=i({type:"radio",onChange:e=>{s.value=e[0]}}),y=i([]),I=i(!1),Y=o({current:1,pageSize:200,showSizeChanger:!0,pageSizeOptions:["50","100","200","300","500"],showQuickJumper:!0,showTotal:(e,l)=>"共".concat(e,"条"),total:0,onChange:async(e,l)=>{Y.current=e,Y.pageSize=l,S()}});function q(){Y.current=1,S()}function N(){t.value=null,Y.current=1,S()}function S(){const e={equipmentId:t.value,pageSize:Y.pageSize,pageNum:Y.current};I.value=!0,z(e).then((({data:e,error:l})=>{l||(e.list.forEach(((e,l)=>{e.index=l+1})),Y.total=e.total,y.value=e.list)})).finally((()=>I.value=!1))}return S(),a({currentSelect:s}),(l,a)=>{const s=f,i=v,o=g,S=h,M=x,T=b,z=k,O=w,E=D,P=e,Q=C;return u(),d("div",j,[r(E,{title:null,bordered:!1,class:"search-card card-wrapper"},{default:c((()=>[r(O,{"label-col":{span:5,md:7},class:"search-form"},{default:c((()=>[m("div",H,[r(z,{gutter:[15,8],wrap:"",class:"w-full"},{default:c((()=>[r(o,{span:24,md:12,lg:8,xl:8,xxl:8},{default:c((()=>[r(i,{label:"设备代码",name:"equipmentId",class:"m-0","label-col":{}},{default:c((()=>[r(s,{value:t.value,"onUpdate:value":a[0]||(a[0]=e=>t.value=e),placeholder:"请输入设备代码",class:"min-form-control","allow-clear":"",autocomplete:"off",onKeypress:p(q,["enter"])},null,8,["value"])])),_:1})])),_:1}),m("div",K,[r(i,{class:"m-0"},{default:c((()=>[m("div",U,[r(M,{type:"primary",ghost:"",class:"mini-btn",onClick:q},{icon:c((()=>[r(S,{class:"align-sub text-icon"})])),default:c((()=>[a[2]||(a[2]=m("span",{class:"ml-3px"},"搜索",-1))])),_:1}),r(M,{class:"mini-btn",onClick:N},{icon:c((()=>[r(T,{class:"align-sub text-icon"})])),default:c((()=>[a[3]||(a[3]=m("span",{class:"ml-3px"},"重置",-1))])),_:1})])])),_:1})])])),_:1})])])),_:1})])),_:1}),r(E,{bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"table-card h-full flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:c((()=>[r(P,{columns:n.value,"onUpdate:columns":a[1]||(a[1]=e=>n.value=e)},null,8,["columns"])])),default:c((()=>[r(Q,{columns:n.value,"data-source":y.value,bordered:"","row-selection":_.value,size:"small",loading:I.value,"row-key":"equipmentId",pagination:Y,scroll:{x:"auto",y:"auto"},class:"h-full"},null,8,["columns","data-source","row-selection","loading","pagination"])])),_:1})])}}}),E={class:"w-full flex"},P={class:"flex"},Q={class:"w-full flex-y-center justify-end gap-12px"},R={class:"ml-3px"},A={class:"ml-3px"},B=s({__name:"search",props:{model:{required:!0},modelModifiers:{}},emits:_(["search"],["update:model"]),setup(e,{emit:l}){const a=l,t=y(e,"model");function n(){a("search",t.value)}function s(){t.value={equipmentId:null,prodNo:null,diameter:null,time:null},a("search",t.value)}const o=i(null),d=i(!1);function _(){q((()=>{t.value.equipmentId=o.value.currentSelect,d.value=!1,a("search",t.value)}))}return(e,l)=>{const a=f,i=v,y=g,q=N,S=h,M=x,z=b,C=k,j=w,H=D;return u(),I(H,{title:null,bordered:!1,class:"search-card card-wrapper"},{default:c((()=>[r(j,{ref:"formRef",model:t.value,"label-col":{span:5,md:7},class:"search-form"},{default:c((()=>[m("div",E,[r(C,{gutter:[15,8],wrap:"",class:"w-full"},{default:c((()=>[r(y,{span:24,md:12,lg:5,xl:5,xxl:5},{default:c((()=>[r(i,{label:"设备代码",name:"equipmentId",class:"m-0","label-col":{}},{default:c((()=>[r(a,{value:t.value.equipmentId,"onUpdate:value":l[0]||(l[0]=e=>t.value.equipmentId=e),placeholder:"请输入设备代码",class:"min-form-control","allow-clear":"",autocomplete:"off",onKeypress:p(n,["enter"])},null,8,["value"])])),_:1})])),_:1}),r(y,{span:24,md:12,lg:5,xl:5,xxl:5},{default:c((()=>[r(i,{label:"断刀直径",name:"diameter",class:"m-0","label-col":{}},{default:c((()=>[r(a,{value:t.value.diameter,"onUpdate:value":l[1]||(l[1]=e=>t.value.diameter=e),placeholder:"请输入断刀直径",class:"min-form-control","allow-clear":"",autocomplete:"off",onKeypress:p(n,["enter"])},null,8,["value"])])),_:1})])),_:1}),r(y,{span:24,md:12,lg:5,xl:5,xxl:5},{default:c((()=>[r(i,{label:"生产型号",name:"prodNo",class:"m-0","label-col":{}},{default:c((()=>[r(a,{value:t.value.prodNo,"onUpdate:value":l[2]||(l[2]=e=>t.value.prodNo=e),placeholder:"请输入生产型号",class:"min-form-control","allow-clear":"",autocomplete:"off",onKeypress:p(n,["enter"])},null,8,["value"])])),_:1})])),_:1}),r(y,{span:24,md:12,lg:7,xl:7,xxl:7},{default:c((()=>[r(i,{label:"日期",name:"model",class:"m-0","label-col":{}},{default:c((()=>[r(q,{value:t.value.time,"onUpdate:value":l[3]||(l[3]=e=>t.value.time=e),"show-time":"",class:"min-form-control","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])])),_:1})])),_:1}),m("div",P,[r(i,{class:"m-0"},{default:c((()=>[m("div",Q,[r(M,{type:"primary",ghost:"",class:"mini-btn",onClick:n},{icon:c((()=>[r(S,{class:"align-sub text-icon"})])),default:c((()=>[m("span",R,Y(e.$t("common.search")),1)])),_:1}),r(M,{class:"mini-btn",onClick:s},{icon:c((()=>[r(z,{class:"align-sub text-icon"})])),default:c((()=>[m("span",A,Y(e.$t("common.reset")),1)])),_:1})])])),_:1})])])),_:1})])])),_:1},8,["model"]),r(T,{visible:d.value,"onUpdate:visible":l[4]||(l[4]=e=>d.value=e),title:"代码列表",height:"70vh",width:"800px",onOk:_},{default:c((()=>[r(O,{ref_key:"codeListRef",ref:o},null,512)])),_:1},8,["visible"])])),_:1})}}}),F={class:"jl-main-page one-code-ascend min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},J=s({name:"collection-management_broken-knife-list",__name:"index",setup(s){const p=i({pageNum:1,pageSize:200}),f=i({equipmentId:null,prodNo:null,diameter:null,time:[n(new Date).subtract(1,"day").startOf("day"),n().startOf("day")]}),v=o({current:p.value.pageNum,pageSize:p.value.pageSize,showSizeChanger:!0,pageSizeOptions:["50","100","200","300","500"],showQuickJumper:!0,showTotal:(e,l)=>"共".concat(e,"条"),total:0,onChange:async(e,l)=>{v.current=e,v.pageSize=l,p.value.pageNum=e,p.value.pageSize=l,_()}}),g=i(null),h=e=>({style:{background:e.uid===g.value?"#BAEAFA":""},class:e.uid===g.value?"jl-table-row-selected":"",onClick:()=>{g.value=e.uid}}),b=i([]),k=i([{key:"index",dataIndex:"index",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"fullProdNo",dataIndex:"fullProdNo",title:"生产型号",width:160,align:"center",checked:!0,ellipsis:!0},{key:"subEqpId",dataIndex:"subEqpId",title:"设备ID",width:140,align:"center",checked:!0,ellipsis:!0},{key:"subEqpName",dataIndex:"subEqpName",title:"设备名称",width:160,align:"center",checked:!0,ellipsis:!0},{key:"alarmId",dataIndex:"alarmId",title:"代码",width:100,align:"center",checked:!0,ellipsis:!0},{key:"alarmText",dataIndex:"alarmText",title:"警报内容",width:160,align:"center",checked:!0,ellipsis:!0},{key:"dateTime",dataIndex:"dateTime",title:"警报时间",width:180,align:"center",checked:!0,ellipsis:!0},{key:"brokeKnifeCount",dataIndex:"brokeKnifeCount",title:"断刀次数",width:100,align:"center",checked:!0,ellipsis:!0},{key:"diameter",dataIndex:"diameter",title:"断刀直径",width:100,align:"center",checked:!0,ellipsis:!0},{key:"brokeKnifeMsg",dataIndex:"brokeKnifeMsg",title:"断刀信息",width:200,align:"center",checked:!0,ellipsis:!0},{key:"pgmPath",dataIndex:"pgmPath",title:"钻孔程式路径",align:"center",checked:!0,ellipsis:!0}]),w=i(!1);function _(){var e;const{equipmentId:l,diameter:t,prodNo:s}=f.value,i={equipmentId:l,diameter:t,prodNo:s,...p.value};(null==(e=f.value.time)?void 0:e[0])?(i.beginTime=n(f.value.time[0]).format("YYYY-MM-DD HH:mm:ss"),i.endTime=n(f.value.time[1]).format("YYYY-MM-DD HH:mm:ss")):(i.beginTime="",i.endTime=""),w.value=!0,function(e){return a({url:"/mes/broken-knife/list",params:e})}(i).then((({data:e,error:l})=>{l||(e.list.forEach(((e,l)=>{e.index=l+1,e.uid=S.genV4().hexNoDelim})),v.total=e.total,b.value=e.list)})).finally((()=>w.value=!1))}function y(){v.current=1,p.value.pageNum=1,_()}function I(){v.current=1,p.value.pageNum=1,_()}function Y(){var e;const{equipmentId:l,diameter:a}=f.value,s={equipmentId:l,diameter:a};(null==(e=f.value.time)?void 0:e[0])?(s.beginTime=n(f.value.time[0]).format("YYYY-MM-DD HH:mm:ss"),s.endTime=n(f.value.time[1]).format("YYYY-MM-DD HH:mm:ss")):(s.beginTime="",s.endTime=""),function(e){t({url:"/mes/broken-knife/export",method:"POST",data:e,fileName:"钻孔断刀记录".concat(n().format("YYYY-MM-DD HH:mm:ss"),"导出.xlsx")})}(s)}return _(),(a,t)=>{const n=l,s=x,i=e,o=M("STable"),p=D;return u(),d("div",F,[r(B,{model:f.value,"onUpdate:model":t[0]||(t[0]=e=>f.value=e),onReset:y,onSearch:I},null,8,["model"]),r(p,{bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"table-card flex-col-stretch sm:flex-1-hidden card-wrapper"},{title:c((()=>[r(s,{type:"primary",ghost:"",class:"mini-btn",onClick:Y},{icon:c((()=>[r(n,{class:"align-sub text-icon"})])),default:c((()=>[t[2]||(t[2]=m("span",{class:"ml-3px"},"下载",-1))])),_:1})])),extra:c((()=>[r(i,{columns:k.value,"onUpdate:columns":t[1]||(t[1]=e=>k.value=e)},null,8,["columns"])])),default:c((()=>[r(o,{columns:k.value,"data-source":b.value,bordered:"",size:"small",loading:w.value,"row-key":"uid",pagination:v,"custom-row":h,class:"h-full","row-height":23},null,8,["columns","data-source","loading","pagination"])])),_:1})])}}});export{J as default};
