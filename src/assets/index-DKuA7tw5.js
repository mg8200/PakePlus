import{_ as e}from"./table-DoFSI9NT.js";import{_ as a}from"./round-add-MytOGm9O.js";import{_ as l}from"./common-search.vue_vue_type_script_setup_true_lang-BX9APgbN.js";import{_ as t}from"./round-edit-DZi1TDWc.js";import{r as n,o as s,c as i,W as r,a0 as o,g as d,a3 as c,a2 as u,h as p,e as m,f as h,w as g,a1 as y,t as v,a6 as f,i as k,I as b,B as w,a7 as x,J as F}from"./index-B3PZsRwT.js";import{u as _,a as I,b as j,g as O,c as C}from"./form-setup-CpeSHwGr.js";import{E as N}from"./index-DJLjdcIi.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import"./api-By23aosn.js";import"./index-BThgVJ70.js";import"./use-form-common-props-DQAdjfyv.js";import"./fromPairs-BI-MgVCs.js";const P={__name:"add",props:{rowData:{type:Object,default:()=>null}},setup(e,{expose:a}){const l=e,t=n(0),o=n(null),d=n([{type:"tabs",name:"基本信息",span:24},{type:"input",key:"itemProcess",label:"点检流程",placeholder:"请输入点检流程",span:24},{type:"input",key:"itemName",label:"点检项目",placeholder:"请输入点检项目",span:24,rule:{required:!0,message:"请输入点检项目",trigger:"change"}},{type:"input",key:"itemStardard",label:"标准",placeholder:"请输入标准",span:24,rule:{required:!0,message:"请输入标准",trigger:"change"}},{type:"input",key:"itemFrequence",label:"频率",placeholder:"请输入频率",span:24,rule:{required:!0,message:"请输入频率",trigger:"change"}},{type:"input",key:"showNo",label:"顺序编号",placeholder:"请输入顺序编号",span:24,rule:{required:!0,message:"请输入顺序编号",trigger:"change"}},{type:"select",key:"needFill",label:"是否检验",placeholder:"请选择是否检验",span:24,rule:{required:!0,message:"请选择是否检验",trigger:"change"},selectOptions:[{label:"是",value:"1"},{label:"否",value:"0"}],change(e){"1"===e?t.value=24:(c.value.checkRange=null,t.value=0)}},{type:"input",key:"checkRange",label:"检查范围",placeholder:"请输入检查范围",span:t,rule:{required:!0,message:"请输入检查范围",trigger:"change"}},{type:"radio",key:"delFlag",label:"状态",span:24,value:"0",selectOptions:[{label:"启用",value:"0"},{label:"禁用",value:"1"}]}]),c=n({...function(){const e={};d.value.forEach((a=>{var t;a.key&&(e[a.key]=(null==(t=l.rowData)?void 0:t[a.key])||a.value||null)})),l.rowData&&("1"===l.rowData.needFill?t.value=24:t.value=0);return e}()});return a({model:c.value,validateForm:async function(){await o.value.validateForm()}}),(e,a)=>{const l=r;return s(),i(l,{ref_key:"formRef",ref:o,model:c.value,"onUpdate:model":a[0]||(a[0]=e=>c.value=e),"form-list":d.value},null,8,["model","form-list"])}}},q={class:"form-setup-page min-h-500px flex gap-16px overflow-hidden p-8px pl-15px lt-sm:overflow-auto"},D={class:"left-tree h-full"},B={class:"head-container"},R={class:"head-tree"},$=["title"],S={class:"left align-center flex"},A={key:0,class:"right mr-15px"},z={class:"right-table ml-8px h-full flex-col-stretch gap-16px overflow-hidden"},L=F(Object.assign({name:"check-inventory-manage_form-setup"},{__name:"index",setup(r){const F=n(null),L=n([]),M=n(null),U={children:"children",label:"label"},E=n({delFlag:null});function Q(e,a){return!e||a.label.includes(e)}o((()=>M.value),(e=>{F.value.filter(e)}));const G=n(null);function H(e){"process"!==e.type?(G.value=e.id,E.value.delFlag=null,le()):window.$message.warning("请选择表单")}async function J(){const{data:e,error:a}=await O();a||(L.value=function(e){const a=e.reduce(((e,a)=>{const l=a.inspectionProcessName;return e[l]||(e[l]=[]),e[l].push(a),e}),{});return Object.entries(a).map((([e,a])=>({label:e,id:x.genV4().hexNoDelim,type:"process",children:null==a?void 0:a.map((e=>({...e,label:e.inspectionFormName,type:"form"})))})))}(e))}J();const K=n({}),{handleClose:V,handleShow:W,handleLoading:T}=window.$useModal({modalOption:{title:"编辑表单",width:"800px",destroyOnClose:!0},formData:K.value,formList:[{type:"tabs",name:"基本信息",span:24},{type:"input",key:"inspectionFormName",label:"表单名称",placeholder:"请输入表单名称",disabled:!0,span:24},{type:"input",key:"inspectionFormCode",label:"表单编号",placeholder:"请输入表单编号",span:24,rule:{required:!0,message:"请输入表单编号",trigger:"change"}},{type:"radio",key:"delFlag",label:"状态",span:24,value:"0",selectOptions:[{label:"启用",value:"0"},{label:"禁用",value:"1"}]},{type:"radio",key:"hasIpqc",label:"是否有IPQC审核",span:24,value:"0",selectOptions:[{label:"是",value:"0"},{label:"否",value:"1"}]},{type:"radio",key:"hasFqa",label:"是否有FQA审核",span:24,value:"1",selectOptions:[{label:"是",value:"0"},{label:"否",value:"1"}]},{type:"tabs",name:"状态信息",span:24},{type:"input",key:"createBy",label:"创建人",disabled:!0,span:12},{type:"input",key:"createDate",label:"创建时间",disabled:!0,span:12},{type:"input",key:"updateBy",label:"修改人",disabled:!0,span:12},{type:"input",key:"updateDate",label:"修改时间",disabled:!0,span:12}],onOk:async e=>{T(!0);try{const{error:a}=await _(e);a||(window.$message.success("修改成功"),V(),J())}finally{T(!1)}}});const X=[{type:"select",key:"delFlag",label:"状态",placeholder:"请选择状态",span:24,md:12,lg:8,xl:8,xxl:6,selectOptions:[{label:"启用",value:"0"},{label:"禁用",value:"1"}]}],Y=n([{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,fixed:"left",align:"center",checked:!0,ellipsis:!0},{key:"itemProcess",dataIndex:"itemProcess",title:"点检流程",width:150,align:"center",checked:!0,ellipsis:!0},{key:"itemName",dataIndex:"itemName",title:"点检项目",width:150,align:"center",checked:!0,ellipsis:!0},{key:"itemStardard",dataIndex:"itemStardard",title:"标准",width:150,align:"center",checked:!0,ellipsis:!0},{key:"itemFrequence",dataIndex:"itemFrequence",title:"频率",width:150,align:"center",checked:!0,ellipsis:!0},{key:"showNo",dataIndex:"showNo",title:"顺序编号",width:100,align:"center",checked:!0,ellipsis:!0},{key:"delFlag",dataIndex:"delFlag",title:"状态",width:100,align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>d("span",{class:"0"===e.delFlag?"color-green":"color-red"},[["启用","禁用"][e.delFlag]])},{key:"createBy",dataIndex:"createBy",title:"创建人",width:100,align:"center",checked:!0,ellipsis:!0},{key:"createDate",dataIndex:"createDate",title:"创建时间",width:180,align:"center",checked:!0,ellipsis:!0},{key:"updateDate",dataIndex:"updateDate",title:"修改时间",width:180,align:"center",checked:!0,ellipsis:!0},{key:"updateBy",dataIndex:"updateBy",title:"修改人",width:100,align:"center",checked:!0,ellipsis:!0},{key:"cz-Col",dataIndex:"cz-Col",title:"操作",width:130,align:"center",fixed:"right",checked:!0,ellipsis:!0,customRender:({record:e})=>d("div",null,[c(d("a",{class:"mr-10px color-blue",onClick:()=>{ce("edit",e)}},[p("修改")]),[[u("hasAuth"),["check-inventory-manage:form-setup:edit-check-item"]]]),c(d("a",{class:"0"===e.delFlag?"color-red":"color-green",onClick:()=>{var a;a=e,window.$modal.confirm({title:"是否".concat("0"===a.delFlag?"禁用":"启用","名称为“").concat(a.itemName,"”的点检项？"),onOk:async()=>{const e={...a};e.delFlag="0"===a.delFlag?"1":"0",I(e).then((({data:e,error:a})=>{a||(window.$message.success("操作成功"),le())}))}})}},[["禁用","启用"][e.delFlag]]),[[u("hasAuth"),["check-inventory-manage:form-setup:change-check-item-status"]]])])}]),Z=n([]),ee=n(null),ae=n(!1);async function le(){ae.value=!0;try{const{data:e,error:a}=await C({inspectionFormId:G.value,...E.value});a||(e.forEach(((e,a)=>{e.dataIndex=a+1})),Z.value=e)}finally{ae.value=!1}}const te=n(null),ne=n("add"),se=n(null),{handleShow:ie,handleLoading:re,updateModalOptions:oe,handleClose:de}=window.$useModal({modalOption:{title:"新增检查项",height:"700px",destroyOnClose:!0},component:()=>d(P,{ref:te,"row-data":se.value},null),onOk:async()=>{const e={...te.value};await e.validateForm();try{const a={...e.model};let l;a.showNo=Number(a.showNo),a.inspectionFormId=G.value,l="add"===ne.value?await j(a):await I({...se.value,...a});const{error:t}=await l;t||(window.$message.success("操作成功"),de(),le())}finally{re(!1)}}});function ce(e,a){ne.value=e,oe("edit"===e?{title:"修改检查项"}:{title:"新增检查项"}),se.value=a,ie()}function ue(){le()}function pe(){E.value={delFlag:null},ue()}return(n,r)=>{const o=b,p=t,x=l,_=a,I=w,j=e,O=u("hasAuth");return s(),m("div",q,[h("div",D,[r[4]||(r[4]=h("div",{class:"title"},[h("span",{class:"text"},"点检表")],-1)),h("div",B,[d(o,{value:M.value,"onUpdate:value":r[0]||(r[0]=e=>M.value=e),placeholder:"请输入点检表名称"},null,8,["value"])]),h("div",R,[d(k(N),{ref_key:"treeRef",ref:F,data:L.value,props:U,"expand-on-click-node":!1,"filter-node-method":Q,"node-key":"id","default-expand-all":"","highlight-current":"","empty-text":"暂无点检表",onNodeClick:H},{default:g((({data:e})=>[h("div",{class:"tree-node align-center w-full flex justify-between",title:e.label},[h("div",S,[h("span",{class:y(["iconfont mr-5px","process"===e.type?"icon-gongxu gongxu-icon":"icon-jilubiao color-blue"])},null,2),h("span",{class:y(["tree-label","1"==e.delFlag?"color-red":""])},v(e.label),3)]),"form"===e.type?c((s(),m("div",A,[d(p,{class:"align-sub text-size-16px color-blue",onClick:a=>function(e,a){K.value=a,e.stopPropagation(),W(window.$utils.deepClone(a))}(a,e)},null,8,["onClick"])])),[[O,["check-inventory-manage:form-setup:tree-edit"]]]):f("",!0)],8,$)])),_:1},8,["data"])])]),h("div",z,[d(x,{searchParams:E.value,"onUpdate:searchParams":r[1]||(r[1]=e=>E.value=e),"form-list":X,onReset:pe,onSearch:ue},null,8,["searchParams"]),d(j,{ref_key:"tableRef",ref:ee,searchParams:E.value,"onUpdate:searchParams":r[3]||(r[3]=e=>E.value=e),column:Y.value,"data-source":Z.value,"show-row-selection":!1,scroll:{y:"auto"},"is-init-get-data":"",loading:ae.value},{title:g((()=>[G.value?c((s(),i(I,{key:0,type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:r[2]||(r[2]=e=>ce("add"))},{icon:g((()=>[d(_,{class:"align-sub text-icon"})])),default:g((()=>[r[5]||(r[5]=h("span",{class:"ml-3px"},"新增检查项",-1))])),_:1})),[[O,["check-inventory-manage:form-setup:add-check-item"]]]):f("",!0)])),_:1},8,["searchParams","column","data-source","loading"])])])}}}),[["__scopeId","data-v-c9e79368"]]);export{L as default};
