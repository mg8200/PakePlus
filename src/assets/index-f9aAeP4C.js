import{_ as e}from"./table-DoFSI9NT.js";import{_ as l}from"./common-search.vue_vue_type_script_setup_true_lang-BX9APgbN.js";import{r as a,a9 as t,g as n,h as o,a$ as s,a5 as d,o as c,e as i,W as r,da as u,S as p,f as h,i as m,V as y,w as f,X as w,t as k,B as b,a7 as v,J as g}from"./index-B3PZsRwT.js";import{a as x,b as N}from"./interior-ecn-is1Hg8_6.js";import{u as I}from"./resetTableRef-DZjcvemm.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import"./api-By23aosn.js";import"./index-BThgVJ70.js";const P={class:"h-full w-full"},_={__name:"add",props:{rowData:{type:Object,default:()=>({})}},setup(e,{expose:l}){const u=e,p=a(0),h=a(null);t(h);const m=a({moduleNo:null,fullProdNo:null,newCustProdNo:null,custProdNo:null,newSameModuleNo:null,surfTrea1:null,newSurfTrea1:null,custProdName:null,effectiveTiming:null,pnType:!1,customerCheck:!1,changeReason:[],otherReason:null,oldDataDeal:null,inventoryDealMethod:null,nowboardDealMethod:null}),y=[{type:"input",key:"moduleNo",label:"生产型号",placeholder:"请输入生产型号",span:12,readonly:!0},{type:"input",key:"fullProdNo",label:"新生产型号",placeholder:"请输入生产型号",span:12,disabled:!0},{type:"input",key:"custProdNo",label:"客户型号",disabled:!0,placeholder:"",span:12},{type:"input",key:"newCustProdNo",label:"新客户型号",disabled:!0,placeholder:"",span:12},{type:"input",key:"sameModuleNo",label:"同等型号",disabled:!0,placeholder:"",span:12},{type:"input",key:"newSameModuleNo",label:"新同等型号",placeholder:"",span:12},{type:"input",key:"surfTrea1",label:"旧型号特性",disabled:!0,placeholder:"",span:12},{type:"dictionary",dictCode:"model_characteristics",useGrid:!0,selectType:"select",key:"newSurfTrea1",label:"新同等型号特性",placeholder:"请选择新同等型号特性",span:12,showSearch:!0},{type:"input",key:"custProdName",label:"客户名称",disabled:!0,placeholder:"",span:12},{type:"select",key:"effectiveTiming",label:"生效时间",placeholder:"请选择生效时间",selectOptions:[{label:"立即生效",value:"立即生效"},{label:"下批订单",value:"下批订单"},{label:"其他",value:"其他"}],rule:{required:!0,message:"请选择生效时间",trigger:"blur"},span:12},{type:"customRender",span:12,customRender:n("div",null,[n("span",{class:"text-16px color-red font-800"},[o("样品转量产：")]),n(s,{value:m.value.pnType,"onUpdate:value":e=>m.value.pnType=e,onChange:e=>{m.value.pnType=e.target.checked}},null)])},{type:"customRender",span:12,customRender:n("div",null,[n("span",null,[o("客户确认：")]),n(s,{value:m.value.customerCheck,"onUpdate:value":e=>m.value.customerCheck=e,onChange:e=>{m.value.customerCheck=e.target.checked}},null)])},{type:"dictionary",key:"changeReason",label:"变更原因",dictCode:"ecn_change_reason",useGrid:!0,selectType:"checkbox",placeholder:"请选择变更原因",span:24,change:e=>{e.includes("其他")?p.value=24:(m.value.otherReason=null,p.value=0)}},{type:"textarea",key:"otherReason",label:"其他原因",span:p,placeholder:""},{type:"select",key:"oldDataDeal",label:"旧资料处理",placeholder:"请选择旧资料处理",selectOptions:[{label:"报废",value:"报废"},{label:"共存",value:"共存"}],span:12},{type:"select",key:"inventoryDealMethod",label:"库存板处理方法",placeholder:"请选择库存板处理方法",selectOptions:[{label:"可出货",value:"可出货"},{label:"无库存",value:"无库存"},{label:"报废",value:"报废"},{label:"下旧版本订单吸收",value:"下旧版本订单吸收"},{label:"分开包装用新订单出货",value:"分开包装用新订单出货"},{label:"待客户确认",value:"待客户确认"}],span:12},{type:"select",key:"nowboardDealMethod",label:"在线板处理方法",placeholder:"",selectOptions:[{label:"暂停待通知",value:"暂停待通知"},{label:"报废处理",value:"报废处理"},{label:"返工",value:"返工"},{label:"特采出货",value:"特采出货"},{label:"无在线板",value:"无在线板"},{label:"在线板正常生产",value:"在线板正常生产"},{label:"在线板按新资料",value:"在线板按新资料"}],placeholder:"请选择在线板处理方法",rule:{required:!0,message:"请选择在线板处理方法",trigger:"blur"},span:12}];return a(null),a({}),a(null),d((()=>{!function(){const e=u.rowData;let l;m.value.moduleNo=e.moduleNo;const a=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];let t=null;m.value.moduleNo.includes("-")?(t=m.value.moduleNo.split("-")[1],l=m.value.moduleNo.split("-")[0].split("")):l=m.value.moduleNo.split("");const n=a.indexOf(l[l.length-2]);l[l.length-2]=a[n+1],l[l.length-1]=0,m.value.fullProdNo="".concat(l.join("")).concat(t?"-".concat(t):""),m.value.custProdNo=e.custProdNo,m.value.newCustProdNo=e.custProdNo,m.value.sameModuleNo=e.sameModuleNo,m.value.newSameModuleNo=e.sameModuleNo,m.value.surfTrea1=e.surfTrea1,m.value.newSurfTrea1=e.surfTrea1,m.value.custProdName=e.custAB}()})),l({model:m.value,validateForm:async function(){await h.value.validateForm()}}),(e,l)=>{const a=r;return c(),i("div",P,[n(a,{ref_key:"formRef",ref:h,model:m.value,"onUpdate:model":l[0]||(l[0]=e=>m.value=e),"form-list":y},null,8,["model"])])}}},T={class:"h-full w-full"},C={class:"h-full w-full flex gap-8px"},R={class:"h-full min-h-560px w-500px flex-col-stretch gap-8px overflow-hidden lt-sm:overflow-auto"},S={class:"right-content h-full flex-col-stretch gap-8px overflow-hidden lt-sm:overflow-auto"},M={class:"mb-0.5% h-50% flex-col-stretch gap-8px overflow-hidden lt-sm:overflow-auto"},D={class:"h-49.5%"},Q=g(Object.assign({name:"engineering-manage_outside-ecn"},{__name:"index",setup(t){const s=window.$useModal,r=a(null),[g,P]=I({moduleNo:null}),Q=[{type:"input",key:"moduleNo",label:"生产型号",span:16,placeholder:"请输入生产型号",showTime:!0}],j=a(null),O=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:50,align:"center",checked:!0,ellipsis:!0},{key:"moduleNo",dataIndex:"moduleNo",title:"生产型号",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>n("span",{class:"fonw-800 color-#646cff"},[e.moduleNo])},{key:"custProdNo",dataIndex:"custProdNo",title:"客户型号",align:"center",checked:!0,ellipsis:!0,width:130},{key:"pnType",dataIndex:"pnType",title:"类型",align:"center",checked:!0,ellipsis:!0,width:80},{key:"custAB",dataIndex:"custAB",title:"客户名称",align:"center",checked:!0,ellipsis:!0,width:100}],U=a(null),B=a([]),q=a(!1);function A(){j.value.getData()}function E(){P(),A()}const F=a(null),L=a({moduleNo:null});function W(e){U.value=e,L.value.moduleNo=e.moduleNo,d((()=>{F.value.getData(),N({prodId:U.value.prodId}).then((({data:e,error:l})=>{l?B.value=[]:(e.pubtechnology.forEach(((e,l)=>{e.dataIndex=l+1,e.tableUuid=v.genV4().hexNoDelim})),B.value=e.pubtechnology)})).finally((()=>{q.value=!1}))}))}function $(e){e.length&&(j.value.setCurrentRowId(e[0]),W(e[0]))}const G=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"oldModuleNo",dataIndex:"oldModuleNo",title:"生产型号",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>n("span",{class:"fonw-800 color-red"},[e.oldModuleNo])},{key:"newModuleNo",dataIndex:"newModuleNo",title:"新生产型号",align:"center",checked:!0,ellipsis:!0,width:160,customRender:({record:e})=>n("span",{class:"fonw-800 color-#646cff"},[e.newModuleNo])},{key:"newCustProdNo",dataIndex:"newCustProdNo",title:"新客户型号",align:"center",checked:!0,ellipsis:!0,width:160},{key:"newSameModuleNo",dataIndex:"newSameModuleNo",title:"新同等型号",align:"center",checked:!0,ellipsis:!0,width:160},{key:"newSurfTrea1",dataIndex:"newSurfTrea1",title:"新型号特性",align:"center",checked:!0,ellipsis:!0,width:140},{key:"effectiveTiming",dataIndex:"effectiveTiming",title:"生效时间",align:"center",checked:!0,ellipsis:!0,width:140},{key:"customerCheck",dataIndex:"customerCheck",title:"客户确认",align:"center",checked:!0,ellipsis:!0,customRender:({record:e})=>"1"===e.customerCheck?"已确认":"",width:120},{key:"oldDataDeal",dataIndex:"oldDataDeal",title:"旧资料处理方法",align:"center",checked:!0,ellipsis:!0,width:160},{key:"nowboardDealMethod",dataIndex:"nowboardDealMethod",title:"在线板处理方法",align:"center",checked:!0,ellipsis:!0,width:160},{key:"inventoryDealMethod",dataIndex:"inventoryDealMethod",title:"库存板处理方法",align:"center",checked:!0,ellipsis:!0,width:160},{key:"changeReason",dataIndex:"changeReason",title:"变更原因",align:"center",checked:!0,ellipsis:!0,width:160},{key:"otherReason",dataIndex:"otherReason",title:"其他原因",align:"center",checked:!0,ellipsis:!0,width:160},{key:"createBy",dataIndex:"createBy",title:"创建人",align:"center",checked:!0,ellipsis:!0,width:140},{key:"createDate",dataIndex:"createDate",title:"创建时间",align:"center",checked:!0,ellipsis:!0,width:160}],V=a(null),{handleClose:J,handleLoading:X,handleShow:z}=s({modalOption:{title:"新增",destroyOnClose:!0,width:"800px",height:"600px",centered:!0},component:()=>n(_,{ref:V,"row-data":U.value},null),onOk:async()=>{var e;const l={...V.value},a=u(l.model);a.changeReason=(null==(e=null==a?void 0:a.changeReason)?void 0:e.join(","))||null,a.customerCheck=a.customerCheck?"1":"0",a.pnType=a.pnType?"量产":null,await l.validateForm(),X(!0),x({...a}).then((({error:e})=>{e||(window.$message.success("操作成功"),J(),A())})).finally((()=>{X(!1)}))}});const H=a(null),K=a({}),Y=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"techName",dataIndex:"techName",title:"工艺名称",align:"center",checked:!0,ellipsis:!0,width:120},{key:"repeatCount",dataIndex:"repeatCount",title:"工步",align:"center",checked:!0,ellipsis:!0,width:120},{key:"wipPnlQty",dataIndex:"wipPnlQty",title:"PNL结存",align:"center",checked:!0,ellipsis:!0,width:120},{key:"wipSetQty",dataIndex:"wipSetQty",title:"SET结存",align:"center",checked:!0,ellipsis:!0,width:120},{key:"wipscrapSet",dataIndex:"wipscrapSet",title:"含废SET",align:"center",checked:!0,ellipsis:!0,width:120},{key:"wipscrapPcs",dataIndex:"wipscrapPcs",title:"含废PCS",align:"center",checked:!0,ellipsis:!0,width:120},{key:"wippcsQty",dataIndex:"wippcsQty",title:"有效PCS",align:"center",checked:!0,ellipsis:!0,width:120},{key:"applyScrapQty",dataIndex:"applyScrapQty",title:"报废申请",align:"center",checked:!0,ellipsis:!0,width:120},{key:"applyReworkQty",dataIndex:"applyReworkQty",title:"重工申请",align:"center",checked:!0,ellipsis:!0,width:120},{key:"assitQty",dataIndex:"assitQty",title:"外发数",align:"center",checked:!0,ellipsis:!0,width:120},{key:"holdPcsQty",dataIndex:"holdPcsQty",title:"暂停PCS数",align:"center",checked:!0,ellipsis:!0,width:120},{key:"iqcPcsQty",dataIndex:"iqcPcsQty",title:"IQC数量",align:"center",checked:!0,ellipsis:!0,width:120},{key:"delayDate",dataIndex:"delayDate",title:"结存小时",align:"center",checked:!0,ellipsis:!0,width:120}];return(a,t)=>{const s=l,d=e,u=b,v=p("STableSummaryCell"),x=p("STableSummaryRow");return c(),i("div",T,[h("div",C,[h("div",R,[n(s,{ref_key:"commonSearchRef",ref:r,searchParams:m(g),"onUpdate:searchParams":t[0]||(t[0]=e=>y(g)?g.value=e:null),"form-list":Q,onSearch:A,onReset:E},null,8,["searchParams"]),n(d,{ref_key:"leftTableRef",ref:j,searchParams:m(g),"onUpdate:searchParams":t[1]||(t[1]=e=>y(g)?g.value=e:null),column:O,"show-row-selection":!1,scroll:{y:"auto"},"is-init-get-data":"",class:"h-full","show-quick-jumper":!1,url:"/erpsyncmes/Mi/findModuleNo","auto-generate-uuid":"",onTableRowClick:W,onTableDataLoadSucess:$},null,8,["searchParams"])]),h("div",S,[h("div",M,[n(d,{ref_key:"rightTopTableRef",ref:F,searchParams:L.value,"onUpdate:searchParams":t[3]||(t[3]=e=>L.value=e),column:G,"show-row-selection":!1,scroll:{y:"auto"},"is-init-get-data":!1,url:"/erpsyncmes/Ecn/findModuleNo",class:"h-full","show-quick-jumper":!1},{title:f((()=>[n(u,{type:"primary",class:"mini-btn mr-8px",size:"small",ghost:"",onClick:t[2]||(t[2]=e=>{U.value?z():window.$message.error("请先选择生产型号!")})},{icon:f((()=>[n(m(w),{class:"align-sub"})])),default:f((()=>[t[5]||(t[5]=o(" 新增 "))])),_:1})])),_:1},8,["searchParams"])]),h("div",D,[n(d,{ref_key:"rightBottomTableRef",ref:H,searchParams:K.value,"onUpdate:searchParams":t[4]||(t[4]=e=>K.value=e),column:Y,"show-row-selection":!1,"row-key":"tableUuid",scroll:{y:"auto"},"is-init-get-data":"",loading:q.value,"data-source":B.value,url:"/erpsyncmes/wip/selectWipPubtechnology","auto-generate-uuid":!1,class:"h-full","is-pagination":!1,"summary-fixed":""},{title:f((()=>t[6]||(t[6]=[h("span",{class:"mr15px color-#646cff"},"WIP结存",-1)]))),summary:f((()=>[n(x,null,{default:f((()=>[n(v,{index:0,"col-span":2,class:"text-center color-blue-600 font-bold"},{default:f((()=>t[7]||(t[7]=[o(" 本页合计: ")]))),_:1}),n(v,{index:2,class:"text-center color-blue-600 font-bold"}),n(v,{index:3,class:"text-center color-blue-600 font-bold"},{default:f((({total:e})=>[o(k(Number(e)||""),1)])),_:1}),n(v,{index:4,class:"text-center color-blue-600 font-bold"},{default:f((({total:e})=>[o(k(Number(e)||""),1)])),_:1}),n(v,{index:5,class:"text-center color-blue-600 font-bold"},{default:f((({total:e})=>[o(k(Number(e)||""),1)])),_:1}),n(v,{index:6,class:"text-center color-blue-600 font-bold"},{default:f((({total:e})=>[o(k(Number(e)||""),1)])),_:1}),n(v,{index:7,class:"text-center color-blue-600 font-bold"},{default:f((({total:e})=>[o(k(Number(e)||""),1)])),_:1}),n(v,{index:8,class:"text-center color-blue-600 font-bold"},{default:f((({total:e})=>[o(k(Number(e)||""),1)])),_:1}),n(v,{index:9,class:"text-center color-blue-600 font-bold"},{default:f((({total:e})=>[o(k(Number(e)||""),1)])),_:1}),n(v,{index:10,class:"text-center color-blue-600 font-bold"},{default:f((({total:e})=>[o(k(Number(e)||""),1)])),_:1}),n(v,{index:11,class:"text-center color-blue-600 font-bold"},{default:f((({total:e})=>[o(k(Number(e)||""),1)])),_:1}),n(v,{index:12,class:"text-center color-blue-600 font-bold"},{default:f((({total:e})=>[o(k(Number(e)||""),1)])),_:1})])),_:1})])),_:1},8,["searchParams","loading","data-source"])])])])])}}}),[["__scopeId","data-v-7b09015a"]]);export{Q as default};
