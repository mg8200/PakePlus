import{Z as e,ag as a,aa as l,r as t,o as s,e as r,g as n,W as o,b as i,w as d,h as u,f as c,t as p,B as m,a5 as h}from"./index-B3PZsRwT.js";import{_ as v}from"./round-download-DUbhM0Ds.js";import{_ as f}from"./round-add-MytOGm9O.js";import{_ as g}from"./table-DoFSI9NT.js";import{_ as y}from"./common-search.vue_vue_type_script_setup_true_lang-BX9APgbN.js";import{_ as k}from"./modal.vue_vue_type_style_index_0_lang-Gjmj9w7c.js";import{g as x}from"./mold-maintenance-BvseXw5G.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DaxmPPHo.js";import"./api-By23aosn.js";import"./index-BThgVJ70.js";const _={class:"event-form"},b={__name:"add",props:{rowData:{type:Object,default:()=>null},operateType:{type:String,default:()=>"add"}},setup(e,{expose:a}){const l=e,i=t([]);x({pageNum:1,pageSize:9999}).then((({data:e,error:a})=>{a||(i.value=e.list.map((e=>({value:e.moldNo,label:e.moldNo}))))}));const d=[{type:"tabs",name:"基本项目",span:24},{type:"input",key:"model",label:"型号",placeholder:"请输入型号",span:24,rule:{required:!0,message:"请输入型号",trigger:"blur"}},{type:"input",key:"position",label:"存放位置",placeholder:"请输入存放位置",span:24,rule:{required:!0,message:"请输入存放位置",trigger:"blur"}},{type:"input",key:"applicant",label:"申请人",placeholder:"请输入申请人",span:24,rule:{required:!0,message:"请输入申请人",trigger:"blur"}},{type:"select",key:"states",label:"状态",placeholder:"请选择状态",span:24,defaultValue:"1",selectOptions:[{value:"1",label:"生效"},{value:"2",label:"报废"}]},{type:"textarea",key:"notes",label:"备注",placeholder:"请输入备注",span:24,textareaRows:1}];const u=t(null),c=t(function(){const e={};return d.forEach((a=>{a.key&&a.span&&("add"===l.operateType?e[a.key]=a.defaultValue||null:e[a.key]=l.rowData[a.key])})),e}());return a({model:c.value,validateForm:function(){return u.value.validateForm()}}),(e,a)=>(s(),r("div",_,[n(o,{ref_key:"formRef",ref:u,model:c.value,"onUpdate:model":a[0]||(a[0]=e=>c.value=e),"form-list":d},null,8,["model"])]))}},w={class:"mold-maintenance-page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},I={class:"modal-footer"},j={class:"modal-footer"},C=Object.assign({name:"workwear_through-hole-frame-management"},{__name:"index",setup(x){const _=t(null),C=t(null),Y=t({model:null,states:null,time:null}),R=[{type:"input",key:"model",label:"型号",placeholder:"请输入型号",span:24,md:12,lg:8,xl:8,xxl:6},{type:"select",key:"states",label:"状态",placeholder:"请选择状态",span:24,md:12,lg:8,xl:8,xxl:6,selectOptions:[{value:"1",label:"生效"},{value:"2",label:"报废"}]},{type:"dateRangePicker",key:"time",label:"日期",span:24,md:12,lg:10,xl:8,xxl:6}],q=i((()=>{var e;const a={...Y.value};return(null==(e=Y.value)?void 0:e[0])&&(a.startTime=l(Y.value.time[0]).format("YYYY-MM-DD"),a.endTime=l(Y.value.time[1]).format("YYYY-MM-DD")),delete a.time,a})),F=[{key:"dataIndex",dataIndex:"dataIndex",title:"序号",width:70,align:"center",checked:!0,ellipsis:!0},{key:"model",dataIndex:"model",title:"型号",align:"center",checked:!0,ellipsis:!0,width:150},{key:"applicationtime",dataIndex:"applicationtime",title:"申请时间",align:"center",checked:!0,ellipsis:!0,width:180},{key:"statesName",dataIndex:"statesName",title:"状态",align:"center",checked:!0,ellipsis:!0},{key:"applicant",dataIndex:"applicant",title:"申请人",align:"center",checked:!0,ellipsis:!0,width:130},{key:"position",dataIndex:"position",title:"存放位置",align:"center",checked:!0,ellipsis:!0},{key:"scrapper",dataIndex:"scrapper",title:"报废人",align:"center",checked:!0,ellipsis:!0},{key:"reasonforscrapping",dataIndex:"reasonforscrapping",title:"报废原因",align:"center",checked:!0,ellipsis:!0},{key:"scraptime",dataIndex:"scraptime",title:"报废时间",align:"center",checked:!0,ellipsis:!0,width:160},{key:"notes",dataIndex:"notes",title:"备注",align:"center",checked:!0,ellipsis:!0},{key:"table-cz",dataIndex:"table-cz",title:"操作",align:"center",checked:!0,ellipsis:!0,width:140,fixed:"right",customRender:({record:a})=>n("div",null,[n(m,{type:"link",danger:!0,class:"pl-3px pr-3px",onClick:()=>{var l;l=a,window.$modal.confirm({title:"确定删除?",onOk:()=>{var a;(a=l.id,e({url:"/qms/through/throughHoleFrame/delete?id=".concat(a),method:"delete"})).then((({error:e})=>{e||(window.$message.success("删除成功"),D())}))},onCancel:()=>{}})}},{default:()=>[u("删除")]}),n(m,{type:"link",class:"pl-3px pr-3px",onClick:()=>{O(a)}},{default:()=>[u("修改")]}),1===Number(a.states)?n(m,{type:"link",class:"pl-3px pr-3px",onClick:()=>{return e=a,A.value=!0,void(Z.value=e);var e}},{default:()=>[u("报废")]}):""])}];function D(){C.value.getData(1)}function H(){h((()=>{Y.value={keywords:null,noticeState:null},D()}))}const N=t("add"),P=t(!1),M=t(!1),U=t(null),z=t(null);function O(e){U.value=e,P.value=!0,N.value=e?"edit":"add"}function S(){P.value=!1}async function T(){const a={...z.value};let l;await a.validateForm(),M.value=!0;const t={...a.model};l="add"===N.value?e({url:"/qms/through/throughHoleFrame/insert",method:"post",data:t}):function(a){return e({url:"/qms/through/throughHoleFrame/update",method:"post",data:a})}({...t,id:U.value.id}),l.then((({error:e})=>{e||(window.$message.success("".concat("add"===N.value?"新增":"修改","成功")),S(),H())})).finally((()=>M.value=!1))}function $(){var e;e={...Y.value},a({url:"/qms/through/throughHoleFrame/export",params:e,method:"get",fileName:"通孔架管理员导出".concat(l().format("YYYY-MM-DD HH:mm:ss"),".xlsx")})}t(null);const A=t(!1),B=t({repealRemark:null}),V=[{type:"textarea",key:"reasonforscrapping",label:"报废原因",rule:{required:!0,message:"请输入报废原因",trigger:"blur"},placeholder:"请输入报废原因",span:24}],E=t(!1),W=t(null),Z=t(null);function G(){A.value=!1}async function J(){const a={...B.value,id:Z.value.id,states:"2"};var l;await W.value.validateForm(),E.value=!0,(l=a,e({url:"/qms/through/throughHoleFrame/scrap",method:"post",data:l})).then((({error:e})=>{e||(window.$message.success("报废成功"),G(),H())})).finally((()=>E.value=!1))}return(e,a)=>{const l=f,t=m,i=v,h=o;return s(),r("div",w,[n(y,{ref_key:"commonSearchRef",ref:_,searchParams:Y.value,"onUpdate:searchParams":a[0]||(a[0]=e=>Y.value=e),"form-list":R,"is-search":!0,onSearch:D,onReset:H},null,8,["searchParams"]),n(g,{ref_key:"tableRef",ref:C,searchParams:q.value,"onUpdate:searchParams":a[2]||(a[2]=e=>q.value=e),column:F,"show-row-selection":!1,"row-key":"id",scroll:{y:"auto"},"is-init-get-data":"",url:"/qms/through/throughHoleFrame/selectAll"},{tableTitle:d((()=>[n(t,{type:"primary",class:"mini-btn mr-8px",size:"small",ghost:"",onClick:a[1]||(a[1]=e=>O(null))},{icon:d((()=>[n(l,{class:"align-sub text-icon"})])),default:d((()=>[a[6]||(a[6]=u(" 新增 "))])),_:1}),n(t,{type:"primary",size:"small",ghost:"",class:"mini-btn mr-8px",onClick:$},{icon:d((()=>[n(i,{class:"align-sub text-icon"})])),default:d((()=>[a[7]||(a[7]=c("span",{class:"ml-3px"},"导出",-1))])),_:1})])),_:1},8,["searchParams"]),n(k,{visible:P.value,"onUpdate:visible":a[3]||(a[3]=e=>P.value=e),title:"通孔架管理".concat("add"===N.value?"新增":"修改"),width:"700px",height:"500px",centered:!0,"destroy-on-close":!0,onClose:S},{footer:d((()=>[c("div",I,[n(t,{loading:M.value,type:"primary",onClick:T},{default:d((()=>[u(p("add"===N.value?"新增":"修改"),1)])),_:1},8,["loading"]),n(t,{onClick:S},{default:d((()=>a[8]||(a[8]=[u("关 闭")]))),_:1})])])),default:d((()=>[n(b,{ref_key:"addRef",ref:z,"row-data":U.value,"operate-type":N.value},null,8,["row-data","operate-type"])])),_:1},8,["visible","title"]),n(k,{visible:A.value,"onUpdate:visible":a[5]||(a[5]=e=>A.value=e),title:"报废",width:"700px",height:"232px",centered:!0,"destroy-on-close":!0,onClose:G},{footer:d((()=>[c("div",j,[n(t,{loading:E.value,type:"primary",onClick:J},{default:d((()=>a[9]||(a[9]=[u("报废")]))),_:1},8,["loading"]),n(t,{onClick:G},{default:d((()=>a[10]||(a[10]=[u("关 闭")]))),_:1})])])),default:d((()=>[n(h,{ref_key:"formRef",ref:W,model:B.value,"onUpdate:model":a[4]||(a[4]=e=>B.value=e),"form-list":V},null,8,["model"])])),_:1},8,["visible"])])}}});export{C as default};
